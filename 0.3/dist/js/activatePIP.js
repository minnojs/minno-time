/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

// MIT license

define("app/task/script",[],function(){function e(e){return e&&(t=e),t}var t={};return e}),define("app/task/settings",["require","./script"],function(e){function t(e){var t=r().settings||{};return e?t[e]:t}var r=e("./script");return t}),define("app/trial/current_trial",[],function(){var e;return function(t){return t&&(e=t),e}}),define("app/task/adjust_canvas",["require","jquery","app/task/settings","app/trial/current_trial"],function(e){function t(e){function t(){var t,n,u=o.$el;if(s.width){if(!e)return!0;n=s.width,t=n*a}else{var c={width:r(window).innerWidth(),height:r(window).innerHeight()},l=c.height,d=Math.min(s.maxWidth,c.width,u.parent().innerWidth());l>a*d?(t=d*a,n=d):(t=l,n=l/a)}t-=parseInt(u.css("border-top-width"),10)+parseInt(u.css("border-bottom-width"),10)+parseInt(u.css("margin-top"),10),n-=parseInt(u.css("border-left-width"),10)+parseInt(u.css("border-right-width"),10),u.width(n),u.height(t),u.css("font-size",t*(s.textSize||3)/100),i()&&(i()._layout_collection.refresh(),i()._stimulus_collection.refresh()),window.scrollTo(0,1)}var a,o=this,s=n("canvas")||{};if(s.proportions)if(r.isPlainObject(s.proportions)){if("number"!=typeof s.proportions.height||"number"!=typeof s.proportions.width)throw new Error("The canvas proportions object`s height and a width properties must be numeric");a=s.proportions.height/s.proportions.width}else a=s.proportions||.8;setTimeout(t,e?0:500)}var r=e("jquery"),n=e("app/task/settings"),i=e("app/trial/current_trial");return t}),define("app/task/canvasConstructor",["require","underscore"],function(e){function t(e,t){var i;if(!n.isPlainObject(e))throw new Error("canvas(map): You must set a rule map for canvas to work properly");if(n.isUndefined(t))return n.noop;if(!n.isPlainObject(t))throw new Error("canvas(settings): canvas settings must be an object");return i=n.map(t,function(t,n){var i=e[n];if(i)return r(i.element,i.property,t);throw new Error("canvas("+n+"): unknow key in canvas object.")}),function(){n.forEach(i,function(e){e.call()})}}function r(e,t,r){var i=e.css(t);return e.css(t,r),n.bind(e.css,e,t,i)}var n=e("underscore");return t}),define("text",["module"],function(e){"use strict";var t,r,n,i,a,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,l=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,p=c&&(location.port||void 0),f={},h=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){r=o[t];try{e=new ActiveXObject(r)}catch(e){}if(e){o=[r];break}}return e},parseName:function(e){var t,r,n,i=!1,a=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return a!==-1&&(!o||a>1)?(t=e.substring(0,a),r=e.substring(a+1,e.length)):t=e,n=r||t,a=n.indexOf("!"),a!==-1&&(i="strip"===n.substring(a+1),n=n.substring(0,a),r?r=n:t=n),{moduleName:t,ext:r,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,i){var a,o,s,u=t.xdRegExp.exec(e);return!u||(a=u[2],o=u[3],o=o.split(":"),s=o[1],o=o[0],!(a&&a!==r||o&&o.toLowerCase()!==n.toLowerCase()||(s||o)&&s!==i))},finishLoad:function(e,r,n,i){n=r?t.strip(n):n,h.isBuild&&(f[e]=n),i(n)},load:function(e,r,n,i){if(i&&i.isBuild&&!i.inlineText)return void n();h.isBuild=i&&i.isBuild;var a=t.parseName(e),o=a.moduleName+(a.ext?"."+a.ext:""),s=r.toUrl(o),u=h.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!c||u(s,l,d,p)?t.get(s,function(r){t.finishLoad(e,a.strip,r,n)},function(e){n.error&&n.error(e)}):r([o],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)}))},write:function(e,r,n,i){if(f.hasOwnProperty(r)){var a=t.jsEscape(f[r]);n.asModule(e+"!"+r,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,r,n,i,a){var o=t.parseName(r),s=o.ext?"."+o.ext:"",u=o.moduleName+s,c=n.toUrl(o.moduleName+s)+".js";t.load(u,n,function(r){var n=function(e){return i(c,e)};n.asModule=function(e,t){return i.asModule(e,c,t)},t.write(e,u,n,a)},a)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");0===i.indexOf("\ufeff")&&(i=i.substring(1)),t(i)}catch(e){n&&n(e)}}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,r,n,i){var a,o=t.createXhr();if(o.open("GET",e,!0),i)for(a in i)i.hasOwnProperty(a)&&o.setRequestHeader(a.toLowerCase(),i[a]);h.onXhr&&h.onXhr(o,e),o.onreadystatechange=function(t){var i,a;4===o.readyState&&(i=o.status||0,i>399&&i<600?(a=new Error(e+" HTTP status: "+i),a.xhr=o,n&&n(a)):r(o.responseText),h.onXhrComplete&&h.onXhrComplete(o,e))},o.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,i="utf-8",a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),i)),u="";try{for(r=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=s.readLine());)r.append(o),r.append(n);u=String(r.toString())}finally{s.close()}t(u)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,i=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,o,s,u={};a&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),r.init(s,1,0,!1),o=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(r,"utf-8",r.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(r.available(),u),o.close(),r.close(),t(u.value)}catch(e){throw new Error((s&&s.path||"")+": "+e)}}),t}),define("text!templates/loading.html",[],function(){return'<style>\n/**\n * Loading page progress bars\n * http://css-tricks.com/css3-progress-bars/\n */\n \t.meter-wrapper{\n \t\tposition: relative;\n\t\ttop:50%;\n \t}\n\n\t.meter {\n\t\theight: 30px;  /* Can be anything */\n\t\tposition: relative;\n\t\tmargin-left: auto; margin-right: auto;\n\t\tmargin-top:-15px;\n\t\twidth:82%;\n\t\tbackground: #555;\n\t\t-moz-border-radius: 25px;\n\t\t-webkit-border-radius: 25px;\n\t\tborder-radius: 25px;\n\t\tpadding: 10px;\n\t\t-webkit-box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3);\n\t\t-moz-box-shadow   : inset 0 -1px 1px rgba(255,255,255,0.3);\n\t\tbox-shadow        : inset 0 -1px 1px rgba(255,255,255,0.3);\n\t}\n\t.meter > span {\n\t\tdisplay: block;\n\t\theight: 100%;\n\t\t   -webkit-border-top-right-radius: 8px;\n\t\t-webkit-border-bottom-right-radius: 8px;\n\t\t\t   -moz-border-radius-topright: 8px;\n\t\t\t-moz-border-radius-bottomright: 8px;\n\t\t\t\t   border-top-right-radius: 8px;\n\t\t\t\tborder-bottom-right-radius: 8px;\n\t\t\t-webkit-border-top-left-radius: 20px;\n\t\t -webkit-border-bottom-left-radius: 20px;\n\t\t\t\t-moz-border-radius-topleft: 20px;\n\t\t\t -moz-border-radius-bottomleft: 20px;\n\t\t\t\t\tborder-top-left-radius: 20px;\n\t\t\t\t border-bottom-left-radius: 20px;\n\t\tbackground-color: rgb(43,194,83);\n\t\tbackground-image: -webkit-gradient(\n\t\t  linear,\n\t\t  left bottom,\n\t\t  left top,\n\t\t  color-stop(0, rgb(43,194,83)),\n\t\t  color-stop(1, rgb(84,240,84))\n\t\t );\n\t\tbackground-image: -moz-linear-gradient(\n\t\t  center bottom,\n\t\t  rgb(43,194,83) 37%,\n\t\t  rgb(84,240,84) 69%\n\t\t );\n\t\t-webkit-box-shadow:\n\t\t  inset 0 2px 9px  rgba(255,255,255,0.3),\n\t\t  inset 0 -2px 6px rgba(0,0,0,0.4);\n\t\t-moz-box-shadow:\n\t\t  inset 0 2px 9px  rgba(255,255,255,0.3),\n\t\t  inset 0 -2px 6px rgba(0,0,0,0.4);\n\t\tbox-shadow:\n\t\t  inset 0 2px 9px  rgba(255,255,255,0.3),\n\t\t  inset 0 -2px 6px rgba(0,0,0,0.4);\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t}\n\t.meter > span:after, .animate > span > span {\n\t\tcontent: "";\n\t\tposition: absolute;\n\t\ttop: 0; left: 0; bottom: 0; right: 0;\n\t\tbackground-image:\n\t\t   -webkit-gradient(linear, 0 0, 100% 100%,\n\t\t\t  color-stop(.25, rgba(255, 255, 255, .2)),\n\t\t\t  color-stop(.25, transparent), color-stop(.5, transparent),\n\t\t\t  color-stop(.5, rgba(255, 255, 255, .2)),\n\t\t\t  color-stop(.75, rgba(255, 255, 255, .2)),\n\t\t\t  color-stop(.75, transparent), to(transparent)\n\t\t   );\n\t\tbackground-image:\n\t\t\t-moz-linear-gradient(\n\t\t\t  -45deg,\n\t\t\t  rgba(255, 255, 255, .2) 25%,\n\t\t\t  transparent 25%,\n\t\t\t  transparent 50%,\n\t\t\t  rgba(255, 255, 255, .2) 50%,\n\t\t\t  rgba(255, 255, 255, .2) 75%,\n\t\t\t  transparent 75%,\n\t\t\t  transparent\n\t\t   );\n\t\tz-index: 1;\n\t\t-webkit-background-size: 50px 50px;\n\t\t-moz-background-size: 50px 50px;\n\t\t-webkit-animation: move 2s linear infinite;\n\t\t   -webkit-border-top-right-radius: 8px;\n\t\t-webkit-border-bottom-right-radius: 8px;\n\t\t\t   -moz-border-radius-topright: 8px;\n\t\t\t-moz-border-radius-bottomright: 8px;\n\t\t\t\t   border-top-right-radius: 8px;\n\t\t\t\tborder-bottom-right-radius: 8px;\n\t\t\t-webkit-border-top-left-radius: 20px;\n\t\t -webkit-border-bottom-left-radius: 20px;\n\t\t\t\t-moz-border-radius-topleft: 20px;\n\t\t\t -moz-border-radius-bottomleft: 20px;\n\t\t\t\t\tborder-top-left-radius: 20px;\n\t\t\t\t border-bottom-left-radius: 20px;\n\t\toverflow: hidden;\n\t}\n\n\t.animate > span:after {\n\t\tdisplay: none;\n\t}\n\n\t@-webkit-keyframes move {\n\t\t0% {\n\t\t   background-position: 0 0;\n\t\t}\n\t\t100% {\n\t\t   background-position: 50px 50px;\n\t\t}\n\t}\n\n\t.orange > span {\n\t\tbackground-color: #f1a165;\n\t\tbackground-image: -moz-linear-gradient(top, #f1a165, #f36d0a);\n\t\tbackground-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f1a165),color-stop(1, #f36d0a));\n\t\tbackground-image: -webkit-linear-gradient(#f1a165, #f36d0a);\n\t}\n\n\t.red > span {\n\t\tbackground-color: #f0a3a3;\n\t\tbackground-image: -moz-linear-gradient(top, #f0a3a3, #f42323);\n\t\tbackground-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f0a3a3),color-stop(1, #f42323));\n\t\tbackground-image: -webkit-linear-gradient(#f0a3a3, #f42323);\n\t}\n\n\t.nostripes > span > span, .nostripes > span:after {\n\t\t-webkit-animation: none;\n\t\tbackground-image: none;\n\t}\n</style>\n\n<div class="meter-wrapper">\n\t<div class="meter">\n\t\t<span style="width: 0%"></span>\n\t</div>\n</div>'}),define("app/task/main_view",["require","backbone","jquery","underscore","./adjust_canvas","./canvasConstructor","app/task/script","text!templates/loading.html"],function(e){var t=e("backbone"),r=e("jquery"),n=e("underscore"),i=e("./adjust_canvas"),a=e("./canvasConstructor"),o=e("app/task/script"),s=e("text!templates/loading.html"),u=t.View.extend({id:"canvas",initialize:function(){n.bindAll(this,["activate","render","destroy"]),this.deferred=r.Deferred(),this.deferred.promise().always(this.destroy);var e=n.bind(this.adjustCanvas,this);r(window).on("orientationchange.pip resize.pip",e),this.deferred.promise().always(function(){r(window).off("orientationchange.pip resize.pip",e)})},render:function(){return this.adjustCanvas(!0),this},activate:function(){var e=this,t=o().settings.canvas||{},i=r.Deferred();return r(document).ready(function(){var o={background:{element:r("body"),property:"backgroundColor"},canvasBackground:{element:e.$el,property:"backgroundColor"},borderColor:{element:e.$el,property:"borderColor"},borderWidth:{element:e.$el,property:"borderWidth"}},s=a(o,n.pick(t,["background","canvasBackground","borderColor","borderWidth"]));e.deferred.promise().always(s),t.css&&e.$el.css(t.css),r("[pi-player]").length?r("[pi-player]").empty().append(e.$el):e.$el.appendTo("body"),e.render(),i.resolve()}),i},loading:function(e){var t;return"pending"!=e.state()?e:(this.$el.html(s),t=this.$(".meter span"),e.progress(function(e,r){t.width((r?e/r*100:0)+"%")}))},empty:function(){this.$el.empty()},destroy:function(){r(window).off(".pip"),this.remove(),this.unbind()},adjustCanvas:i});return new u}),define("utils/database/mixer/mixer",["underscore"],function(e){function t(t,r){function n(t){var r=t.mixer;if(!(e.isPlainObject(t)&&"mixer"in t))return[t];if(e.isUndefined(n.mixers[r]))throw new Error("Mixer: unknow mixer type = "+r);if(!t.remix&&t.$parsed)return t.$parsed;if(t.$parsed=n.mixers[r].apply(null,arguments),!e.isArray(t.$parsed))throw new Error("Mixer: mixers must return an array (mixer: "+r+")");return t.$parsed}function i(t,r){return e.reduce(t,function(t,a){if(e.isPlainObject(a)&&"mixer"in a&&"wrapper"!=a.mixer&&!a.wrapper){var o=i(n(a,r),r);return t.concat(o)}return t.concat([a])},[])}function a(t,n){function a(){var e,n=r()*l,i=0;for(e=0;e<s.length;e++)if(i+=t.weights[e],i=+i.toFixed(3),n<=i)return t.data[e];throw new Error("Mixer: something went wrong with weightedRandom")}var o,s=t.data?i(t.data,n):[],u=t.n||1,c=[],l=e.reduce(t.weights,function(e,t){return e+t});for(o=0;o<u;o++)c.push(a());return c}return n.mixers={wrapper:function(e){return e.data},repeat:function(t){var r,n=t.data||[],i=[];for(r=0;r<t.times;r++)i=i.concat(e.clone(n,!0));return i},random:function(e,r){var n=e.data?i(e.data,r):[];return t(n)},choose:function(r,n){var a=r.data?i(r.data,n):[];return e.take(t(a),r.n?r.n:1)},custom:function(t,r){return e.isFunction(t.fn)?t.fn(t,r):[]},weightedRandom:a,weightedChoose:a},n}return t.$inject=["randomizeShuffle","randomizeRandom"],t}),define("utils/database/mixer/branching/dotNotation",["require","underscore"],function(e){function t(e,t){return r.isString(e)&&(e=e.split(".")),r.reduce(e,function(e,t){if(r.isPlainObject(e)||r.isArray(e))return e[t]},t)}var r=e("underscore");return t}),define("utils/database/mixer/branching/mixerDotNotationProvider",["require","underscore"],function(e){function t(e){function t(t,n){var i=/[^\/]\./;return r.isString(t)?i.test(t)?e(t,n):t.replace("/.","."):t}return t}var r=e("underscore");return t.$inject=["dotNotation"],t}),define("utils/database/mixer/branching/mixerConditionProvider",["require","underscore"],function(e){function t(e,t){function n(n,i){var a,o,s;if(r.isFunction(n)?s=n:(a=e(n.compare,i),o=e(n.to,i),s=n.operator),t(["conditions"]).info("Condition: ",a,s||"equals",o,n),n.DEBUG&&console&&console.info("Condition: ",a,s||"equals",o,n),r.isFunction(s))return!!s.apply(i,[a,o,i]);switch(s){case"greaterThan":return!(!r.isNumber(a)||!r.isNumber(o))&&+a>+o;case"greaterThanOrEqual":return!(!r.isNumber(a)||!r.isNumber(o))&&+a>=+o;case"in":return!!r.isArray(o)&&~r.indexOf(o,a);case"exactly":return a===o;case"equals":default:return r.isUndefined(n.to)?!!a:r.isEqual(a,o)}return s}return n}var r=e("underscore");return t.$inject=["mixerDotNotation","piConsole"],t}),define("utils/database/mixer/branching/mixerEvaluateProvider",["require","underscore"],function(e){function t(e){function t(n,i){function a(e){return t(e,i)}return r.isArray(n)&&(n={and:n}),n.and?r.every(n.and,a):n.nand?!r.every(n.nand,a):n.or?r.some(n.or,a):n.nor?!r.some(n.nor,a):e(n,i)}return t}var r=e("underscore");return t.$inject=["mixerCondition"],t}),define("utils/database/mixer/branching/mixerBranchingDecorator",["require","underscore"],function(e){function t(e,t,n){function i(e,i){return i=r.extend(i||{},n),t(e.conditions,i)?e.data||[]:e.elseData||[]}function a(e,i){i=r.extend(i||{},n);var a;return a=r.find(e.branches,function(e){return t(e.conditions,i)}),a?a.data||[]:e.elseData||[]}return e.mixers.branch=i,e.mixers.multiBranch=a,e}var r=e("underscore");return t.$inject=["$delegate","mixerEvaluate","mixerDefaultContext"],t}),define("utils/database/mixer/mixerSequenceProvider",["require","underscore"],function(e){function t(e){function t(e){this.sequence=e,this.stack=[],this.add(e),this.pointer=0}return r.extend(t.prototype,{add:function(e,t){this.stack.push({pointer:t?e.length:-1,sequence:e})},proceed:function(t,n){var i=this.stack[this.stack.length-1],a="next"===t;if(!i)throw new Error("mixerSequence: subSequence not found");i.pointer+=a?1:-1;var o=i.sequence[i.pointer];return r.isUndefined(o)&&this.stack.length>1?(this.stack.pop(),this.proceed.call(this,t,n)):o&&o.mixer?(this.add(e(o,n),!a),this.proceed.call(this,t,n)):this},next:function(e){return this.pointer++,this.proceed.call(this,"next",e)},prev:function(e){return this.pointer--,this.proceed.call(this,"prev",e)},current:function(){var e=this.stack[this.stack.length-1];if(!e)throw new Error("mixerSequence: subSequence not found");var t=e.sequence[e.pointer];if(t)return t.$meta=this.meta(),t},meta:function(){return{number:this.pointer,outOf:r.reduce(this.stack,function(e,t){return e+t.sequence.length-1},0)+1}}}),t}var r=e("underscore");return t.$inject=["mixer"],t}),define("utils/database/mixer/main",["require","underscore","./mixer","./branching/dotNotation","./branching/mixerDotNotationProvider","./branching/mixerConditionProvider","./branching/mixerEvaluateProvider","./branching/mixerBranchingDecorator","./mixerSequenceProvider"],function(e){function t(){return console}var r=e("underscore"),n=e("./mixer")(r.shuffle,Math.random),i=e("./branching/dotNotation"),a=e("./branching/mixerDotNotationProvider")(i),o=e("./branching/mixerConditionProvider")(a,t),s=e("./branching/mixerEvaluateProvider")(o),u={};e("./branching/mixerBranchingDecorator")(n,s,u);var c=e("./mixerSequenceProvider")(n);return c}),define("utils/database/template/templateObjProvider",["require","underscore"],function(e){function t(e){function t(e,t,i){function a(t,i,a){return e===a&&r.includes(o,i)?t:r.isString(t)&&r.includes(t,"<%")?n(t,s):void 0}var o=r.get(i,"skip",[]),s=r.assign({},t);return r.cloneDeep(e,a)}var n=e("template");return t}var r=e("underscore");return t.$inject=["$filter"],t}),define("utils/database/template/templateFilter",["require","underscore"],function(e){function t(e,t){function n(n,i){if(!~n.indexOf("<%"))return n;i=r.extend(i||{},t);try{return r.template(n)(i)}catch(t){return e.error('ERROR: "'+t.message+'" in the following template: ',n),""}}return n}var r=e("underscore");return t.$inject=["$log","templateDefaultContext"],t}),define("utils/database/template/main",["require","./templateObjProvider","./templateFilter"],function(e){return e("./templateObjProvider")(function(){return e("./templateFilter")(console,{})})}),define("utils/database/collection/collectionProvider",["underscore"],function(e){function t(){function t(r){if(r instanceof t)return r;if(!(e.isUndefined(r)||e.isArray(r)||r instanceof t))throw new Error("Collections can only be constructed from arrays");this.collection=r||[],this.length=this.collection.length,this.pointer=-1}e.extend(t.prototype,{first:function(){return this.pointer=0,this.collection[this.pointer]},last:function(){return this.pointer=this.collection.length-1,this.collection[this.pointer]},end:function(){this.pointer=this.collection.length},current:function(){return this.collection[this.pointer]},next:function(){return this.collection[++this.pointer]},previous:function(){return this.collection[--this.pointer]},add:function(t){return arguments.length?(t=e.isArray(t)?t:[t],this.collection=this.collection.concat(t),this.length=this.collection.length,this):this},at:function(e){return this.collection[e]}});var r=["where","filter"],n=Array.prototype.slice;return e.each(r,function(r){t.prototype[r]=function(){var i=n.call(arguments);i.unshift(this.collection);var a=e[r].apply(e,i);return new t(a)}}),t}return t}),define("utils/database/randomizer/randomizerProvider",["underscore"],function(e){function t(t,r,n){function i(){this._cache={random:{},exRandom:{},sequential:{}}}function a(r,n,i){var a=this._cache.random;return i&&!e.isUndefined(a[n])?a[n]:(a[n]=t(r),a[n])}function o(t,r,i){var a,o=this._cache.sequential,s=o[r];if(e.isUndefined(s))return s=o[r]=new n(e.range(t)),s.first();if(s.length!==t)throw new Error("This seed  ("+r+") points to a collection with the wrong length, you can only use a seed for sets of the same length");return i?s.current():(a=s.next(),e.isUndefined(a)?s.first():a)}function s(t,i,a){var o,s=this._cache.exRandom,u=s[i];if(e.isUndefined(u))return u=s[i]=new n(r(t)),u.first();if(u.length!==t)throw new Error("This seed  ("+i+") points to a collection with the wrong length, you can only use a seed for sets of the same length");return a?u.current():(o=u.next(),e.isUndefined(o)?(u=s[i]=new n(r(t)),u.first()):o)}return e.extend(i.prototype,{random:a,exRandom:s,sequential:o}),i}return t.$inject=["randomizeInt","randomizeRange","Collection"],t}),define("utils/database/queryProvider",["underscore"],function(e){function t(t,r){function n(n,i,a){var o=new t(i);if(e.isFunction(n))return n(i);(e.isString(n)||e.isNumber(n))&&(n={set:n,type:"random"}),n.set&&(o=o.where({set:n.set})),e.isString(n.data)&&(o=o.filter(function(e){return e.handle===n.data||e.data&&e.data.handle===n.data})),e.isPlainObject(n.data)&&(o=o.where({data:n.data})),e.isFunction(n.data)&&(o=o.filter(n.data));var s,u,c=n.seed||"$"+i.namespace+n.set,l=o.length,d=n.repeat;switch(n.type){case void 0:case"byData":case"random":s=a.random(l,c,d);break;case"exRandom":s=a.exRandom(l,c,d);break;case"sequential":s=a.sequential(l,c,d);break;case"first":s=0;break;case"last":s=l-1;break;default:throw new Error("Unknow query type: "+n.type)}if(e.isUndefined(o.at(s)))throw u=new Error("Query failed, object ("+JSON.stringify(n)+") not found. If you are trying to apply a template, you should know that they are not supported for inheritance."),r("query").error(u),u;return o.at(s)}return n}return t.$inject=["Collection","piConsole"],t}),define("utils/database/inflateProvider",["require","underscore"],function(e){function t(e,t,n){function i(e){return r.isFunction(e.customize)&&e.customize.apply(e,[e,t.global]),e}function a(t,o,s,u,c){if(c=u?--c:10,!c)throw new Error("Inheritance loop too deep, you can only inherit up to 10 levels down");if(!r.isPlainObject(t))throw console.error("You are trying to inflate a non object",t),new Error("You are trying to inflate a non object");var l,d,p=r.cloneDeep(t),f=p.inherit;if(!p.inherit)return!u&&i(p),p;if(l=e(f,o,s),!l)throw d=new Error("Query failed, object ("+JSON.stringify(f)+") not found."),n("query").error(d),d;if(l=a(l,o,s,!0,c),f.merge&&!r.isArray(f.merge))throw new Error("Inheritance error: inherit.merge must be an array.");return r.each(l,function(e,t){var n,i;if(!(t in p))return void(p[t]=r.isFunction(e)?e:r.cloneDeep(e));if(r.indexOf(f.merge,t)!=-1){if(n=p[t],i=e,r.isArray(n)){if(!r.isArray(i))throw new Error('Inheritance error: You tried merging an array with an non array (for "'+t+'")');p[t]=n.concat(i)}if(r.isPlainObject(n)){if(!r.isPlainObject(i))throw new Error('Inheritance error: You tried merging an object with an non object (for "'+t+'")');p[t]=r.extend({},i,n)}}}),l.data&&(p.data=r.extend(l.data,p.data||{})),!u&&i(p),p}return a}var r=e("underscore");return t.$inject=["databaseQuery","$rootScope","piConsole"],t}),define("utils/database/store/storeProvider",["underscore"],function(e){function t(t){function r(){this.store={}}return e.extend(r.prototype,{create:function(e){if(this.store[e])throw new Error("The name space "+e+" already exists");this.store[e]=new t,this.store[e].namespace=e},read:function(e){if(!this.store[e])throw new Error("The name space "+e+" does not exist");return this.store[e]},update:function(e,t){var r=this.read(e);r.add(t)},del:function(e){this.store[e]=void 0}}),r}return t.$inject=["Collection"],t}),define("utils/database/databaseSequenceProvider",["require","underscore"],function(e){function t(e){function t(t,r,n){this.namespace=t,this.mixerSequence=new e(r),this.db=n}return r.extend(t.prototype,{next:function(e){return this.mixerSequence.next(e),this},prev:function(e){return this.mixerSequence.prev(e),this},current:function(e,t){e||(e={});var r=this.mixerSequence.current(e);return r?this.db.inflate(this.namespace,r,e,t):r},all:function(e,t){for(var r=[],n=this.next().current(e,t);n;)r.push(n),n=this.next().current(e,t);return r}}),t}var r=e("underscore");return t.$inject=["MixerSequence"],t}),define("utils/database/databaseProvider",["require","underscore"],function(e){function t(e,t,n,i,a){function o(){this.store=new e,this.randomizer=new t}return r.extend(o.prototype,{createColl:function(e){this.store.create(e)},getColl:function(e){return this.store.read(e)},add:function(e,t){var r=this.store.read(e);r.add(t)},inflate:function(e,t,a,o){var s,u=this.getColl(e);return t.$inflated&&!t.reinflate||(t.$inflated=n(t,u,this.randomizer),t.$templated=null),t.$templated&&!t.$inflated.regenerateTemplate||(a[e+"Meta"]=t.$meta,a[e+"Data"]=i(t.$inflated.data||{},a,o),t.$templated=i(t.$inflated,a,o)),s=t.$templated,a.global&&s.addGlobal&&r.extend(a.global,s.addGlobal),a.current&&s.addCurrent&&r.extend(a.current,s.addCurrent),t.$templated},sequence:function(e,t){if(!r.isArray(t))throw new Error("Sequence must be an array.");return new a(e,t,this)}}),o}var r=e("underscore");return t.$inject=["DatabaseStore","DatabaseRandomizer","databaseInflate","templateObj","databaseSequence"],t}),define("utils/database/main",["require","underscore","./mixer/main","./template/main","./collection/collectionProvider","./randomizer/randomizerProvider","./queryProvider","./inflateProvider","./store/storeProvider","./databaseSequenceProvider","./databaseProvider"],function(e){function t(e){return i.shuffle(i.range(e))}function r(e){return Math.floor(Math.random()*e)}function n(){return console}var i=e("underscore"),a=e("./mixer/main"),o=e("./template/main"),s=e("./collection/collectionProvider")(),u=e("./randomizer/randomizerProvider")(r,t,s),c=e("./queryProvider")(s,n),l=e("./inflateProvider")(c,{global:window.piGlobal},n),d=e("./store/storeProvider")(s),p=e("./databaseSequenceProvider")(a),f=e("./databaseProvider")(d,u,l,o,p);return f}),define("app/sequencer/database",["require","utils/database/main"],function(e){var t=e("utils/database/main");return new t}),define("app/sequencer/sequenceGoto",["require","underscore"],function(e){function t(e,t,n){var i=this.mixerSequence;switch(e){case"nextWhere":r("next",t,n,i);break;case"previousWhere":r("prev",t,n,i);break;case"current":break;case"first":do i.prev(n);while(i.current(n));break;case"last":do i.next(n);while(i.current(n));i.prev();break;case"end":do i.next(n);while(i.current(n));break;case"next":i.next(n);break;default:throw new Error('Unknow destination "'+e+'" for goto.')}return this}function r(e,t,r,i){var a;do i[e](),a=i.current(r);while(a&&!n.callback(t)(a.data))}var n=e("underscore");return t}),define("app/sequencer/taskSequence",[],function(){function e(e){return e&&(t=e),t}var t;return e}),define("utils/preloader",["require","jquery"],function(e){function t(e,t){if(t=t||"image",r.inArray(e,n)==-1){var u=r.Deferred();switch(t){case"template":requirejs(["text!"+e],function(){u.resolve()},function(){throw new Error("Template not found: "+e)});break;case"image":default:var c=new Image;r(c).on("load",function(){u.resolve()}),r(c).one("error",function(){c.src="",c.src=e,r(c).on("error",function(){throw new Error('Image not found: "'+e+'"')})}),c.src=e,s[e]=c}return i.push(u),n.push(e),u.done(function(){a++,o.notify(a,i.length)}),u}return!1}var r=e("jquery"),n=[],i=[],a=0,o=r.Deferred(),s={};return{add:t,getImage:function(e){return s[e].cloneNode()},activate:function(){return r.when.apply(r,i).done(function(){o.resolve()}).fail(function(){o.reject()}),o.promise()},reset:function(){n=[],i=[],a=0,o=this.state=r.Deferred()},state:o}}),define("app/task/build_url",["require","underscore","./settings"],function(e){var t=e("underscore"),r=e("./settings");return function(e,n){var i,a=r();return t.isString(a.base_url)?i=a.base_url:t.isObject(a.base_url)&&(i=a.base_url[n]),"image"==n&&/^data:image/.test(e)?e:(i?"/"!=i[i.length-1]&&(i+="/"):i="",i+e)}}),define("app/sequencer/sequencePreload",["require","underscore","utils/preloader","app/task/build_url"],function(e){function t(e){n.isUndefined(e.image)||i.add(a(e.image,"image"),"image"),n.isUndefined(e.template)||i.add(a(e.template,"template"),"template")}function r(e){n.each(e.mediaSets||[],t),n.each(e.stimulusSets||[],o),n.each(e.trialSets||[],u),c(e.sequence)}var n=e("underscore"),i=e("utils/preloader"),a=e("app/task/build_url"),o=function(e){e.media&&t(e.media)},s=function(e){e.element&&t(e.element)},u=function(e){n.each(e.layout||[],o),n.each(e.stimuli||[],o),n.each(e.input||[],s)},c=function(e){n.each(e,function(e){n.isUndefined(e.mixer)?u(e):c(e.data)})};return function(e,n,a){switch(a&&i.reset(),n){case"media":t(e);break;case"stimulus":o(e);break;case"trial":u(e);break;case"script":default:r(e)}return i.activate()}}),define("app/task/parser",["require","underscore","app/task/script","../sequencer/database","../sequencer/sequenceGoto","../sequencer/taskSequence","../sequencer/sequencePreload"],function(e){var t=e("underscore"),r=e("app/task/script"),n=e("../sequencer/database"),i=e("../sequencer/sequenceGoto"),a=e("../sequencer/taskSequence"),o=e("../sequencer/sequencePreload");return function(){var e=r();if(n.createColl("trial"),n.createColl("stimulus"),n.createColl("media"),n.add("trial",e.trialSets||[]),n.add("stimulus",e.stimulusSets||[]),n.add("media",e.mediaSets||[]),!t.isArray(e.sequence))throw new Error("You must set a sequence array.");var s=n.sequence("trial",e.sequence);return s.go=i,a(s),o(e)}}),define("utils/pubsub",["require","underscore"],function(e){var t=e("underscore"),r={},n={},i={};return r.publish=function(e,i){n[e]&&t.each(n[e],function(e){e.apply(r,i||[])})},r.subscribe=function(e,r){var a;return t.isFunction(r)?a=[]:(a=arguments[1],r=arguments[2]),n[e]||(n[e]={},i[e]=0),n[e][i[e]++]=r,a.push([e,r]),[e,r]},r.unsubscribe=function(e){var r=e[0];n[r]&&t.each(n[r],function(t,i){t==e[1]&&delete n[r][i]})},r}),define("utils/interface/bindings/click",["require","jquery"],function(e){var t=e("jquery");return function(e,r){var n="mousedown.interface touchstart.interface",i=!!r.element&&t(r.element);e.on=function(e){function a(t){e(t,n)}this.activateCallback=a,i?i.css(r.css||{}).appendTo("#canvas").on(n,a):t(document).on(n,'[data-handle="'+r.stimHandle+'"]',a)},e.off=function(){i?i.remove():t(document).off(n,'[data-handle="'+r.stimHandle+'"]',this.activateCallback)}}}),define("utils/interface/bindings/mouseEvents",["require","jquery"],function(e){function t(e,t,i){t.on=function(t){function a(r){t(r,e)}n(document).on(r(e),'[data-handle="'+i.stimHandle+'"]',a)},t.off=function(){n(document).off(r(e),'[data-handle="'+i.stimHandle+'"]')}}function r(e){return e.split(" ").map(function(e){return e+".interface"}).join(" ")}var n=e("jquery");return t}),define("utils/interface/bindings/keypressed",["require","jquery"],function(e){var t=e("jquery"),r=[];t(document).on("keyup.keypressed",function(e){r[e.which]=!1});var n=function(e){var n=t.isArray(e.key)?e.key:[e.key],i="keydown.interface."+e.handle,a=t.map(n,function(e){return"string"==typeof e?e.toUpperCase().charCodeAt(0):e});this.on=function(e){t(document).on(i,function(n){n.stopPropagation(),r[n.which]||t.inArray(n.which,a)==-1||(r[n.which]=!0,e(n,"keydown"))})},this.off=function(){t(document).off(i)}};return function(e,r){t.extend(e,new n(r))}}),define("utils/interface/bindings/keyup",["require","jquery"],function(e){var t=e("jquery"),r=function(e){var r=t.isArray(e.key)?e.key:[e.key],n="keyup.interface."+e.handle,i=t.map(r,function(e){return"string"==typeof e?e.toUpperCase().charCodeAt(0):e});this.on=function(e){t(document).on(n,function(r){
t.inArray(r.which,i)!==-1&&e(r,"keyup")})},this.off=function(){t(document).off(n)}};return function(e,n){t.extend(e,new r(n))}}),define("utils/timeout",["require","underscore"],function(e){var t=e("underscore");return function(){var e=arguments[0],r=t.isArray(arguments[1])?arguments[1]:[],n=t.isFunction(arguments[1])?arguments[1]:arguments[2],i=0;return e?(i=setTimeout(n,e),r.push(i)):n.call(),i}}),define("utils/simpleRandomize",["require","underscore"],function(e){function t(e,t){if(r.isArray(e)){var n=Math.floor(Math.random()*e.length);return e[n]}if(r.isFunction(e))return e.call(t);if(r.isPlainObject(e)){if(!r.isNumber(e.min)||!r.isNumber(e.max)||e.min>e.max)throw new Error("randomization objects need both a max and a minimum property, also max has to be larger than min");return e.min+(e.max-e.min)*Math.random()}return e}var r=e("underscore");return t}),define("utils/interface/bindings/timeout",["require","utils/timeout","utils/simpleRandomize"],function(e){var t=e("utils/timeout"),r=e("utils/simpleRandomize");return function(e,n){var i=function(){var e,i=r(n.duration)||0;return{on:function(r){e=t(i,function(){r({},"timeout")})},off:function(){clearTimeout(e)}}}();e.on=i.on,e.off=i.off}}),define("utils/interface/binder",["require","jquery","./bindings/click","./bindings/mouseEvents","./bindings/keypressed","./bindings/keyup","./bindings/timeout"],function(e){var t=e("jquery"),r=e("./bindings/click"),n=e("./bindings/mouseEvents"),i=e("./bindings/keypressed"),a=e("./bindings/keyup"),o=e("./bindings/timeout");return function(e,s){var u=s.on;if("function"==typeof u){if(e.on=s.on,e.off=s.off,"function"!=typeof e.off)throw new Error("Interface off is not a function for "+s.handle);return!0}switch(u){case"keypressed":i(e,s);break;case"keyup":a(e,s);break;case"click":r(e,s);break;case"mouseup":n("mouseup touchend",e,s);break;case"mousedown":n("mousedown touchstart",e,s);break;case"mouseenter":n("mouseenter",e,s);break;case"mouseleave":n("mouseleave",e,s);break;case"timeout":o(e,s);break;case"enter":i(e,t.extend({key:13},s));break;case"space":i(e,t.extend({key:32},s));break;case"esc":i(e,t.extend({key:27},s));break;case"leftTouch":s.element=t("<div>").css({position:"absolute",left:0,width:"30%",height:"100%",background:"#00FF00",opacity:.3}).css(s.css||{}),r(e,s);break;case"rightTouch":s.element=t("<div>").css({position:"absolute",right:0,width:"30%",height:"100%",background:"#00FF00",opacity:.3}).css(s.css||{}),r(e,s);break;case"topTouch":s.element=t("<div>").css({position:"absolute",top:0,width:"100%",height:"30%",background:"#00FF00",opacity:.3}).css(s.css||{}),r(e,s);break;case"bottomTouch":s.element=t("<div>").css({position:"absolute",bottom:0,width:"100%",height:"30%",background:"#00FF00",opacity:.3}).css(s.css||{}),r(e,s);break;default:throw new Error('You have an input element without a recognized "on" property: '+u)}return!0}}),define("utils/interface/triggerEvent",["require","utils/pubsub"],function(e){var t=e("utils/pubsub");return function(e,r,n,i){var a={timestamp:+new Date,latency:i,handle:n.handle,type:r,e:e};t.publish("input",[a])}}),define("utils/interface/listener",["require","./binder","./triggerEvent"],function(e){function t(e,t){this.handle=e.handle,r(this,e),this.on(function(r,i){n(r,i,e,t.getLatency())}),this.destroy=this.off}var r=e("./binder"),n=e("./triggerEvent");return t}),define("utils/is_touch",[],function(){return"ontouchstart"in window}),define("utils/interface/now",[],function(){var e;return window.performance&&(e=performance.now||performance.mozNow||performance.webkitNow||performance.msNow||performance.oNow),e?function(){return e.apply(performance)}:function(){return+new Date}}),define("utils/interface/interface",["require","underscore","./listener","../is_touch","./now"],function(e){var t=e("underscore"),r=e("./listener"),n=e("../is_touch"),i=e("./now"),a=[],o=0;return{getLatency:function(){return i()-o},resetTimer:function(){o=i()},add:function(e){if(!e)throw new Error("Missing input element. Could not add input listener");var i=this,o=t.isArray(e)?e:[e];t.forEach(o,function(e){if(!t.isUndefined(e.touch)){if(n&&!e.touch)return!0;if(!n&&e.touch)return!0}var o=new r(e,i);a.push(o)})},remove:function(e){e=t.isArray(e)?e:[e];for(var r=a.length-1;r>=0;r--){var n=a[r];t.indexOf(e,n.handle)!=-1&&(n.off(),a.splice(r,1))}},destroy:function(){t.invoke(a,"destroy"),a=[]}}}),define("models/model",["require","underscore","backbone"],function(e){var t=e("underscore"),r=e("backbone");"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t});var n=r.Model.extend({constructor:function(e,n){var i={};t.each(e,function(e,r){if(t.isObject(e)){var n=Object.create(e),a=this.defaults&&this.defaults[r]&&t.isObject(this.defaults[r])?this.defaults[r]:{};i[r]=t.defaults(n,a)}else i[r]=e},this),r.Model.apply(this,[i,n])}});return n}),define("app/media/media_view",["require","backbone","underscore","app/task/main_view"],function(e){Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t){var r=e[t];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var n=0;window.requestAnimationFrame=function(e){var t=Date.now(),r=Math.max(n+16,t);return setTimeout(function(){e(n=r)},r-t)},window.cancelAnimationFrame=clearTimeout}}();var t=e("backbone"),r=e("underscore"),n=e("app/task/main_view"),i=n.$el,a=t.View.extend({initialize:function(e){this.options=e||{},this.$el.addClass("stimulus").attr("data-handle",this.model.handle).css("visibility","hidden").css(this.model.get("css")).appendTo(i),this.render()},render:function(){return this.size(),this.deferToLoad(this.place),this},deferToLoad:function(e){e=r.bind(e,this),this.$el.width()?e():r.defer(function(){window.requestAnimationFrame(e)})},show:function(){return"image"===this.options.type&&this.options.image.indexOf("gif")!==-1?(window.ActiveXObject||"ActiveXObject"in window?(this.$el.css("visibility","visible"),this.$el[0].src=this.options.image+"#"+Math.random()):(this.$el[0].src="",this.$el[0].src=this.options.image,this.$el.css("visibility","visible")),this):(this.deferToLoad(function(){this.$el.css("visibility","visible")}),this)},hide:function(){return this.$el.css("visibility","hidden"),this},size:function(){var e=this.model.get("size");return e.font_size&&this.$el.css("font-size",e.font_size),"auto"!=e.height&&"word"!=this.options.type&&this.$el.height(e.height+"%"),"auto"!=e.width&&this.$el.width(e.width+"%"),this},place:function(){function e(e){return{height:e.innerHeight(),width:e.innerWidth()}}var t,r,n,a,o=e(i),s=e(this.$el),u=this.model.get("location")||{};switch("undefined"==typeof u.top&&"undefined"==typeof u.bottom&&(u.top="center"),"undefined"==typeof u.left&&"undefined"==typeof u.right&&(u.right="center"),u.top){case void 0:case"auto":t="auto";break;case"center":t=(o.height-s.height)/2;break;default:t=o.height*u.top/100}switch(u.bottom){case void 0:case"auto":r="auto";break;case"center":r=(o.height-s.height)/2;break;default:r=o.height*u.bottom/100}switch(u.left){case void 0:case"auto":n="auto";break;case"center":n=(o.width-s.width)/2;break;default:n=o.width*u.left/100}switch(u.right){case void 0:case"auto":a="auto";break;case"center":a=(o.width-s.width)/2;break;default:a=o.width*u.right/100}this.$el.css({top:t,bottom:r,left:n,right:a})}});return a}),define("utils/html",["require","jquery","utils/preloader","../app/task/build_url"],function(e){function t(e){var t=e.html||e.inlineTemplate||e.template;if(e.word)e.displayType="element",e.type="word",e.el=r("<div>",{text:e.word});else if(e.image)e.displayType="element",e.type="image",e.el=n.getImage(i(e.image,"image"));else if(e.jquery)e.displayType="element",e.type="jquery",e.el=e.jquery;else{if(!t)return!1;e.displayType="element",e.type="html";try{e.el=r(t)}catch(e){throw new Error("HTML must be wrapped in an html element such as <span></span>. "+t+" is invalid")}}}var r=e("jquery"),n=e("utils/preloader"),i=e("../app/task/build_url");return t}),define("app/global",["require","underscore"],function(e){function t(e,i){return i?n=e:(r.isPlainObject(e)&&(r.each(function(e,r){console.warn&&t[r]&&console.warn('Overwriting "'+r+'" in global object.')}),r.merge(n,e)),n)}window.piGlobal||(window.piGlobal={});var r=e("underscore"),n=window.piGlobal;return t}),define("app/media/media_constructor",["require","underscore","./media_view","utils/html","app/global"],function(e){function t(e,t){if(!e)throw new Error("Media object not defined for "+t.name());return e.source=r.cloneDeep(e),e.model=t,i(e,{global:a(),trialData:t.trial.data,stimulusData:t.get("data")}),new n(e)}var r=e("underscore"),n=e("./media_view"),i=e("utils/html"),a=e("app/global");return t}),define("app/stimulus/stimulus_model",["require","models/model","app/media/media_constructor","utils/pubsub","underscore","utils/is_touch","app/task/settings"],function(e){var t=e("models/model"),r=e("app/media/media_constructor"),n=e("utils/pubsub"),i=e("underscore"),a=e("utils/is_touch"),o=e("app/task/settings"),s=t.extend({initialize:function(){var e=this.attributes;this.collection.trial&&(this.trial=this.collection.trial),e.data=e.data||{},e.data.handle=e.data.handle||e.handle||e.set,this.handle=e.data.handle;var t=a&&this.get("touchMedia")?this.get("touchMedia"):this.get("media");this.media=new r(t,this)},defaults:{size:{height:"auto",width:"auto"},css:{}},activate:function(){var e=this,t=this.handle;this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],n.subscribe("stim:start",e.pubsubStack,function(r){return!!i.include([t,"All"],r)&&void e.media.show()}),n.subscribe("stim:setAttr",e.pubsubStack,function(r,n){if(!i.include([t,"All"],r))return!1;if(i.isFunction(n))n.apply(e);else{var a=e.get("data")||{};a=i.extend(a,n),e.set("data",a)}}),n.subscribe("stim:stop",e.pubsubStack,function(r){return!!i.include([t,"All"],r)&&void e.media.hide()})},disable:function(){this.media.hide(),this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],i.each(this.pubsubStack,function(e){n.unsubscribe(e)}),this.timeStack=[],this.pubsubStack=[]},name:function(){var e=this.attributes;return e.alias?e.alias:e.data.alias?e.data.alias:e.inherit&&e.inherit.set?e.inherit.set:e.handle?e.handle:"Anonymous Stimulus"},mediaName:function(){var e=this.media.options,t=o.logger&&o.logger.fullpath;if(e.alias)return e.alias;for(var r in e){if(i.contains(["image","template"],r))return t?e[r]:e[r].replace(/^.*[\\\/]/,"");if(i.contains(["word","html","inlineTemplate"],r)&&e[r])return e[r]}}});return s}),define("app/stimulus/stimulus_constructor",["require","./stimulus_model"],function(e){var t=e("./stimulus_model");return function(e,r){var n=e;return n.source=e,new t(n,r)}}),define("app/stimulus/stimulus_collection",["require","underscore","backbone","app/stimulus/stimulus_constructor"],function(e){var t=e("underscore"),r=e("backbone"),n=e("app/stimulus/stimulus_constructor"),i=r.Collection.extend({model:n,initialize:function(e,t){t||(t={}),this.trial=t.trial},whereData:function(e){return t.isEmpty(e)?[]:this.filter(function(t){var r=t.get("data")||{};for(var n in e)if(e[n]!==r[n])return!1;return!0})},activate:function(){return this.each(function(e){e.activate()}),this},disable:function(){return this.each(function(e){e.disable()}),this},display_all:function(){this.each(function(e){e.media.show()})},hide_all:function(){this.each(function(e){e.media.hide()})},refresh:function(){this.each(function(e){e.media.render()})},get_stimlist:function(){return this.chain().filter(function(e){return!e.get("nolog")}).map(function(e,t){return e.name()||"stim"+t}).value()},get_medialist:function(){return this.chain().filter(function(e){return!e.get("nolog")}).map(function(e,t){return e.mediaName()||"media"+t}).value()}});return i}),define("app/trial/evaluate",["require","underscore","app/global","./current_trial"],function(e){var t=e("underscore"),r=e("app/global"),n=e("./current_trial");return function(e,i){var a=r(),o=a.current||{},s=n();if(!e)throw new Error("There is an interaction without conditions!!");e=t.isArray(e)?e:[e],i=i||{};var u=!0;if("begin"==i.type){var c=t.reduce(e,function(e,t){return e||"begin"==t.type},!1);if(!c)return!1}return t.each(e,function(e){var r,n,c=!0;switch(e.type){case"begin":"begin"!==i.type&&(c=!1);break;case"inputEquals":t.isArray(e.value)||(e.value=[e.value]),t.indexOf(e.value,i.handle)===-1&&(c=!1);break;case"inputEqualsTrial":i.handle!==s.data[e.property]&&(c=!1);break;case"inputEqualsStim":r={},e.handle&&(r.handle=e.handle),r[e.property]=i.handle,n=s._stimulus_collection.whereData(r),0===n.length&&(c=!1);break;case"trialEquals":if("undefined"==typeof e.property||"undefined"==typeof e.value)throw new Error('trialEquals requires both "property" and "value" to be defined');e.value!==s.data[e.property]&&(c=!1);break;case"inputEqualsGlobal":if("undefined"==typeof e.property)throw new Error('inputEqualsGlobal requires "property" to be defined');i.handle!==a[e.property]&&(c=!1);break;case"globalEquals":if("undefined"==typeof e.property||"undefined"==typeof e.value)throw new Error('globalEquals requires both "property" and "value" to be defined');e.value!==a[e.property]&&(c=!1);break;case"globalEqualsTrial":if("undefined"==typeof e.globalProp||"undefined"==typeof e.trialProp)throw new Error('globalEqualsTrial requires both "globalProp" and "trialProp" to be defined');a[e.globalProp]!==s.data[e.trialProp]&&(c=!1);break;case"globalEqualsStim":if("undefined"==typeof e.globalProp||"undefined"==typeof e.stimProp)throw new Error('globalEqualsStim requires both "globalProp" and "stimProp" to be defined');r={},e.handle&&(r.handle=e.handle),r[e.stimProp]=a[e.globalProp],n=s._stimulus_collection.whereData(r),0===n.length&&(c=!1);break;case"inputEqualsCurrent":if("undefined"==typeof e.property)throw new Error('inputEqualsCurrent requires "property" to be defined');i.handle!==o[e.property]&&(c=!1);break;case"currentEquals":if("undefined"==typeof e.property||"undefined"==typeof e.value)throw new Error('currentEquals requires both "property" and "value" to be defined');e.value!==o[e.property]&&(c=!1);break;case"currentEqualsTrial":if("undefined"==typeof e.currentProp||"undefined"==typeof e.trialProp)throw new Error('currentEqualsTrial requires both "currentProp" and "trialProp" to be defined');o[e.currentProp]!==s.data[e.trialProp]&&(c=!1);break;case"currentEqualsStim":if("undefined"==typeof e.currentProp||"undefined"==typeof e.stimProp)throw new Error('currentEqualsStim requires both "currentProp" and "stimProp" to be defined');r={},e.handle&&(r.handle=e.handle),r[e.stimProp]=o[e.currentProp],n=s._stimulus_collection.whereData(r),0===n.length&&(c=!1);break;case"function":e.value.apply(s,[e,i,s])||(c=!1);break;case"custom":e.fn.apply(null,[e,i,s])||(c=!1);break;default:throw new Error("Unknown condition type: "+e.type)}u=u&&(e.negate?!c:c)}),u}}),define("app/trial/action_list",["require","underscore","jquery","utils/pubsub","utils/interface/interface","app/global","app/task/main_view","app/task/canvasConstructor","app/trial/current_trial"],function(e){var t=e("underscore"),r=e("jquery"),n=e("utils/pubsub"),i=e("utils/interface/interface"),a=e("app/global"),o={showStim:function(e){var t=e.handle||e;n.publish("stim:start",[t])},hideStim:function(e){var t=e.handle||e;n.publish("stim:stop",[t])},setStimAttr:function(e){var t=e.handle,r=e.setter;n.publish("stim:setAttr",[t,r])},setTrialAttr:function(e,t){if("undefined"==typeof e.setter)throw new Error("The setTrialAttr action requires a setter property");n.publish("trial:setAttr",[e.setter,t])},setInput:function(e){if("undefined"==typeof e.input)throw new Error("The setInput action requires an input property");n.publish("trial:setInput",[e.input])},trigger:function(e){if("undefined"==typeof e.handle)throw new Error("The trigger action requires a handle property");n.publish("trial:setInput",[{handle:e.handle,on:"timeout",duration:e.duration||0}])},removeInput:function(e){if("undefined"==typeof e.handle)throw new Error("The removeInput action requires a handle property");n.publish("trial:removeInput",[e.handle])},goto:function(e){n.publish("trial:goto",[e])},endTrial:function(){n.publish("trial:end")},resetTimer:function(e,t){t.latency=0,i.resetTimer()},log:function(e,t){n.publish("log",[e,t])},setGlobalAttr:function(e){switch(typeof e.setter){case"function":e.setter.apply(null,[a(),e]);break;case"object":t.extend(a(),e.setter);break;default:throw new Error('setGlobalAttr requires a "setter" property')}},custom:function(e,t){if("function"!=typeof e.fn)throw new Error("The custom action requires a fn propery");e.fn.apply(null,[e,t,a()])},canvas:function(n){var i=e("app/task/main_view").$el,a=e("app/task/canvasConstructor"),o=e("app/trial/current_trial")(),s={background:{element:r("body"),property:"backgroundColor"},canvasBackground:{element:i,property:"backgroundColor"},borderColor:{element:i,property:"borderColor"},borderWidth:{element:i,property:"borderWidth"}},u=a(s,t.pick(n,["background","canvasBackground","borderColor","borderWidth"]));o.deferred.promise().always(u)}};return o}),define("app/trial/action",["require","underscore","./action_list"],function(e){function t(e,t){var i=!0;if(!e)throw new Error("There is an interaction without actions!!");return e=r.isArray(e)?e:[e],r.forEach(e,function(e){var r=n[e.type];if(!r)throw new Error("unknown action: "+e.type);"endTrial"===e.type&&(i=!1),r(e,t)}),i}var r=e("underscore"),n=e("./action_list");return t}),define("app/trial/interactions",["require","jquery","utils/pubsub","./evaluate","./action","app/trial/current_trial"],function(e){function t(e,t){var n=o();r.extend(t,{trialId:n._id,trialCounter:n.counter}),r.each(e,function(e,r){if(i(r.conditions,t))return a(r.actions,t)})}var r=e("jquery"),n=e("utils/pubsub"),i=e("./evaluate"),a=e("./action"),o=e("app/trial/current_trial"),s=[];return{activate:function(e){n.subscribe("input",s,function(r){t(e,r)}),t(e,{type:"begin",latency:0})},disable:function(){r.each(s,function(){n.unsubscribe(this)})}}}),define("app/trial/trial_constructor",["require","jquery","underscore","utils/pubsub","utils/interface/interface","app/stimulus/stimulus_collection","./interactions","./current_trial","app/task/main_view"],function(e){function t(e){if(this.data||(this.data=e.data||{}),this._source=e,this._id=i.uniqueId("trial_"),this.counter=d++,!e.interactions)throw new Error("Interactions not defined");this._layout_collection=new s(r(e.layout),{trial:this}),this._stimulus_collection=new s(r(e.stimuli),{trial:this}),this._pubsubStack=[],this._next=["next",{}],this.deferred=n.Deferred()}function r(e){return e?i.isArray(e)?e:[e]:[]}var n=e("jquery"),i=e("underscore"),a=e("utils/pubsub"),o=e("utils/interface/interface"),s=e("app/stimulus/stimulus_collection"),u=e("./interactions"),c=e("./current_trial"),l=e("app/task/main_view"),d=0;return i.extend(t.prototype,{activate:function(){var e=this;return c(this),this._layout_collection.display_all(),a.subscribe("trial:end",this._pubsubStack,i.bind(this.deactivate,this)),a.subscribe("trial:setAttr",this._pubsubStack,function(t,r){i.isFunction(t)?t.apply(e,[e.data,r]):i.extend(e.data,t)}),a.subscribe("trial:setInput",this._pubsubStack,function(e){o.add(e)}),a.subscribe("trial:removeInput",this._pubsubStack,function(e){"All"==e||i.include(e,"All")?o.destroy():o.remove(e)}),a.subscribe("trial:goto",this._pubsubStack,function(t){e._next=[t.destination,t.properties||{}]}),o.add(r(this._source.input)),this._stimulus_collection.activate(),o.resetTimer(),u.activate(this._source.interactions),this.deferred.promise()},deactivate:function(){var e=this;o.destroy(),this._stimulus_collection.disable(),u.disable(),i.each(this._pubsubStack,function(e){a.unsubscribe(e)}),this._pubsubStack=[],c(void 0),document.all&&!document.addEventListener?setTimeout(function(){l.empty(),e.deferred.resolve(e._next[0],e._next[1])},1):(l.empty(),e.deferred.resolve(e._next[0],e._next[1]))},name:function(){return this.alias?this.alias:this.data.alias?this.data.alias:i.isString(this._source.inherit)?this._source.inherit:!!i.isPlainObject(this._source.inherit)&&this._source.inherit.set}}),t}),define("app/task/log/post",["require","jquery","underscore","app/task/settings"],function(e){function t(e){var t=i(),a=n.get(t,"logger.url"),o=r.Deferred();if(!a)return o.resolve();var s={json:JSON.stringify(e)||""};return r.extend(s,t.metaData||{}),o=r.post(a,s),o=o.then(null,function(){return r.post(a,s).then(null,n.get(t,"logger.error"))})}var r=e("jquery"),n=e("underscore"),i=e("app/task/settings");return window._=n,t}),define("app/task/log/log_stack",["require","app/global"],function(e){var t=e("app/global");return function(){return t().current.logs}}),define("app/task/log/logger",["require","jquery","underscore","utils/pubsub","app/trial/current_trial","app/task/settings","./post","./log_stack"],function(e){function t(e,t,r,n){var i=this._stimulus_collection.get_stimlist(),a=this._stimulus_collection.get_medialist();return{log_serial:n.length,trial_id:this.counter,name:this.name(),responseHandle:t.handle,latency:Math.floor(t.latency),stimuli:i,media:a,data:e}}function r(){var e,t=c();return t.length-l<=0?d:(e=t.slice(l,t.length),l=t.length,n.when(d,u(e)))}var n=e("jquery"),i=e("underscore"),a=e("utils/pubsub"),o=e("app/trial/current_trial"),s=e("app/task/settings"),u=e("./post"),c=e("./log_stack"),l=0,d=n.Deferred().resolve();return a.subscribe("log",function(e,r){var i=c(),a=s().logger||{},u=a.logger?a.logger:t,l=o(),d=u.apply(l,[l.data,r,e,i]);if(a.meta){if(!n.isPlainObject(a.meta))throw new Error("LOGGER: logger.meta must be an object but instead was a "+typeof a.meta);n.extend(d,a.meta)}i.push(d)}),a.subscribe("log:send",function(){var e=c(),t=i.get(s(),"logger.pulse",0);t&&e.length-l>=t&&r()}),r}),define("app/sequencer/inflateTrial",["require","underscore","../global","./taskSequence","./database","../task/build_url"],function(e){function t(e,t){var r,s=o(),u=a(),c={global:u,current:u.current};if(s.go(e,t,c),r=s.current(c,{skip:["layout","stimuli"]}))return r.stimuli=i.map(r.stimuli||[],n,c),r.layout=i.map(r.layout||[],n,c),c.trialData=null,r}function r(e,t,r){var n=e[t];return!!n&&(i.isString(n)&&(e[t]=n={word:n}),n=s.inflate("media",n,r),n.template&&(n.inlineTemplate=requirejs("text!"+u(n.template,"template")),n.inlineTemplate=i.template(n.inlineTemplate)(r)),e[t]=n,r.mediaData=null,void(r.mediaMeta=null))}function n(e){var t=this;return e=s.inflate("stimulus",e,t,{skip:["media","touchMedia"]}),r(e,"media",t),r(e,"touchMedia",t),t.stimulusData=null,t.stimulusMeta=null,e}var i=e("underscore"),a=e("../global"),o=e("./taskSequence"),s=e("./database"),u=e("../task/build_url");return t}),define("app/sequencer/player",["require","jquery","app/trial/trial_constructor","app/task/log/logger","app/task/settings","utils/pubsub","app/task/main_view","./inflateTrial"],function(e){function t(e,c){var l,d=u(e,c);d?(l=new n(d),l.activate().done(function(){o.publish("log:send"),t.apply(null,arguments)}),o.publish("trial:activated",[l])):i().always(function(){var e=a("hooks")||{},t=e.endTask||a("onEnd")||r.noop;return r.when(t())}).always(function(){s.deferred.resolve()})}var r=e("jquery"),n=e("app/trial/trial_constructor"),i=e("app/task/log/logger"),a=e("app/task/settings"),o=e("utils/pubsub"),s=e("app/task/main_view"),u=e("./inflateTrial");return t}),define("activatePIP",["require","underscore","app/task/script","app/task/main_view","app/task/parser","app/sequencer/player","app/global","app/trial/current_trial"],function(e){function t(e,t){var c=s(s()),l=e.name||"anonymous PIP";c[l]=c.current=r.isPlainObject(e.current)?e.current:{},c.current.logs||(c.current.logs=[]),n(e);var d=a();return i.activate().done(function(){i.loading(d).done(function(){i.empty(),o("next",{})}).fail(function(e){throw new Error("loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - "+e+")")})}),i.deferred.promise().then(function(){var e=u();e&&(e._next=["end",{}],e.deactivate())}).then(t||function(){var t=e.settings&&e.settings.redirect;window.location.href=t||window.location.href})}var r=e("underscore"),n=e("app/task/script"),i=e("app/task/main_view"),a=e("app/task/parser"),o=e("app/sequencer/player"),s=e("app/global"),u=e("app/trial/current_trial");return t}),define("pipScorer/computeD",["require","jquery"],function(e){function t(){r.extend(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}var r=e("jquery");return r.extend(t.prototype,{setComputeObject:function(e){r.extend(this,e)},setDataArray:function(){var e=window.piGlobal;this.dataArray=e.current.logs}}),t}),define("pipScorer/msgMan",["require","underscore"],function(e){function t(){this.messages=r.extend({},n)}var r=e("underscore"),n={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return r.extend(t.prototype,{setMsgObject:function(e){r.extend(this.messages,e)},getScoreMsg:function(e){var t=this.messages.MessageDef;if(!t||!t.length)throw new Error('You must define a "MessageDef" array.');var n=parseFloat(e),i=null,a=null,o="error: msg was not set",s=!1;if(r.each(t,function(e){i=parseFloat(e.cut),a=e.message,n<=i&&!s&&(o=a,s=!0)}),!s){var u=t.length,c=t[u-1];o=c.message}return o},getMessage:function(e){return this.messages[e]}}),t}),define("pipScorer/parcelMng",["require","underscore"],function(e){function t(e){this.parcelArray=[],this.scoreData={},this.msgMan=e}var r=e("underscore");return r.extend(t.prototype,{Init:function(e){var t=this,n=this.msgMan,i=window.piGlobal,a=i.current.logs;t.parcelArray=[],t.scoreData={},t.msgMan=n;var o=e.AnalyzedVar,s=e.ErrorVar,u=e.parcelVar,c=e.parcelValue,l=e.minRT,d=e.maxRT,p=e.fastRT,f=0,h=0,m=0,b=0,g=parseFloat(e.maxFastTrialsRate);if("undefined"==typeof c||0===c.length){m=0,f=0,h=0,b=0;var v={};v.name="general",v.trialIData=[],r.each(a,function(r){r[o]>=l&&r[o]<=d?(m++,1==r.data[s]&&b++,t.validate(v,r,e)&&f++):r[o]<=p&&h++}),t.checkErrors(m,b,e),t.parcelArray[0]=v}else r.each(c,function(n,i){m=0,f=0,h=0,b=0;var c={};c.name=n,c.trialIData=[],r.each(a,function(r){var i=r.data[u];i==n&&(r[o]>=l&&r[o]<=d?(m++,1==r.data[s]&&b++,t.validate(c,r,e)&&f++):r[o]<=p&&h++)}),t.checkErrors(m,b,e),t.parcelArray[i]=c});h/f>g&&(t.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(e,t,r){var n=r.maxErrorParcelRate;t/e>n&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(e,t,r){var n=r.errorLatency,i=r.ErrorVar,a=t.data;return"latency"==n.use?(e.trialIData.push(t),!0):"false"==n.use?"1"!=a[i]&&(e.trialIData.push(t),!0):"penalty"==n.use?(e.trialIData.push(t),!0):void 0},addPenalty:function(e,t){var n=t.errorLatency,i=this;if("penalty"==n.use){var a=parseFloat(n.penalty),o=t.ErrorVar,s=t.AnalyzedVar,u=t.condVar,c=t.cond1VarValues,l=t.cond2VarValues,d=e.trialIData,p=e.avgCon1,f=e.avgCon2;r.each(d,function(e){var t=e.data,r=t[o],n=t[u],d=i.checkArray(n,c),h=i.checkArray(n,l);"1"==r&&(d?e[s]+=p+a:h&&(e[s]+=f+a))})}},avgAll:function(e){var t=this;r.each(t.parcelArray,function(r){t.avgParcel(r,e)})},avgParcel:function(e,t){var n=this,i=e.trialIData,a=t.condVar,o=t.cond1VarValues,s=t.cond2VarValues,u=t.AnalyzedVar,c=0,l=0,d=0,p=0,f=0,h=0;r.each(i,function(e){var t=e[u],r=e.data;d+=t,h++;var i=r[a],m=n.checkArray(i,o),b=n.checkArray(i,s);m?(p++,c+=t):b&&(f++,l+=t)}),(p<=2||f<=2)&&(n.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==p&&(c/=p),0!==f&&(l/=f),e.avgCon1=c,e.avgCon2=l,e.diff=e.avgCon1-e.avgCon2,0!==h&&(e.avgBoth=d/h),n.addPenalty(e,t)},checkArray:function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n==e)return!0}return!1},varianceAll:function(e){var t=this;r.each(t.parcelArray,function(r){t.varianceParcel(r,e)})},varianceParcel:function(e,t){var n=this,i=t.AnalyzedVar,a=e.trialIData,o=t.cond1VarValues,s=t.cond2VarValues,u=t.condVar,c=e.avgBoth,l=0,d=0,p=[],f=[],h=[],m=t.errorLatency,b=m.useForSTD;r.each(a,function(e){var r=e.data,a=e[i],c=t.ErrorVar,l=r[c],d=r[u],h=n.checkArray(d,o),m=n.checkArray(d,s);h?b?p.push(a):"0"==l&&p.push(a):m&&(b?f.push(a):"0"==l&&p.push(a))}),h=p.concat(f),r.each(h,function(e){var t=e;l=t-c,d+=l*l}),e.variance=d/(h.length-1)},scoreAll:function(e){var t=this,n=0;r.each(t.parcelArray,function(r){t.scoreParcel(r,e),n+=r.score});var i=n/t.parcelArray.length;t.scoreData.score=i.toFixed(2)},scoreParcel:function(e){var t=this,r=Math.sqrt(e.variance);0===r?(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),e.score=e.diff):e.score=e.diff/r}}),t}),define("pipScorer/Scorer",["require","jquery","./computeD","./msgMan","./parcelMng"],function(e){function t(){this.computeData=new n,this.msgMan=new i,this.parcelMng=new a(this.msgMan)}var r=e("jquery"),n=e("./computeD"),i=e("./msgMan"),a=e("./parcelMng");return window.console||(window.console={log:r.noop,error:r.noop}),r.extend(t.prototype,{addSettings:function(e,t){switch(e){case"compute":this.computeData.setComputeObject(t);break;case"message":this.msgMan.setMsgObject(t);break;default:throw new Error('SCORER:addSettings: unknow "type" '+e)}},computeD:function(){var e=this.computeData,t=this.parcelMng;e.setDataArray(),t.Init(e),t.avgAll(e),t.varianceAll(e),t.scoreAll(e);var r=t.scoreData;return void 0===r.errorMessage||null===r.errorMessage?{FBMsg:this.getFBMsg(r.score),DScore:r.score,error:!1}:{FBMsg:r.errorMessage,DScore:"",error:!0}},postToServer:function(e,t,n,i){var a=this.computeData.postSettings||{},o=a.url,s={};return n||(n=a.score),i||(i=a.msg),s[n]=e,s[i]=t,r.post(o,JSON.stringify(s))},dynamicPost:function(e){var t=this.computeData.postSettings||{},n=t.url;return r.post(n,JSON.stringify(e))},getFBMsg:function(e){var t=this.msgMan.getScoreMsg(e);return t}}),t}),define("pipScorer",["pipScorer/Scorer"],function(e){return e}),define("pipAPI",["require","underscore","jquery"],function(e){function t(e){this.script={global:{},current:{},trialSets:[],stimulusSets:[],mediaSets:[],sequence:[]},this.script.name=e||"anonymous PIP",this.settings=this.script.settings={canvas:{maxWidth:800,proportions:.8},hooks:{}}}function r(e){function t(t,r){var i,a=this.script[e+"Sets"]||(this.script[e+"Sets"]=[]);n.isPlainObject(t)&&(i=n(t).map(function(e,t){return n.each(e,function(e){e.set=t}),e}).flatten().value()),n.isArray(t)&&(i=t),n.isString(t)&&(i=n.isArray(r)?r:[r],i=n.map(i,function(e){return e.set=t,e})),a.push.apply(a,i)}return t}var n=e("underscore");return n.extend(t.prototype,{addTrialSets:r("trial"),addStimulusSets:r("stimulus"),addMediaSets:r("media"),addSettings:function(e,t){var r;return n.isPlainObject(t)?(r=this.settings[e]=this.settings[e]||{},n.extend(r,t)):this.settings[e]=t,this},addSequence:function(e){var t=this.script;return n.isArray(e)||(e=[e]),t.sequence=t.sequence.concat(e),this},addGlobal:function(e){if(!n.isPlainObject(e))throw new Error("global must be an object");n.merge(this.getGlobal(),e)},getGlobal:function(){return window.piGlobal},addCurrent:function(e){if(!n.isPlainObject(e))throw new Error("current must be an object");n.merge(this.script.current,e)},getCurrent:function(){return this.script.current},addScript:function(e){n.merge(this.script,e)},getScript:function(){return this.script},getLogs:function(){return this.script.current.logs},play:function(){throw new Error("you should return API.script instead of calling API.play()!!")},post:function(t,r){var n=e("jquery");
n.post(t,r)},shuffle:function(e){return n.shuffle(e)}}),t});