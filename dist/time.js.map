{"version":3,"file":"time.js","sources":["../node_modules/promise-polyfill/src/finally.js","../node_modules/promise-polyfill/src/allSettled.js","../node_modules/promise-polyfill/src/index.js","../node_modules/promise-polyfill/src/polyfill.js","../src/polyfills.js","../src/app/global.js","../src/app/task/sequencer/sequenceGoto.js","../node_modules/fastdom/fastdom.js","../src/app/task/canvas/getSize.js","../src/app/task/canvas/adjust_canvas.js","../src/app/task/canvas/applyCanvasStyles.js","../node_modules/mithril-stream/stream.js","../node_modules/minno-css/css.js","../src/app/setup.js","../src/app/task/canvas/canvasSetup.js","../src/app/task/sequencer/createDB.js","../src/app/task/sequencer/preloader.js","../src/app/task/sequencer/buildUrl.js","../src/app/task/sequencer/scriptPreloader.js","../src/app/trial/input/bindings/mouseEvents.js","../src/app/trial/input/bindings/keypressed.js","../src/app/trial/input/bindings/keyup.js","../src/app/trial/input/now.js","../src/app/trial/input/bindings/timeout.js","../src/app/trial/input/bindings/simpleRandomize.js","../src/app/trial/input/createListener.js","../src/app/trial/input/binder.js","../src/app/trial/input/input.js","../src/app/trial/stimulus/getMedia.js","../src/app/trial/stimulus/setSize.js","../src/app/trial/stimulus/setPlace.js","../src/app/trial/stimulus/setupElement.js","../src/app/trial/stimulus/Stimulus.js","../src/app/trial/stimulus/stimulusCollection.js","../src/app/trial/interactions/getConditionFn.js","../src/app/trial/interactions/conditionsEvaluate.js","../src/app/trial/interactions/actionList.js","../src/app/trial/interactions/interactions.js","../src/app/trial/interactions/action.js","../src/app/trial/Trial.js","../src/app/task/logger/defaultLogMap.js","../src/app/playPhase.js","../src/app/task/logger/createLogStream.js","../src/app/task/sequencer/nextTrial.js","../src/index.js","../src/app/preloadPhase.js"],"sourcesContent":["/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","function allSettled(arr) {\n  var P = this;\n  return new P(function(resolve, reject) {\n    if (!(arr && typeof arr.length !== 'undefined')) {\n      return reject(\n        new TypeError(\n          typeof arr +\n            ' ' +\n            arr +\n            ' is not iterable(cannot read property Symbol(Symbol.iterator))'\n        )\n      );\n    }\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      if (val && (typeof val === 'object' || typeof val === 'function')) {\n        var then = val.then;\n        if (typeof then === 'function') {\n          then.call(\n            val,\n            function(val) {\n              res(i, val);\n            },\n            function(e) {\n              args[i] = { status: 'rejected', reason: e };\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            }\n          );\n          return;\n        }\n      }\n      args[i] = { status: 'fulfilled', value: val };\n      if (--remaining === 0) {\n        resolve(args);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n}\n\nexport default allSettled;\n","import promiseFinally from './finally';\nimport allSettled from './allSettled';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.allSettled = allSettled;\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","import Promise from './index';\nimport promiseFinally from './finally';\nimport allSettled from './allSettled';\n\n/** @suppress {undefinedVars} */\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\n// Expose the polyfill if Promise is undefined or set to a\n// non-function value. The latter can be due to a named HTMLElement\n// being exposed by browsers for legacy reasons.\n// https://github.com/taylorhakes/promise-polyfill/issues/114\nif (typeof globalNS['Promise'] !== 'function') {\n  globalNS['Promise'] = Promise;\n} else if (!globalNS.Promise.prototype['finally']) {\n  globalNS.Promise.prototype['finally'] = promiseFinally;\n} else if (!globalNS.Promise.allSettled) {\n  globalNS.Promise.allSettled = allSettled;\n}\n","import 'promise-polyfill/src/polyfill';\n\n// performance.now polyfill\n(function(w){\n\tvar perfNow;\n\tvar perfNowNames = ['now', 'webkitNow', 'msNow', 'mozNow'];\n\tif(!!w['performance']) for(var i = 0; i < perfNowNames.length; ++i)\n\t{\n\t\tvar n = perfNowNames[i];\n\t\tif(!!w['performance'][n])\n\t\t{\n\t\t\tperfNow = function(){return w['performance'][n]()};\n\t\t\tbreak;\n\t\t}\n\t}\n\tif(!perfNow)\n\t{\n\t\tperfNow = Date.now;\n\t}\n\tw.perfNow = perfNow;\n})(window);\n\n// console.group polyfill\nfunction log(){ console.log.apply(console, arguments); }\nif (!console.group) console.group = log;\nif (!console.groupCollapsed) console.groupCollapsed = log;\nif (!console.groupEnd) console.groupEnd = log;\nif (!console.table) console.table = log;\n\n\n// requestAnimationFrame polyfill\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame']\n            || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n            var now = Date.now();\n            var nextTime = Math.max(lastTime + 16, now);\n            return setTimeout(function() { callback(lastTime = nextTime); },\n                              nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());\n\n/**\n * Element.closest polyfill\n * For IE9 only\n * from https://developer.mozilla.org/en-US/docs/Web/API/Element/closest#browser_compatibility\n **/\nif (!Element.prototype.matches) {\n  Element.prototype.matches =\n    Element.prototype.msMatchesSelector ||\n    Element.prototype.webkitMatchesSelector;\n}\n\nif (!Element.prototype.closest) {\n  Element.prototype.closest = function(s) {\n    var el = this;\n\n    do {\n      if (Element.prototype.matches.call(el, s)) return el;\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n  };\n}\n","export default global;\n\n// initiate piGloabl\nvar glob = window.piGlobal || (window.piGlobal = {});\n\nfunction global(){\n    return glob;\n}\n\n","/**\n * Go to a destination within the sequence (must be a property of a sequence)\n * @param  {String} target destination type\n * @param  {Object} properties destination options\n * @return {Object}        result element\n */\n\nimport _ from 'lodash';\nexport default go;\n\nfunction go(destination, properties, context){\n    var mixerSequence = this.mixerSequence;\n\n    switch (destination){\n        case 'nextWhere':\n            where('next', properties, context, mixerSequence);\n            break;\n        case 'previousWhere':\n            where('prev', properties, context, mixerSequence);\n            break;\n        case 'current':\n            // don't need to do anything...\n            break;\n        case 'first':\n            do {mixerSequence.prev(context);} while (mixerSequence.current(context));\n            break;\n        case 'last':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            mixerSequence.prev();\n            break;\n        case 'end':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            break;\n        case 'next' :\n            mixerSequence.next(context); // get the next trial, in case there are no more trials, returns undefined\n            break;\n        default:\n            throw new Error('Unknow destination \"' + destination + '\" for goto.');\n    }\n\n    return this;\n}\n\nfunction where(direction, properties, context, sequence){\n    var curr;\n\n    do {\n        sequence[direction]();\n        curr = sequence.current(context);\n    } while (curr && !_.iteratee(properties)(curr.data));\n}\n","!(function(win) {\n\n/**\n * FastDom\n *\n * Eliminates layout thrashing\n * by batching DOM read/write\n * interactions.\n *\n * @author Wilson Page <wilsonpage@me.com>\n * @author Kornel Lesinski <kornel.lesinski@ft.com>\n */\n\n'use strict';\n\n/**\n * Mini logger\n *\n * @return {Function}\n */\nvar debug = 0 ? console.log.bind(console, '[fastdom]') : function() {};\n\n/**\n * Normalized rAF\n *\n * @type {Function}\n */\nvar raf = win.requestAnimationFrame\n  || win.webkitRequestAnimationFrame\n  || win.mozRequestAnimationFrame\n  || win.msRequestAnimationFrame\n  || function(cb) { return setTimeout(cb, 16); };\n\n/**\n * Initialize a `FastDom`.\n *\n * @constructor\n */\nfunction FastDom() {\n  var self = this;\n  self.reads = [];\n  self.writes = [];\n  self.raf = raf.bind(win); // test hook\n  debug('initialized', self);\n}\n\nFastDom.prototype = {\n  constructor: FastDom,\n\n  /**\n   * We run this inside a try catch\n   * so that if any jobs error, we\n   * are able to recover and continue\n   * to flush the batch until it's empty.\n   *\n   * @param {Array} tasks\n   */\n  runTasks: function(tasks) {\n    debug('run tasks');\n    var task; while (task = tasks.shift()) task();\n  },\n\n  /**\n   * Adds a job to the read batch and\n   * schedules a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @param  {Object} ctx the context to be bound to `fn` (optional).\n   * @public\n   */\n  measure: function(fn, ctx) {\n    debug('measure');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.reads.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Adds a job to the\n   * write batch and schedules\n   * a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @param  {Object} ctx the context to be bound to `fn` (optional).\n   * @public\n   */\n  mutate: function(fn, ctx) {\n    debug('mutate');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.writes.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Clears a scheduled 'read' or 'write' task.\n   *\n   * @param {Object} task\n   * @return {Boolean} success\n   * @public\n   */\n  clear: function(task) {\n    debug('clear', task);\n    return remove(this.reads, task) || remove(this.writes, task);\n  },\n\n  /**\n   * Extend this FastDom with some\n   * custom functionality.\n   *\n   * Because fastdom must *always* be a\n   * singleton, we're actually extending\n   * the fastdom instance. This means tasks\n   * scheduled by an extension still enter\n   * fastdom's global task queue.\n   *\n   * The 'super' instance can be accessed\n   * from `this.fastdom`.\n   *\n   * @example\n   *\n   * var myFastdom = fastdom.extend({\n   *   initialize: function() {\n   *     // runs on creation\n   *   },\n   *\n   *   // override a method\n   *   measure: function(fn) {\n   *     // do extra stuff ...\n   *\n   *     // then call the original\n   *     return this.fastdom.measure(fn);\n   *   },\n   *\n   *   ...\n   * });\n   *\n   * @param  {Object} props  properties to mixin\n   * @return {FastDom}\n   */\n  extend: function(props) {\n    debug('extend', props);\n    if (typeof props != 'object') throw new Error('expected object');\n\n    var child = Object.create(this);\n    mixin(child, props);\n    child.fastdom = this;\n\n    // run optional creation hook\n    if (child.initialize) child.initialize();\n\n    return child;\n  },\n\n  // override this with a function\n  // to prevent Errors in console\n  // when tasks throw\n  catch: null\n};\n\n/**\n * Schedules a new read/write\n * batch if one isn't pending.\n *\n * @private\n */\nfunction scheduleFlush(fastdom) {\n  if (!fastdom.scheduled) {\n    fastdom.scheduled = true;\n    fastdom.raf(flush.bind(null, fastdom));\n    debug('flush scheduled');\n  }\n}\n\n/**\n * Runs queued `read` and `write` tasks.\n *\n * Errors are caught and thrown by default.\n * If a `.catch` function has been defined\n * it is called instead.\n *\n * @private\n */\nfunction flush(fastdom) {\n  debug('flush');\n\n  var writes = fastdom.writes;\n  var reads = fastdom.reads;\n  var error;\n\n  try {\n    debug('flushing reads', reads.length);\n    fastdom.runTasks(reads);\n    debug('flushing writes', writes.length);\n    fastdom.runTasks(writes);\n  } catch (e) { error = e; }\n\n  fastdom.scheduled = false;\n\n  // If the batch errored we may still have tasks queued\n  if (reads.length || writes.length) scheduleFlush(fastdom);\n\n  if (error) {\n    debug('task errored', error.message);\n    if (fastdom.catch) fastdom.catch(error);\n    else throw error;\n  }\n}\n\n/**\n * Remove an item from an Array.\n *\n * @param  {Array} array\n * @param  {*} item\n * @return {Boolean}\n */\nfunction remove(array, item) {\n  var index = array.indexOf(item);\n  return !!~index && !!array.splice(index, 1);\n}\n\n/**\n * Mixin own properties of source\n * object into the target.\n *\n * @param  {Object} target\n * @param  {Object} source\n */\nfunction mixin(target, source) {\n  for (var key in source) {\n    if (source.hasOwnProperty(key)) target[key] = source[key];\n  }\n}\n\n// There should never be more than\n// one instance of `FastDom` in an app\nvar exports = win.fastdom = (win.fastdom || new FastDom()); // jshint ignore:line\n\n// Expose to CJS & AMD\nif ((typeof define) == 'function') define(function() { return exports; });\nelse if ((typeof module) == 'object') module.exports = exports;\n\n})( typeof window !== 'undefined' ? window : this);\n","export default getSize;\n\n// helper function: returns sizes of element;\nfunction getSize(el){\n    var computedStyle = window.getComputedStyle(el);\n    return {\n        height    : parse(el.offsetHeight) - parse(computedStyle.borderTopWidth) - parse(computedStyle.borderBottomWidth),\n        width    : parse(el.offsetWidth) - parse(computedStyle.borderLeftWidth) - parse(computedStyle.borderRightWidth)\n    };\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\n","/*\n * adjust canvas according to window size and settings\n * this module is built to be part of the main view\n */\n\nimport _ from 'lodash';\nimport fastdom from 'fastdom';\nimport getSize from './getSize';\n\nexport default adjust_canvas;\n\n// the function to be used by the main view\nfunction adjust_canvas(canvas, settings, $messages){\n\n    return _.throttle(eventListener, 16);\n\n    function eventListener(event){\n        // we put this in a time out because of a latency of orientation change on android devices\n        if (event.type == 'orientationchange') setTimeout(resize, 500);\n        else resize();\n    }\n\n    function resize(){\n        fastdom.measure(function(){\n            var targetSize = getTargetSize(settings, canvas);\n\n            // remove border width and top margin from calculated width (can't depend on cool box styles yet...)\n            // we compute only margin-top because of a difference calculating margins between chrome + IE and firefox + mobile\n            var computedStyle = window.getComputedStyle(canvas);\n            targetSize.height -= parse(computedStyle.borderTopWidth) + parse(computedStyle.borderBottomWidth) + parse(computedStyle.marginTop);\n            targetSize.width -= parse(computedStyle.borderLeftWidth) + parse(computedStyle.borderRightWidth);\n\n            fastdom.mutate(function(){\n                // reset canvas size\n                canvas.style.width = targetSize.width + 'px';\n                canvas.style.height = targetSize.height + 'px';\n                canvas.style.fontSize = targetSize.height*(settings.textSize || 3)/100 + 'px';\n\n                // scroll to top of window (hides some of the mess on the top of mobile devices)\n                window.scrollTo(0, 1);\n            });\n        });\n    }\n\n    function getProportions(settings){\n        var proportions = settings.proportions;\n        if (isNumeric(proportions)) return proportions;\n        if (_.isPlainObject(proportions)) {\n            if ([proportions.height, proportions.width].every(isNumeric)) return proportions.height/proportions.width; \n            $messages({\n                type: 'warn',\n                message: 'minno settings.canvas.proportions.width and settings.canvas.proportions.height must both be numeric',\n                context: settings\n            });\n        }\n        if (proportions) $messages({\n            type: 'warn',\n            message: 'minno settings.canvas.proportions must be either numeric or a plain object',\n            context: settings\n        });\n        return 0.8;\n    }\n\n    function getTargetSize(settings, canvas){\n        // calculate proportions (as height/width)\n        var proportions = getProportions(settings);\n\n        // static canvas size\n        // ------------------\n        if (settings.width) {\n            if (!isNumeric(settings.width)) $messages({\n                type: 'warn',\n                message: 'minno settings.canvas.width must be numeric',\n                context: settings\n            });\n            return {\n                width: settings.width,\n                height: settings.width*proportions\n            };\n        }\n\n        // dynamic canvas size\n        // -------------------\n        if (settings.maWidth && !isNumeric(settings.maxWidth)) $messages({\n            type: 'warn',\n            message: 'minno settings.canvas.maxWidth must be numeric',\n            context: settings\n        });\n\n        var docElement = window.document.documentElement; // used to get client view size\n\n        var maxHeight = docElement.clientHeight;\n        var maxWidth = Math.min(settings.maxWidth || Infinity, docElement.clientWidth, getSize(canvas.parentNode).width);\n\n        // calculate the correct size for this screen size\n        if (maxHeight > proportions * maxWidth) return { height: maxWidth*proportions, width: maxWidth };\n        else return { height: maxHeight, width: maxHeight/proportions};\n    }\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\nfunction isNumeric(n){ return !isNaN(parseFloat(n)) && isFinite(n); }\n","/**\n *\n * This whole module taken from piManager\n *\n */\n\nimport _ from 'lodash';\nexport default canvasContructor;\n\n/**\n * Takes a map of css rules and applies them.\n * Returns a function that returns the page to its former condition.\n *\n * The rule map is an object of ruleName -> ruleObject.\n *\n * var ruleObject = {\n * \telement : wrapped element to affect\n * \tproperty: css property to modify\n * }\n *\n * @param  {Object} map      A hash of rules.\n * @param  {Object} settings A hash of ruleName -> value\n * @return {Function}        A function that undoes all the previous changes\n */\nfunction canvasContructor(map, settings){\n    var offArr;\n\n    if (!_.isPlainObject(map)) throw new Error('canvas(map): You must set a rule map for canvas to work properly');\n\n    // if settings is undefined return a function that doesn't do anything\n    // just so we don't need to make sure that the user modifies the canvas\n    if (_.isUndefined(settings)) return _.noop;\n    if (!_.isPlainObject(settings)) throw new Error('canvas(settings): canvas settings must be an object');\n\n    // create an array of off functions to undo any changes by this action\n    offArr = _.map(settings, function(value,key){\n        var rule = map[key];\n        if (rule) return on(rule.element, rule.property, value);\n        throw new Error('canvas('+ key +'): unknow key in canvas object.');\n    });\n\n    return function off(){\n        _.forEach(offArr, function(fn){fn.call();});\n    };\n}\n\nfunction on(el, property, value){\n    var old = el.style[property]; // save old value\n    el.style[property] = value; // set new value\n    return function(){el.style[property] = old;};  // create off function\n}\n","/* eslint-disable */\r\n;(function() {\r\n\"use strict\"\r\n/* eslint-enable */\r\n\r\nvar guid = 0, HALT = {}\r\nfunction createStream() {\r\n\tfunction stream() {\r\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\t\treturn stream._state.value\r\n\t}\r\n\tinitStream(stream)\r\n\r\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\r\n\treturn stream\r\n}\r\nfunction initStream(stream) {\r\n\tstream.constructor = createStream\r\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\r\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\r\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\r\n\r\n\tObject.defineProperties(stream, {\r\n\t\tend: {get: function() {\r\n\t\t\tif (!stream._state.endStream) {\r\n\t\t\t\tvar endStream = createStream()\r\n\t\t\t\tendStream.map(function(value) {\r\n\t\t\t\t\tif (value === true) {\r\n\t\t\t\t\t\tunregisterStream(stream)\r\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value\r\n\t\t\t\t})\r\n\t\t\t\tstream._state.endStream = endStream\r\n\t\t\t}\r\n\t\t\treturn stream._state.endStream\r\n\t\t}}\r\n\t})\r\n}\r\nfunction updateStream(stream, value) {\r\n\tupdateState(stream, value)\r\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\r\n\tif (stream._state.unregister != null) stream._state.unregister()\r\n\tfinalize(stream)\r\n}\r\nfunction updateState(stream, value) {\r\n\tstream._state.value = value\r\n\tstream._state.changed = true\r\n\tif (stream._state.state !== 2) stream._state.state = 1\r\n}\r\nfunction updateDependency(stream, mustSync) {\r\n\tvar state = stream._state, parents = state.parents\r\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\r\n\t\tvar value = stream._state.derive()\r\n\t\tif (value === HALT) return false\r\n\t\tupdateState(stream, value)\r\n\t}\r\n}\r\nfunction finalize(stream) {\r\n\tstream._state.changed = false\r\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\r\n}\r\n\r\nfunction combine(fn, streams) {\r\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\r\n\treturn initDependency(createStream(), streams, function() {\r\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\r\n\t})\r\n}\r\n\r\nfunction initDependency(dep, streams, derive) {\r\n\tvar state = dep._state\r\n\tstate.derive = derive\r\n\tstate.parents = streams.filter(notEnded)\r\n\r\n\tregisterDependency(dep, state.parents)\r\n\tupdateDependency(dep, true)\r\n\r\n\treturn dep\r\n}\r\nfunction registerDependency(stream, parents) {\r\n\tfor (var i = 0; i < parents.length; i++) {\r\n\t\tparents[i]._state.deps[stream._state.id] = stream\r\n\t\tregisterDependency(stream, parents[i]._state.parents)\r\n\t}\r\n}\r\nfunction unregisterStream(stream) {\r\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\r\n\t\tvar parent = stream._state.parents[i]\r\n\t\tdelete parent._state.deps[stream._state.id]\r\n\t}\r\n\tfor (var id in stream._state.deps) {\r\n\t\tvar dependent = stream._state.deps[id]\r\n\t\tvar index = dependent._state.parents.indexOf(stream)\r\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\r\n\t}\r\n\tstream._state.state = 2 //ended\r\n\tstream._state.deps = {}\r\n}\r\n\r\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\r\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\r\nfunction valueOf() {return this._state.value}\r\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\r\n\r\nfunction valid(stream) {return stream._state }\r\nfunction active(stream) {return stream._state.state === 1}\r\nfunction changed(stream) {return stream._state.changed}\r\nfunction notEnded(stream) {return stream._state.state !== 2}\r\n\r\nfunction merge(streams) {\r\n\treturn combine(function() {\r\n\t\treturn streams.map(function(s) {return s()})\r\n\t}, streams)\r\n}\r\n\r\nfunction scan(reducer, seed, stream) {\r\n\tvar newStream = combine(function (s) {\r\n\t\treturn seed = reducer(seed, s._state.value)\r\n\t}, [stream])\r\n\r\n\tif (newStream._state.state === 0) newStream(seed)\r\n\r\n\treturn newStream\r\n}\r\n\r\nfunction scanMerge(tuples, seed) {\r\n\tvar streams = tuples.map(function(tuple) {\r\n\t\tvar stream = tuple[0]\r\n\t\tif (stream._state.state === 0) stream(undefined)\r\n\t\treturn stream\r\n\t})\r\n\r\n\tvar newStream = combine(function() {\r\n\t\tvar changed = arguments[arguments.length - 1]\r\n\r\n\t\tstreams.forEach(function(stream, idx) {\r\n\t\t\tif (changed.indexOf(stream) > -1) {\r\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn seed\r\n\t}, streams)\r\n\r\n\treturn newStream\r\n}\r\n\r\ncreateStream[\"fantasy-land/of\"] = createStream\r\ncreateStream.merge = merge\r\ncreateStream.combine = combine\r\ncreateStream.scan = scan\r\ncreateStream.scanMerge = scanMerge\r\ncreateStream.HALT = HALT\r\n\r\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\r\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\r\nelse window.m = {stream : createStream}\r\n\r\n}());\r\n","module.exports = css;\n\n/**\n * @arg el DOMElement any dom element\n * @arg obj Object a hash of styleName:value, where the style name may be either css-style or jsStyle (camelCase)\n * @returns void\n *\n * The function applies the styles set in obj to the el\n **/\n\nfunction css(el, obj){\n    var style = el.style;\n\n    if (!obj) return;\n\n    for (var key in obj) style[camelCase(key)] = obj[key];\n\n    function camelCase(str){ \n        return  str.replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); }); \n    }\n}\n","import _ from 'lodash';\nimport global from './global';\nimport createDB from './task/sequencer/createDB';\nimport canvasSetup from './task/canvas/canvasSetup';\nimport stream from 'mithril-stream';\n\nexport default setup;\n\nfunction setup(canvas, script){\n    var $messages = stream();\n    var $resize = canvasSetup(canvas, _.get(script, 'settings.canvas', {}),$messages);\n    var db = createDB(script);\n    setupVars(script);\n\n    return {\n        db:db, \n        $resize:$resize,\n        $messages: $messages,\n        canvas: canvas,\n        script: script,\n        settings: script.settings || {}\n    };\n}\n\nfunction setupVars(script){\n    // init global\n    var glob = global(global());\n    var name = script.name || 'anonymous minno-time';\n    var current = script.current ? script.current : {};\n\n    current.logs || (current.logs = []); // init logs object\n    glob[name] = glob.current = current; // create local namespace\n}\n","import _ from 'lodash';\nimport adjustCanvas from './adjust_canvas';\nimport applyCanvasStyles from './applyCanvasStyles';\nimport stream from 'mithril-stream';\nimport css from 'minno-css';\n\nexport default setupCanvas;\n\nfunction setupCanvas(canvas, canvasSettings,$messages){\n    canvasSettings || (canvasSettings = {});\n    var $resize = stream();\n\n    if (!_.isElement(canvas)) throw new Error('minno-time: canvas is not a DOM element');\n\n    canvas.classList.add('minno-canvas');\n\n    // apply canvas styles\n    var map = {\n        background \t\t\t: {element: document.body, property: 'backgroundColor'},\n        canvasBackground\t: {element: canvas, property:'backgroundColor'},\n        borderColor\t\t\t: {element: canvas, property:'borderColor'},\n        borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n    };\n\n    var off = applyCanvasStyles(map, _.pick(canvasSettings,['background','canvasBackground','borderColor','borderWidth']));\n\n    canvasSettings.css && css(canvas, canvasSettings.css);\n\n    // setup canvas resize\n    $resize.map(adjustCanvas(canvas, canvasSettings, $messages));\n    $resize({});\n\n    window.addEventListener('orientationchange', $resize);\n    window.addEventListener('resize', $resize);\n\n    $resize.end\n        .map(function(){canvas.classList.remove('minno-canvas');})\n        .map(function removeListeners(){\n            window.removeEventListener('orientationchange',$resize);\n            window.removeEventListener('resize', $resize);\n        })\n        .map(off);\n\n    return $resize;\n}\n","/*\n * this file is resposible for taking the experiment script (json) and parsing it\n */\n\n// load dependancies\nimport _ from 'lodash';\nimport Database from 'minno-sequencer';\nimport go from './sequenceGoto';\n\nexport default createDB;\n\nfunction createDB(script){\n    var db = new Database();\n    db.createColl('trial');\n    db.createColl('stimulus');\n    db.createColl('media');\n\n    db.add('trial', script.trialSets || []);\n    db.add('stimulus', script.stimulusSets || []);\n    db.add('media', script.mediaSets || []);\n\n    if (!_.isArray(script.sequence)) throw new Error('You must set a sequence array.');\n\n    var sequence = db.sequence('trial', script.sequence);\n    sequence.go = go; // see sequence/goto.js to understand why we are doing this\n    db.currentSequence = sequence;\n    return db;\n}\n","\n/*\n * media preloader\n * TODO: turn into factory, possibly make progress into a stream.\n */\nimport _ from 'lodash';\nexport default loader;\n\nvar srcStack = [];\t\t\t\t// an array holding all our sources\nvar defStack = [];\t\t\t\t// an array holding all the deferreds\nvar stackDone = 0;\t\t\t\t// the number of sources we have completed downloading\nvar images = {};\nvar getText = _.memoize(getXhr);\n\nvar loader = {\n    // loads a single source\n    load: load,\n\n    all: function(){\n        return Promise.all(defStack);\n    },\n\n    progress: function(){\n        return defStack.length ? stackDone/defStack.length : 1;\n    }\n};\n\n// load a single source\nfunction load(src, type){\n    // the source was already loaded\n    if (srcStack.indexOf(src) !== -1) return false;\n\n    // if we haven't loaded this yet\n    var promise = type == 'template' ? getText(src) : getImage(src);\n\n    promise\n        .then(function(){stackDone++;})\n        .then(function(){\n            loader.onload && loader.onload(src);\n        })\n        .catch(function(e){\n            loader.onerror && loader.onerror(e, src);\n        });\n\n    // keep defered and source for later.\n    defStack.push(promise);\n    srcStack.push(src);\n\n    return promise;\n}\n\nfunction getImage(url){\n    return  new Promise(function(resolve, reject){\n        if (_.includes(url, '<%')) return resolve();\n        var el = document.createElement('img');\n        el.onload = resolve;\n        el.onerror = function(){reject(new Error('Image not found: ' + url ));};\n        el.src = url;\n        images[url] = el;\n    });\n}\n\nfunction getXhr(url){\n    return new Promise(function(resolve, reject){\n        var request = new XMLHttpRequest();\n        request.open('GET',url, true);\n        request.onreadystatechange = function() {\n            if (this.readyState === 4) {\n                if (this.status >= 200 && this.status < 400) resolve(this.responseText);\n                else reject(new Error('Template not found:' + url));\n            }\n        };\n        request.send();\n    });\n}\n","/*\n * build the url for this src (add the generic baseUrl)\n */\n\nimport _ from 'lodash';\n\n/**\n * @param baseUrl {String|Object} the base url to prepend\n * @param url {String} the url we are dealing with\n * @param type {String} the type of resource we are dealing with (image or tempmlate) in case we have multiple base urls\n *\n * @returns String built url\n **/\nexport default function buildUrl(baseUrl, url, type){\n    // it this is a dataUrl type of image, we don't need to append the baseurl\n    if (type == 'image' && /^data:image/.test(url)) return url;\n\n    // the base url setting may be either a string, or an object with the type as a field\n    if (_.isObject(baseUrl)) baseUrl = baseUrl[type];\n\n    // make sure base url is set, and add trailing slash if needed\n    if (!baseUrl) baseUrl = '';\n    else if (baseUrl[baseUrl.length-1] != '/') baseUrl += '/';\n\n    return baseUrl + url;\n}\n","/*\n * gets all media that needs preloading and preloads it\n */\n\nimport _ from 'lodash';\nimport preloader from './preloader';\nimport buildUrl from './buildUrl';\n\nexport default preloadScript;\n\nfunction preloadScript(script, baseUrl){\n    getScriptMedia(script).forEach(loadMedia);\n    return preloader;\n\n    function loadMedia(media){\n        if (!_.isUndefined(media.image)) preloader.load(buildUrl(baseUrl, media.image, 'image'),'image');\n        if (!_.isUndefined(media.template)) preloader.load(buildUrl(baseUrl, media.template,'template'),'template');\n    }\n}\n\n/**\n * Iterates over a script and gathers all media\n **/\nexport function getScriptMedia(script){\n    var mediaSets = script.mediaSets;\n    var stimulusSets = _.map(script.stimulusSets, getStimMedia);\n    var trialSets = _.map(script.trialSets, getTrialMedia);\n    var sequence = _.filter(script.sequence,notMixer).map(getTrialMedia);\n    var preload = _.get(script.settings,'preloadImages', []).map(function(url){ return {image:url}; });\n\n    return _.flattenDeep([mediaSets, stimulusSets, trialSets, sequence, preload]).filter(notUndefined);\n} \n\nfunction getTrialMedia(trial){\n    return [\n        _.map(trial.input, function(input){ return input.element; }),\n        _.map(trial.stimuli, getStimMedia),\n        _.map(trial.layout, getStimMedia)\n    ];\n}\n\nfunction getStimMedia(stim){ return stim.media; }\nfunction notMixer(trial){ return !trial.mixer; }\nfunction notUndefined(val){ return !_.isUndefined(val); }\n","import css from 'minno-css';\nimport fastdom from 'fastdom';\nimport stream from 'mithril-stream';\n\nexport default mouseEvents;\n\nfunction mouseEvents(eventName,inputObj, canvas){\n    var $listener = stream();\n    var element = inputObj.element;\n\n    if (element){\n        css(element, inputObj.css);\n        fastdom.mutate(function(){\n            canvas.appendChild(element);\n        });\n    }\n\n    canvas.addEventListener(eventName, clickListener);\n\n    $listener.end.map(removeClickListener);\n    return $listener;\n\n    function clickListener(e){\n        var target = e.target;\n        if (element && element.contains(target)) return $listener(e);\n        if (!element && target.closest('[data-handle=\"' + inputObj.stimHandle + '\"]')) return $listener(e);\n        return;\n    }\n\n    function removeClickListener(){\n        if (element) canvas.removeChild(element);\n        canvas.removeEventListener(eventName, $listener);\n    }\n}\n","/*\n* key pressed listener\n* reqires key\n*\n* key can be either charCode or string.\n* or an array of charCode/strings.\n*/\n\n// we monitor all key up events so that we trigger only once per key down\nimport stream from 'mithril-stream';\nexport default keypressed;\n\nvar keyDownArr = [];\n\ndocument.addEventListener('keyup',function(e){ keyDownArr[e.which] = false; });// unset flag to prevent multi pressing of a key \n\nfunction keypressed(inputObj){\n    var $listener = stream();\n\n    // make sure key is an array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keydown', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (keyDownArr[e.which] || (target.indexOf(e.which) === -1)) return;\n        e.preventDefault(); // prevent FF from wasting about 10ms in browser-content.js (and fast search)\n        keyDownArr[e.which] = true; // set flag to prevent multi pressing of a key\n        $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keydown', keypressListener);\n    }\n}\n","import stream from 'mithril-stream';\nexport default keyup; \n\nfunction keyup(inputObj){\n    var $listener = stream();\n    // make sure key is array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keyup', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (target.indexOf(e.which) === -1) return;\n        e.preventDefault();\n        return $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keyup', $listener);\n    }\n}\n","export default window.performance.now\n    ? window.performance.now.bind(window.performance)\n\n    // We aren't using the absoulte time anywhere so we can use raw Date.now as a replacement\n    // if we're not on IE9\n    : Date.now.bind(Date);\n","import randomize from './simpleRandomize';\nimport stream from 'mithril-stream';\nimport fastdom from 'fastdom';\nimport now from '../now';\n\nexport default timeout;\n\n/*\n * We set timeout to trigger half a frame before the target time.\n * This is done so that on overage we hit as close as possible to the true duration\n * `offset` is updated dynamically by correctOfset() below\n **/\nvar offset = 5;\n\nfunction timeout(inputObj){\n    var $listener = stream();\n    var timeoutID;\n    var duration = randomize(inputObj.duration) || 0;\n    var isCanceled = false;\n\n    $listener.end.map(function(){isCanceled = true;});\n\n    if (!duration) $listener({}); // listener is already registered with $events so this should be immidiate \n\n    else fastdom.measure(function(){\n        // start timeout the same time that current visual stimuli occur\n        var target = now() + +duration - offset;\n        step();\n        function step(){\n            if (isCanceled) return;\n            fastdom.measure(function(){\n                if (now() >= target) $listener({});\n                else fastdom.mutate(step); // we use mutate here so that step does not get called within the same RAF\n            });\n        }\n    });\n\n    return $listener;\n}\n\n\n// compute true frame rate for this specific machine\n// and set offset to half of that\n(function correctOfset(){\n    var itterations = 50;\n    var a,b, results = [];\n    requestAnimationFrame(function(){\n        a = now();\n        update();\n    });\n\n    function update(){\n        requestAnimationFrame(function(){\n            b = now();\n            results.push(b-a)\n            a = b;\n            if (results.length < itterations)  return setTimeout(update);\n            else offset = mean(results)/3; \n            // we want an offset of half of the frame rate, so on average we hit the closest frame possible to the target.\n            // but it turns out that can create fragile balances and a high variance in display length\n            // using an offset of 1/3 we get both improved accuracy (mean closer to target) and improved precission (study number of frames)\n        });   \n    }\n\n    function mean(arr){return arr.reduce(function(v,s){return v+s},0)/arr.length}\n})();\n","/**\n *\tTakes a properties objects and returns the result of a randomization:\n *\tIf it is an array - pick a random member\n *\tIf it is an object pick from within a range\n *\tIf it is a function return its result using the context\n *\tOtherwise simply return the properties\n */\nimport _ from 'lodash';\n\nexport default simpleRandomize;\n\nfunction simpleRandomize(properties, context){\n\n    if (_.isArray(properties)) {\n        var index = Math.floor(Math.random()*properties.length);\n        return properties[index];\n    }\n\n    if (_.isFunction(properties)) {\n        return properties.call(context);\n    }\n\n    // this must be after the test for arrays and functions, because they are considered objects too\n    if (_.isPlainObject(properties)) {\n        if (!_.isNumber(properties.min) || !_.isNumber(properties.max) || properties.min > properties.max) {\n            throw new Error('randomization objects need both a max and a minimum property, also max has to be larger than min');\n        }\n        return properties.min + (properties.max - properties.min) * Math.random();\n    }\n\n    // if this is not a randomization object simply return\n    return properties;\n}\n\n","import binder from './binder';\nimport stream from 'mithril-stream';\nimport _ from 'lodash';\n\nexport default createListener;\n\nfunction createListener(inputObj,canvas){\n    var $listener = getListener(inputObj, canvas);\n\n    if (!isStream($listener)) throw new Error('Input functions must return valid streams: ' + logObj(inputObj));\n    if ('handle' in inputObj) $listener.handle = inputObj.handle;\n\n    return $listener;\n}\n\nfunction getListener(inputObj, canvas){\n    var $listener;\n\n    if (_.isFunction(inputObj)) return inputObj(inputObj, canvas, stream);\n\n    if (_.isPlainObject(inputObj)) {\n        if (_.isString(inputObj.on)) return binder(inputObj,canvas,stream);\n\n        if (_.isFunction(inputObj.on )) {\n            $listener = inputObj.on(inputObj,canvas,stream);\n            if (!$listener || !$listener._state) throw new Error('input.on must return a stream');\n            if (_.isFunction(inputObj.off)) $listener.end.map(inputObj.off);\n            return $listener;\n        }\n    }\n        \n    throw new Error('Input must only contain objects and functions, do you have an undefined value?');\n}\n\nfunction logObj(obj){\n    return _.isFunction(obj) ? obj.toString() : JSON.stringify(obj);\n}\n\n\nfunction isStream(stream) {return stream._state; }\n","\nimport _ from 'lodash';\nimport mouseEvents from './bindings/mouseEvents';\nimport keypressed from './bindings/keypressed';\nimport keyup from './bindings/keyup';\nimport timeout from './bindings/timeout';\nimport css from 'minno-css';\n\nexport default inputBinder;\n\n/**\n * The input binder is a hash of default input types\n * It returns a stream of events\n **/\nfunction inputBinder(inputObj, canvas){\n    var on = inputObj.on; // what type of binding is this?\n\n    switch (on){\n\n        case 'keypressed'\t: return keypressed(inputObj);\n\n        case 'keyup'\t\t: return keyup(inputObj);\n\n        case 'click'\t\t:\n        case 'mousedown'    :\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'mouseup'\t    : return mouseEvents('mouseup', inputObj, canvas);\n\n        case 'mouseover'\t: return mouseEvents('mouseover', inputObj, canvas);\n\n        case 'mouseout'\t: return mouseEvents('mouseout', inputObj, canvas);\n\n        case 'timeout'\t\t: return timeout(inputObj);\n\n        /*\n         * Shortcuts\n         */\n\n        case 'enter'\t: return keypressed(_.assign({key:13},inputObj));\n\n        case 'space'\t: return keypressed(_.assign({key:32},inputObj));\n\n        case 'esc'\t    : return keypressed(_.assign({key:27},inputObj));\n\n        case 'leftTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                left: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'rightTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                right: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'topTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                top: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'bottomTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                bottom: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        default:\n            throw new Error('You have an input element with an unrecognized \"on\" property: ' + on);\n\n    }\n\n\n    function createElement(css2, css1){\n        var el = document.createElement('div');\n        css(el, css1);\n        css(el, css2);\n        return el;\n    }\n}\n","import createListener from './createListener';\nimport now from './now';\n\nexport default interfaceFn;\n\nfunction interfaceFn($events, canvas){\n    var listenerStack = []; // holds all active listeners\n    var baseTime = 0;\n\n    return { add:add,remove:remove,removeAll:removeAll,resetTimer:resetTimer };\n\n    function add(inputObj){\n        if (!inputObj) throw new Error('Missing input element. Could not add input listener');\n        var $listener = createListener(inputObj, canvas);\n        $listener.map(addDetails).map($events); // pipe events to $events\n        listenerStack.push($listener);\n\n        function addDetails(event){\n            return {\n                handle      : $listener.handle,\n                event       : event,\n                timestamp\t: +new Date(),\n                latency\t\t: now() - baseTime\n            };\n        }\n    }\n\n    function remove(handle){\n        // go through the listener stack and remove any listeners that fit the handle\n        // note that we do this in reverse so that the index does not change\n        for (var i = listenerStack.length - 1; i >= 0 ; i--){\n            var $listener = listenerStack[i];\n            if ($listener.handle === handle){\n                $listener.end(true);\n                listenerStack.splice(i,1);\n            }\n        }\n    }\n\n    function removeAll(){\n        listenerStack.forEach(function($listener){\n            $listener.end(true);\n        });\n        listenerStack.length = 0;\n    }\n\n    function resetTimer(){ baseTime = now(); }\n}\n","import _ from 'lodash';\nexport default getMedia;\n\nfunction getMedia(media, $messages){\n    // all templateing is done within the inflate trial function and the sequencer\n    var template = media.html || media.inlineTemplate || media.template; // give inline template precedence over template, because tempaltes are loaded into inlinetemplate\n    var el;\n\n    if (_.isFunction(media)) return customMedia(media);\n\n    if (isWord(media)) media = {word:media};\n\n    if (isWord(media.word)) {\n        el = document.createElement('div');\n        el.textContent = media.word;\n        return Promise.resolve(el);\n    }\n\n    if (template) { // html | template | inlineTemplate\n        el = document.createElement('div');\n        el.innerHTML = template;\n        return Promise.resolve(el);\n    } \n\n    // at this time, we count on the preloader to throw for errors\n    // the reject option isn't really being used here...\n    if (media.$image) return new Promise(function(resolve, reject){\n        var startTime = performance.now();\n        var src = media.$image;\n        el = document.createElement('img');\n        el.onload = function(){\n            var latency = performance.now() - startTime ;\n            if (latency > 16) $messages({\n                type:'warn',\n                message: 'It took too long to load \"' + src + '\" (' + latency +'ms). Make sure that it was preloaded properly.',\n                context:src\n            });\n            resolve(el);\n        };\n        el.onerror = function(){reject(new Error('Image not found: ' + el.src ));};\n        el.src = src;\n    });\n\n    if (media.jquery) return Promise.reject(new Error('Jquery is no longer supported in minno-time'));\n\n    return Promise.reject(new Error('Unrecognized media type')); // this is not a supported html type\n}\n\nfunction isWord(val){ return _.isString(val) || _.isNumber(val); }\n\nfunction customMedia(media){\n    var promise = media();\n    if (!isThenable(promise)) return Promise.reject(new Error('Custom media must return a promise'));\n    return promise.then(forceElement);\n\n    function isThenable(p){ return p && _.isFunction(p.then); }\n    function forceElement(el){ return _.isElement(el) ? el : Promise.reject('Custom media must resolve with an element');}\n}\n","import _ from 'lodash';\nexport default setSize;\n\nfunction setSize(el,stimulus){\n    var style = el.style;\n    var size = stimulus.size || {};\n\n    if (size.font_size) style.fontSize = size.font_size;\n\n    // if this is a word, we don't want to set height (it breaks centering)\n    if (isSet('height', size) && !isWordMedia(stimulus.media)) style.height = size.height + '%';\n\n    if (isSet('width', size)) style.width = size.width + '%';\n\n    return el;\n}\n\nfunction isSet(prop, obj){return prop in obj;}\nfunction isWordMedia(media){ return _.isString(media) || _.isString(media.word); }\n\n","export default setPlace;\n\nfunction setPlace(el,stimulus){\n    var location = stimulus.location || {};\n\n    ['top','bottom','left','right'].forEach(setNumericLocation);\n\n    function isNumeric(val) {return !isNaN(+val);}\n    function setNumericLocation(attr){ if (isNumeric(location[attr])) el.style[attr] = location[attr] + '%'; }\n}\n","import fastdom from 'fastdom';\nimport setSize from './setSize';\nimport setPlace from './setPlace';\nimport css from 'minno-css';\nvar isIE = window.document.documentMode;\n\nexport default setupElement;\n\nfunction setupElement(stimulus, index, el){\n    var canvas = stimulus.canvas;\n\n    stimulus.el = el;\n    return new Promise(function(resolve){\n        fastdom.mutate(function initStim(){\n            // setup element\n            el.classList.add('minno-stimulus');\n            el.setAttribute('data-handle', stimulus.handle); // data-handle for handeling of mouse/touch interactions\n            el.style.zIndex = index*10; // make sure elements are layered correctly (becuase sometimes they are not linearly inserted into the dom).\n            canvas.appendChild(el);\n\n            setSize(el, stimulus.source);\n            setPlace(el, stimulus.source);\n            css(el, stimulus.source.css || {});\n\n            if (!isIE) {\n                if (stimulus.source.isLayout) el.classList.add('minno-stimulus-visible');\n                resolve(el);\n            }\n            else fixIE(stimulus, resolve);\n        });\n    });\n}\n\n/**\n * sets element dimensions explicitly so that centering works in ie\n **/\nfunction fixIE(stimulus, resolve){\n    var canvas = stimulus.canvas;\n    var el = stimulus.el;\n    var location = stimulus.source.location || {};\n\n    fastdom.measure(function(){\n        var width = (100 * el.clientWidth / canvas.clientWidth);\n        var height = (100 * el.clientHeight / canvas.clientHeight);\n        fastdom.mutate(function(){\n            var style = el.style;\n            style.width = width + '%';\n            style.height = height + '%';\n            if (testProps(location.top, location.bottom)) { style.top = (100-height)/2+'%'; }\n            if (testProps(location.left, location.right)) { style.left = (100-width)/2+'%'; }\n            if (stimulus.source.isLayout) el.classList.add('minno-stimulus-visible');\n            resolve(el);\n        });\n    });\n\n    function testProps(p1, p2){\n        return p1 === 'center' || p2 === 'center' || (p1 === undefined && p2 === undefined);\n    }\n}\n","import fastdom from 'fastdom';\nimport getMedia from './getMedia';\nimport setupElement from './setupElement';\n\nexport default Stimulus;\n\nfunction Stimulus(stimulus, trial, canvas){\n    var self = {\n        el: null, // is set within init, some methods will break if not called before init...\n        source: stimulus,\n        trial: trial,\n        canvas: canvas,\n        init: init,\n        show: show,\n        hide: hide,\n        name: name,\n        mediaName: mediaName,\n        destroy: destroy\n    };\n\n    // make sure we have a data object\n    self.data = stimulus.data || {};\n\n    // set the handle\n    self.handle = self.data.handle = self.data.handle || stimulus.handle || stimulus.set;\n\n    return self;\n}\n\n\nfunction init(index){\n    var stimulus = this;\n    var source = this.source;\n    var $messages = this.trial.$messages;\n    if (!this.source.media) throw new Error('Media object not defined for ' + this.name());\n\n    return getMedia(this.source.media, $messages)\n        .then(setupElement.bind(null, stimulus, index))\n        .catch(onError);\n\n    function onError(error){\n        $messages({type:'error', message: 'trial.stimulus error', error:error, context:source});\n        throw error;\n    }\n}\n\nfunction show(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be shown before init is called');\n\n    fastdom.mutate(function showStim(){\n        el.classList.add('minno-stimulus-visible');\n    });\n}\n\nfunction hide(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be hidden before init is called');\n\n    fastdom.mutate(function hideStim(){\n        el.classList.remove('minno-stimulus-visible');\n    });\n}\n\nfunction destroy(){\n    var el = this.el;\n    var canvas = this.canvas;\n    fastdom.mutate(function removeStim(){\n        canvas.removeChild(el);\n    });\n}\n\nfunction name(){\n    var source = this.source;\n    // if we have an alias ues it\n    if (source.alias) {return source.alias;}\n    if (this.data && this.data.alias) {return this.data.alias;} // if we have an alias ues it\n\n    if (source.inherit && source.inherit.set) {return source.inherit.set;} // otherwise try using the set we inherited from\n    if (this.handle) {return this.handle;} // otherwise use handle\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction mediaName(options){\n    var media = this.source.media;\n    var fullpath = options && options.fullpath; // as set within settings\n\n    if (media.alias) {return media.alias;} // if we have an alias ues it\n    if (media.data && media.data.alias) { return media.data.alias; }\n\n    for (var prop in media) {\n        if (contains(['image','template'],prop)) return fullpath ? media[prop] : media[prop].replace(/^.*[\\\\/]/, '');\n\n        // sometimes we have an empty value (this happens when we load a template and then translate it into an inline template)\n        if (contains(['word','html','inlineTemplate'],prop) && media[prop]) return media[prop];\n    }\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction contains(arr, val){ return arr.indexOf(val) != -1;}\n","import Stimulus from './Stimulus';\nimport _ from 'lodash';\n\nexport default stimCollection;\n\nfunction stimCollection(trial, canvas){\n    validateStimuli('stimuli', trial._source);\n    validateStimuli('layout', trial._source);\n\n    var source = trial._source;\n    var stimuli = _.map(source.stimuli, toStim);\n    var layout = _.map(source.layout, toLayout).map(toStim);\n    var stimReady = stimuli.concat(layout).map(function(stim,index){return stim.init(index);});\n\n    var self = {\n        canvas: canvas,\n        stimuli: stimuli,\n        layout: layout,\n        ready: Promise.all(stimReady),\n        getStimlist: getStimlist,\n        getMedialist: getMedialist,\n        destroy: destroy\n    };\n\n    return self;\n\n    function toStim(stim){ return Stimulus(stim, trial, canvas); }\n    function toLayout(stim){ stim.isLayout = true; return stim;}\n}\n\nfunction getStimlist(){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.name() || ('stim' + index);});\n}\n\nfunction getMedialist(options){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.mediaName(options) || ('media' + index);});\n}\n\nfunction destroy(){\n    this.stimuli.concat(this.layout).forEach(function(stim){stim.destroy();});\n}\n\nexport function validateStimuli(type, source){\n    var stimuli = source[type];\n    if (!stimuli) return;\n    if (!Array.isArray(stimuli)) throw new Error(type + ' must be an array');\n    if (!stimuli.every(function(stim){ return 'media' in stim; })) throw new Error('Each ' + type + ' stimulus must have a media property');\n}\n","import _ from 'lodash';\nimport globalGetter from '../../global';\n\nvar global = globalGetter();\nvar conditionHash = {\n    begin:begin,\n    inputEquals:inputEquals,\n    inputEqualsTrial:inputEqualsTrial,\n    inputEqualsStim:inputEqualsStim,\n    trialEquals:trialEquals,\n    inputEqualsGlobal:inputEqualsGlobal,\n    globalEquals:globalEquals,\n    globalEqualsTrial:globalEqualsTrial,\n    globalEqualsStim:globalEqualsStim,\n    currentEquals:currentEquals,\n    currentEqualsTrial:currentEqualsTrial,\n    currentEqualsStim:currentEqualsStim,\n    inputEqualsCurrent:inputEqualsCurrent,\n    fn:fn,\n    custom:custom,\n};\n\nexport default function getConditonFn(condition){\n    if (_.isFunction(condition)) return condition;\n    if (_.isFunction(conditionHash[condition.type])) return conditionHash[condition.type];\n    throw new Error('Unknown condition type: ' + JSON.stringify(condition));\n}\n\nfunction begin(inputData){ return inputData.type === 'begin'; }\n\nfunction inputEquals(inputData, condition){\n    var values = Array.isArray(condition.value) ? condition.value : [condition.value];\n    return values.indexOf(inputData.handle) !== -1;\n}\n\nfunction inputEqualsTrial(inputData, condition, trial){ return inputData.handle === trial.data[condition.property]; }\n\nfunction inputEqualsStim(inputData, condition, trial){\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.property] = inputData.handle;\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj,trial);\n}\n\nfunction trialEquals(inputData, condition, trial){\n    if (_.isUndefined(condition.property) || _.isUndefined(condition.value)) throw new Error('trialEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === trial.data[condition.property];\n}\n\nfunction inputEqualsGlobal(inputData, condition){\n    if (_.isUndefined(condition.property)) throw new Error('inputEqualsGlobal requires \"property\" to be defined');\n    return inputData.handle === global[condition.property];\n}\n\nfunction globalEquals(inputData, condition){\n    if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined') throw new Error('globalEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === global[condition.property];\n}\n\nfunction globalEqualsTrial(inputData, condition, trial){\n    if (typeof condition.globalProp == 'undefined' || typeof condition.trialProp == 'undefined') throw new Error('globalEqualsTrial requires both \"globalProp\" and \"trialProp\" to be defined');\n    return global[condition.globalProp] === trial.data[condition.trialProp];\n}\n\nfunction globalEqualsStim(inputData, condition, trial){\n    if (typeof condition.globalProp == 'undefined' || typeof condition.stimProp == 'undefined') throw new Error('globalEqualsStim requires both \"globalProp\" and \"stimProp\" to be defined');\n\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.stimProp] = global[condition.globalProp];\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj,trial);\n}\n\nfunction inputEqualsCurrent(inputData, condition){\n    var current = global.current;\n    if (typeof condition.property == 'undefined') throw new Error('inputEqualsCurrent requires \"property\" to be defined');\n    return inputData.handle === current[condition.property];\n}\nfunction currentEquals(inputData, condition){\n    var current = global.current;\n    if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined') throw new Error('currentEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === current[condition.property];\n}\n\nfunction currentEqualsTrial(inputData, condition, trial){\n    var current = global.current;\n    if (typeof condition.currentProp == 'undefined' || typeof condition.trialProp == 'undefined') throw new Error('currentEqualsTrial requires both \"currentProp\" and \"trialProp\" to be defined');\n    return current[condition.currentProp] === trial.data[condition.trialProp];\n}\n\nfunction currentEqualsStim(inputData, condition, trial){\n    var current = global.current;\n    if (typeof condition.currentProp == 'undefined' || typeof condition.stimProp == 'undefined') throw new Error('currentEqualsStim requires both \"currentProp\" and \"stimProp\" to be defined');\n\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.stimProp] = current[condition.currentProp];\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj, trial);\n}\n\nfunction fn(inputData, condition, trial){\n    return condition.value.apply(trial,[condition,inputData, trial]);\n}\n\nfunction custom(inputData, condition, trial){\n    return condition.fn.apply(null, [condition, inputData, trial]);\n}\n\nfunction hasData(searchObj, trial){\n    return trial.stimulusCollection.stimuli.some(function(stim){\n        var data = stim.data;\n        for (var key in searchObj) {\n            if (searchObj[key] !== data[key]) return false;\n        }\n        return true;\n    });\n}\n","/*\n * gets a condition array (or a single condition) and evaluates it\n * returns true if all statements are true, false otherwise\n *\n * a single condition looks like this:\n *\n *\tcondition = {\n *\t\ttype : 'begin/inputEquals/inputEqualsTrial/inputEqualsStim/function',\n *\t\tvalue: 'right/trialAttribute/stimAttribute/customFunction',\n *\t\thandle: 'stim handle' (optional in case we're targeting a stimulus)\n *\t}\n *\n */\n\nimport getConditionFn from './getConditionFn';\n\nexport default conditionsEvaluate;\n\nfunction conditionsEvaluate(conditions, inputData, trial){\n    // make sure conditions is an array\n    conditions = Array.isArray(conditions) ? conditions : [conditions];\n\n    // do not activate empty condition arrays\n    if (!conditions.length) return false;\n\n    // if this is a begin event, make sure we only run interactions that have begin in them\n    if (inputData.type == 'begin' && conditions.every(function(condition){return condition.type != 'begin';})) return false;\n\n    return conditions.every(checkCondition);\n\n\n    function checkCondition(condition){\n        var value = getConditionFn(condition)(inputData, condition, trial);\n        return condition.negate ? !value : value;\n    }\n}\n","import _ from 'lodash';\nimport fastdom from 'fastdom';\nimport global from '../../global';\nimport applyCanvasStyles from '../../task/canvas/applyCanvasStyles';\n\nexport default actions;\n\n// @TODO: see if we can afford to change the signature of actions\n// I'd like to have the trial go first here (used almost always).\nvar actions = {\n    /*\n     * Stimulus actions\n     */\n    showStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.show();\n        });\n    },\n\n    hideStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.hide();\n        });\n    },\n\n    setStimAttr: function(action, eventData, trial){\n        var handle = action.handle;\n        var setter = action.setter;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) {\n                if (_.isFunction(setter)) setter.apply(stim);\n                else _.extend(stim.data, setter);\n            }\n        });\n    },\n\n    /*\n     * Trial actions\n     */\n    setTrialAttr: function(action, eventData, trial){\n        var setter = action.setter;\n        if (typeof setter == 'undefined') throw new Error('The setTrialAttr action requires a setter property');\n        if (_.isFunction(setter)) setter.apply(trial, [trial.data,eventData]);\n        else _.extend(trial.data,setter);\n    },\n\n    setInput: function(action, eventData, trial){\n        if (typeof action.input == 'undefined') throw new Error('The setInput action requires an input property');\n        trial.input.add(action.input);\n    },\n\n    trigger: function(action, eventData, trial){\n        if (typeof action.handle == 'undefined') throw new Error('The trigger action requires a handle property');\n        trial.input.add({handle:action.handle, on:'timeout', duration:+action.duration || 0});\n    },\n\n    removeInput: function(action, eventData, trial){\n        var input = trial.input;\n        var handleList = action.handle;\n        if (typeof handleList == 'undefined') throw new Error('The removeInput action requires a handle property');\n        if (!Array.isArray(handleList)) handleList = [handleList];\n        if (_.includes(handleList,'All')) input.removeAll();\n        else handleList.forEach(input.remove);\n    },\n\n    goto: function(action, eventData, trial){\n        trial._next = [action.destination,action.properties];\n    },\n\n    endTrial: function(){\n        // this is explicitly managed in interaction.js\n        // in order to improve trial lifecycle control\n    },\n\n    resetTimer: function(action,eventData,trial){\n        // when to reset timer\n        action.immidiate ? reset() : fastdom.mutate(reset);\n\n        function reset(){\n            eventData.latency = 0;\n            trial.input.resetTimer();\n        }\n    },\n\n    /*\n     * Logger\n     */\n\n    log: function(action,eventData,trial){\n        trial.$logs(arguments);\n    },\n\n    /*\n     * Misc\n     */\n\n    setGlobalAttr: function(action){\n        switch (typeof action.setter){\n            case 'function':\n                action.setter.apply(null,[global(), action]);\n                break;\n            case 'object':\n                _.extend(global(), action.setter);\n                break;\n            default:\n                throw new Error('setGlobalAttr requires a \"setter\" property');\n        }\n    },\n\n    custom: function(action,eventData, trial){\n        if (typeof action.fn != 'function') throw new Error('The custom action requires a fn propery');\n        action.fn(action, eventData, trial);\n    },\n\n    canvas: function(action, eventData, trial){\n        var canvas = trial.cavnas;\n        var map = {\n            background \t\t\t: {element: document.body, property: 'backgroundColor'},\n            canvasBackground\t: {element: canvas, property:'backgroundColor'},\n            borderColor\t\t\t: {element: canvas, property:'borderColor'},\n            borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n        };\n\n        // settings activator\n        var off = applyCanvasStyles(map, _.pick(action,['background','canvasBackground','borderColor','borderWidth']));\n        trial.$end.map(off);\n    },\n\n    /*\n     *  Mouse tracking\n     */\n    startMouseTracking: function(action, eventData, trial){\n        if (trial.data.listener) return trial.$message({ type:'warn', message: 'Mouse tracking has already been activated.' });\n\n        var startTime = performance.now();\n        var canvas = trial.canvas;// get its computed style\n        var logAs = action.logAs || 'mousetracker';\n\n        // get canvas borders so that we can compute relative to the content box\n        var styling = getComputedStyle(canvas);\n        var topBorder = parseInt(styling.getPropertyValue('border-top-width'));\n        var leftBorder = parseInt(styling.getPropertyValue('border-left-width'));\n\n        var trackedStimuli = trial.stimulusCollection.stimuli.filter(function(stim){ return _.includes(action.logStimulusLocation, stim.handle); });\n\n        var listener = _.throttle(function(e){\n            var canvasLocation = canvas.getBoundingClientRect();\n            var correctedCanvas = {x:canvasLocation.x+leftBorder, y:canvasLocation.y+topBorder};\n            var mouseLocation = { mouseX: e.clientX - correctedCanvas.x, mouseY: e.clientY - correctedCanvas.y };\n\n            var locations = trackedStimuli.reduce(function(acc, val){\n                var rect = val.el.getBoundingClientRect();\n                _.set(acc, val.handle+'X',rect.x - correctedCanvas.x);\n                _.set(acc, val.handle+'Y',rect.y - correctedCanvas.y);\n                _.set(acc, val.handle+'Width',rect.width);\n                _.set(acc, val.handle+'Height',rect.height);\n                return acc;\n            }, mouseLocation);\n\n            var results = _.mapValues(_.set(locations, 'time', performance.now()-startTime), Math.round);\n\n            trial.data[logAs].push(results);\n        }, action.logRate || 15);\n\n        trial.data[logAs] || (trial.data[logAs] = []);\n        trial.data.$listener = listener;\n\n        document.addEventListener('mousemove', listener);\n        trial.$events.end.map(function(){ // make sure that the listener is removed at the end of the trial\n            document.removeEventListener('mousemove', listener);\n        });\n    },\n\n\n    stopMouseTracking: function(e, ed, trial){\n        if (_.isFunction(trial.data.$listener)) { \n            document.removeEventListener('mousemove', trial.data.$listener);\n            trial.data.$listener = undefined; // should be undefined so that JSON.stringify does not encode it\n        }\n    }\n};\n\n","/*\n* Organizer for the interaction function\n*/\n\nimport evaluate from './conditionsEvaluate';\nimport activate from './action';\nimport _ from 'lodash';\n\nexport default interactions;\n\n/*\n * Trial -> Event -> Event\n *\n * Can use trial to produce side efects\n **/\n\nvar MAX_RECURSION_DEPTH = 50;\nfunction interactions(trial){\n    var recursionDepth = 0;\n    var interactions = trial._source.interactions;\n\n    try {\n        validateInteractions(interactions);\n    } catch(error){\n        trial.$messages({type:'error', message: 'trial.interactions error', error:error, context:trial._source});\n        throw error;\n    }\n    return eventMap;\n\n    function eventMap(event){\n        var i, interaction, conditionTrue, endTrial;\n        var groupName = 'Event: ' + (event.handle || event.type);\n        var debugLog = [];\n\n        if (recursionDepth > MAX_RECURSION_DEPTH) throw new Error('It seem you have created an infinite loop. Minno has been halted');\n\n        recursionDepth++;\n        try{\n            // use an explicit for loop because we need to be able to break\n            for (i=0; i<interactions.length; i++){\n                interaction = interactions[i];\n\n                conditionTrue = evaluate(interaction.conditions, event, trial);\n                debugLog.push([conditionTrue, interaction.conditions]);\n\n                if (conditionTrue) endTrial = activate(interaction.actions, event, trial);\n\n                // if this action includes endTrial we want to stop evalutation immidiately\n                if (endTrial) break;\n            }\n\n        } catch(error){\n            trial.$messages({type:'error', message: 'trial.interactions error', error:error});\n            throw error;\n        }\n        recursionDepth--;\n\n        trial.$messages({type:'debug', message: groupName, rows: debugLog});\n\n        // this is here and not within actions so that messages can be sent befor ending the trial\n        if (endTrial) trial.end();\n\n        return event;\n    }\n}\n\nexport function validateInteractions(interactions){\n    if (!Array.isArray(interactions)) throw new Error('Interactions must be an array');\n    if (!interactions.length) throw new Error('There are no interactions defined');\n\n    if (!interactions.every(_.isPlainObject)) throw new Error('Interactions must be plain objects');\n    if (!interactions.every(isValidProp('conditions'))) throw new Error('Conditions must be either an array or a function');\n    if (!interactions.every(isValidProp('actions'))) throw new Error('Actions must be either an array or a function');\n\n    function isValidProp(prop){\n        return function(interaction) {\n            return Array.isArray(interaction[prop]) || _.isFunction(interaction[prop]);\n        };\n    }\n}\n\n","/*\n * accepts an array of actions (or a single action)\n * and applies them\n *\n * actions = [\n *\t\t{type:actionName,more:options},\n *\t\t{actionName:options}\n * ]\n * @param actions: single action object or array of action objects\n * @param eventData: eventData object\n * @returns Boolean: endTrial whether this action stops further action activations\n */\n\nimport _ from 'lodash';\nimport actionList from './actionList';\n\nexport default applyActions;\n\nfunction applyActions(actions, eventData, trial){\n    // marks whether this is the final action to take\n    var endTrial = false;\n\n    actions = _.isArray(actions) ? actions : [actions];\n\n    _.forEach(actions,function(action){\n        var actionFn = _.isFunction(action) ? action : actionList[action.type];\n        if (!actionFn) throw new Error('unknown action: ' + action.type);\n\n        // the only reason to halt action activation is the endTrial command\n        if (action.type === 'endTrial') endTrial = true;\n        actionFn(action, eventData, trial);\n    });\n\n    return endTrial;\n}\n","import _ from 'lodash';\nimport input from './input/input';\nimport stimulusCollection from './stimulus/stimulusCollection';\nimport interactions from './interactions/interactions';\nimport stream from 'mithril-stream';\n\nexport default Trial;\n\nvar gid = 0;\n\n// data is already fully inflated\nfunction Trial(source, canvas, settings){\n    // make sure we have all our stuff :)\n    if (!source.interactions) throw new Error('Interactions not defined');\n\n    this.canvas = canvas;\n    this.settings = settings;\n    this._source = source;\n\n    this.$logs = stream();\n    this.$messages = stream();\n    this.$events = stream();\n    this.$end = this.$events.end;\n\n    // make sure we always have a data container\n    this.data = source.data || {};\n\n    // create a uniqueId for this trial\n    this._id = _.uniqueId('trial_');\n    this.counter = gid++;\n\n    this.input = input(this.$events, canvas);\n    this.stimulusCollection = stimulusCollection(this, canvas);\n\n    // the next trial we want to play\n    // by default this is simply the next trial, this can be changed using the goto action\n    // the syntax is [destination, properties]\n    this._next = ['next',{}];\n}\n\n_.extend(Trial.prototype,{\n    start: function(){\n        var trial = this;\n\n        // wait until all simuli are loaded\n        return trial.stimulusCollection.ready.then(function(){\n            // listen for interactions\n            trial.$events\n                .map(addTrialDetails(trial))\n                .map(interactions(trial));\n\n            // activate input\n            _.forEach(trial._source.input, trial.input.add); // add each input\n            // @TODO: possibly set to wait for fastdom.mutate\nfastdom.mutate(function(){\n            trial.input.resetTimer(); // reset the interface timer so that event latencies are relative to now.\n            // start running\n});\n            trial.$events({type:'begin',latency:0});\n        });\n    },\n\n    end: function(){\n        // remove all listeners\n        this.input.removeAll();\n        this.$end(true);\n    },\n\n    name: function(){\n        // if we have an alias ues it\n        if (this.alias) { return this.alias; }\n        if (this.data.alias) { return this.data.alias; }\n\n        // otherwise try using the set we inherited from\n        if (_.isString(this._source.inherit)) return this._source.inherit;\n        if (_.isPlainObject(this._source.inherit)) return this._source.inherit.set;\n\n        // we're out of options here\n    }\n});\n\nfunction addTrialDetails(trial){\n    return function(event){\n        return _.assign(event, {\n            trialId     : trial._id,\n            counter     : trial.counter\n        });\n    };\n}\n","import _ from 'lodash';\n\nexport default transformLogs;\n\nfunction transformLogs(action,eventData,trial){\n    var global = window.piGlobal;\n    var trialData = trial.data, inputData = eventData, logStack = global.current.logs;\n    var fullpath = _.get(trial, 'settings.logger.fullpath', false);\n\n    var stimList = trial.stimulusCollection.getStimlist();\n    var mediaList = trial.stimulusCollection.getMedialist({fullpath:fullpath});\n\n    return {\n        log_serial : logStack.length,\n        trial_id: trial.counter,\n        name: trial.name(),\n        responseHandle: inputData.handle,\n        latency: Math.floor(inputData.latency),\n        stimuli: stimList,\n        media: mediaList,\n        data: trialData\n    };\n}\n","import _ from 'lodash';\nimport stream from 'mithril-stream';\n\nimport Trial from './trial/Trial';\nimport nextTrial from './task/sequencer/nextTrial';\nimport createLogs from './task/logger/createLogStream';\nimport defaultLogMap from './task/logger/defaultLogMap';\nimport piGlobal from './global';\n\nexport default playerPhase;\n\n/**\n * run the task\n * Essentialy wiring up all the play phase stuff\n * @TODO: document this function, it's super complicated\n **/\n\nfunction playerPhase(sink){\n\n    var canvas = sink.canvas;\n    var db = sink.db;\n    var settings = sink.settings;\n    var global = piGlobal();\n\n    var $source = stream(); // a stream of trial POJO\n    var $trial = $source.map(activateTrial());\n    var $sourceLogs = stream();\n    var $logs = createLogs($sourceLogs, composeLoggerSettings(sink.script, global), defaultLogMap);\n    var onDone = _.get(settings, 'hooks.endTask', settings.onEnd || _.noop);\n\n    var kill; // placeholder for promise resolve\n    var promise = new Promise(function(resolve){ kill = resolve; })\n        .then($source.end.bind(null,true))\n        .then(clearCanvas)\n        .then(onDone);\n\n    // expose logs on current\n    $logs.map(function(log){\n        global.current.logs.push(log);        \n    });\n\n    $source.end\n        .map($trial.end)\n        .map($sourceLogs.end);\n\n    return _.extend({\n        $trial:$trial, \n        $logs: $logs,\n        start: play.bind(null, ['next', {}]),\n        end: kill,\n        promise: promise\n    }, sink);\n\n    function clearCanvas(){\n        var trial = $trial();\n        if (trial) trial.stimulusCollection.destroy();\n    }\n\n    function play(goto){\n        var next = nextTrial(db, settings, goto);\n        if (next.done) kill();\n        else $source(next.value);\n    }\n\n    function activateTrial(cache){\n        return activate;\n        function activate(source){\n            var oldTrial = cache;\n            var trial = cache = new Trial(source, canvas, settings);\n            // pipe public streams to trial streams\n            trial.$logs.map($sourceLogs); \n            trial.$messages.map(sink.$messages); \n\n            // must be *before* the subscription to $end for the next trial\n            if (source.DEBUG && window.DEBUG) setupDebug(trial);\n\n            trial.$end.map(function(){\n                play(trial._next); // when we're done try to play the next one\n            });\n\n            trial.start();\n\n            // we leave the old stimuli until the current ones are ready to maintain the continuity between trials\n            if (oldTrial) trial.stimulusCollection.ready.then(function(){\n                oldTrial.stimulusCollection.destroy();\n            });\n\n            return trial;\n        }\n    }\n}\n\nfunction setupDebug(trial){\n    /* eslint-disable no-console */\n    var trialName = 'Trial :' + trial.counter;\n    console.group(trialName);\n    trial.$messages.map(debugLog);\n    trial.$events.end.map(function(){ console.groupEnd(trialName); });\n\n    function debugLog(log){\n        if (log.type !== 'debug') return log;\n        if (log.rows){\n            console.groupCollapsed(log.message);\n            log.rows.forEach(function(row){ console.log.apply(console, row); });\n            console.groupEnd(log.message);\n        }\n        else console.log(log.message);\n        return log;\n    }\n    /* eslint-enable no-console */\n}\n\n// create metaDeta to add to post\nexport function composeLoggerSettings(script, global){\n    var loggerSettings = _.assign({}, _.get(script, 'settings.logger'));\n    var metaData = _.assign({taskName:script.name}, global.$meta, loggerSettings.metaData);\n    loggerSettings.metaData = metaData;\n    return loggerSettings;\n}\n","export default createLogs;\n\nfunction createLogs($sourceLogs, settings, defaultLogMap){\n    var logMap = settings.logger || settings.logMap || defaultLogMap;\n    return  $sourceLogs.map(applyMap(logMap));\n\n    // $logs is a stream of arrays, we want to apply them as args to the transform function\n    function applyMap(fn){\n        return function(args){ return fn.apply(null,args); };\n    }\n}\n","import _ from 'lodash';\nimport globalGetter from '../../global';\nimport buildUrl from './buildUrl';\n\nexport default nextTrial;\n\nfunction nextTrial(db, settings, goto){\n    var destination = goto[0], properties = goto[1];\n    var sequence = db.currentSequence;\n    var global = globalGetter();\n    var context = {global: global, current: global.current};\n    var source;\n\n    sequence.go(destination, properties, context);\n    source = sequence.current(context, {skip:['layout','stimuli']});\n    source = _.clone(source);\n\n    if (!source) return {done:true};\n\n    context.trialData = source.data;\n    context.trialMeta = source.$meta;\n\n    source.stimuli = _.map(source.stimuli || [], buildStim.bind(context));\n    source.layout = _.map(source.layout || [], buildStim.bind(context));\n\n    return {value:source};\n\n    function buildMedia(stim, prop, context){\n        var val = stim[prop];\n\n        if (_.isUndefined(val)) return false;\n        if (_.isString(val) || _.isNumber(val)) val = {word: val};\n\n        val = db.inflate('media', val, context);\n\n        // note that the base url is added to the media object during the sequence preload\n        // if needed, build url\n        if (val.image) val.$image = buildUrl(settings.base_url, val.image, 'image');\n\n        if (val.template){\n            // @TODO: remove dependency on requirejs\n            val.inlineTemplate = requirejs('text!' + buildUrl(settings.base_url, val.template, 'template'));\n            val.inlineTemplate = _.template(val.inlineTemplate)(context);\n        }\n\n        stim[prop] = val;\n\n        context.mediaData = null;\n        context.mediaMeta = null;\n    }\n\n    function buildStim(stim){\n        var context = this;\n\n        stim = db.inflate('stimulus', stim, context, {skip:['media','touchMedia']});\n        stim = _.clone(stim);\n        buildMedia(stim, 'media', context);\n        buildMedia(stim, 'touchMedia', context);\n        context.stimulusData = null;\n        context.stimulusMeta = null;\n        return stim;\n    }\n}\n","import './polyfills';\nimport './time.css';\n\nimport setup from './app/setup';\nimport preloadPhase from './app/preloadPhase';\nimport playPhase from './app/playPhase';\n\nexport default activate;\n\n/**\n * activate : (HTMLelement, timeScript) -> Sink\n *\n * timeScript : {settings, sequence, trialSets, stimulusSets, mediaSets, current}\n * Sink: {$trial, $logs, play, end}\n **/\nfunction activate(canvas, script){\n    var sink = setup(canvas, script);\n    var playSink = playPhase(sink);\n\n    playSink.$trial.end.map(playSink.$resize.end); // end resize stream\n\n    // preload Images, then start \"playPhase\"\n    preloadPhase(canvas, script, playSink.$messages).then(playSink.start);\n\n    return playSink;\n}\n\n","import scriptPreloader from './task/sequencer/scriptPreloader';\nimport fastdom from 'fastdom';\n\nexport default preloadPhase;\n\nfunction preloadPhase(canvas, script, $messages){\n    var preloader = scriptPreloader(script, script.settings.base_url);\n\n    if (preloader.progress() == 1) return Promise.resolve().then(emptyCanvas);\n\n    canvas.innerHTML = '<div class=\"minno-progress\"><div class=\"minno-progress-bar\"></div></div>';\n\n    var barStyle = canvas.getElementsByClassName('minno-progress-bar')[0].style;\n    barStyle.width = preloader.progress() + '%';\n    preloader.onload = function(){\n        fastdom.mutate(function(){\n            barStyle.width = preloader.progress()*100 + '%';\n        });\n    };\n    preloader.onerror = function(e, src){\n        $messages({\n            type:'error',\n            message: 'Failed to preload',\n            error:e,\n            context:src\n        });\n    };\n\n    return preloader.all()\n        .then(emptyCanvas)['catch'](function(src){\n            throw new Error('loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - ' + src +')');\n        });\n\n    function emptyCanvas(){\n        while (canvas.firstChild) canvas.removeChild(canvas.firstChild);\n    }\n}\n\n"],"names":["finallyConstructor","callback","constructor","this","then","value","resolve","reason","reject","allSettled","arr","length","TypeError","args","Array","prototype","slice","call","remaining","i","res","val","e","status","setTimeoutFunc","setTimeout","isArray","x","Boolean","noop","Promise","fn","_state","_handled","_value","undefined","_deferreds","doResolve","handle","self","deferred","_immediateFn","ret","cb","onFulfilled","onRejected","promise","push","newValue","finale","thisArg","apply","arguments","_unhandledRejectionFn","len","Handler","done","ex","prom","promiseFinally","all","race","setImmediate","err","console","warn","globalNS","window","global","Error","log","w","perfNow","perfNowNames","n","Date","now","group","groupCollapsed","groupEnd","table","lastTime","vendors","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","nextTime","Math","max","clearTimeout","Element","matches","msMatchesSelector","webkitMatchesSelector","closest","s","el","parentElement","parentNode","nodeType","glob","piGlobal","go","destination","properties","context","mixerSequence","where","prev","current","next","direction","sequence","curr","_","iteratee","data","win","debug","raf","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","FastDom","reads","writes","bind","scheduleFlush","fastdom","scheduled","error","runTasks","message","catch","remove","array","item","index","indexOf","splice","tasks","task","shift","measure","ctx","mutate","clear","extend","props","child","Object","create","target","source","key","hasOwnProperty","mixin","initialize","exports","module","parse","num","parseFloat","adjust_canvas","canvas","settings","$messages","throttle","event","type","resize","targetSize","proportions","isNumeric","isPlainObject","height","width","every","getProportions","maWidth","maxWidth","docElement","document","documentElement","maxHeight","clientHeight","min","Infinity","clientWidth","computedStyle","getComputedStyle","offsetHeight","borderTopWidth","borderBottomWidth","offsetWidth","borderLeftWidth","borderRightWidth","getSize","getTargetSize","marginTop","style","fontSize","textSize","scrollTo","isNaN","isFinite","canvasContructor","map","offArr","isUndefined","property","old","rule","element","forEach","createStream","stream","HALT","updateStream","id","guid","state","derive","recover","deps","parents","endStream","unregister","ap","valueOf","toJSON","toString","defineProperties","end","get","unregisterStream","updateState","updateDependency","changed","finalize","mustSync","active","some","combine","streams","valid","dep","concat","filter","notEnded","registerDependency","dependent","s1","s2","merge","scan","reducer","seed","newStream","scanMerge","tuples","tuple","idx","obj","str","replace","g","toUpperCase","camelCase","setup","script","name","$resize","canvasSettings","isElement","classList","add","off","applyCanvasStyles","background","body","canvasBackground","borderColor","borderWidth","pick","css","adjustCanvas","addEventListener","removeEventListener","canvasSetup","db","Database","createColl","trialSets","stimulusSets","mediaSets","currentSequence","createDB","logs","srcStack","defStack","stackDone","getText","memoize","url","request","XMLHttpRequest","open","onreadystatechange","readyState","responseText","send","loader","load","src","includes","createElement","onload","onerror","progress","buildUrl","baseUrl","isObject","preloadScript","getStimMedia","getTrialMedia","notMixer","preload","image","flattenDeep","notUndefined","media","preloader","template","trial","input","stimuli","layout","stim","mixer","mouseEvents","eventName","inputObj","$listener","appendChild","contains","stimHandle","removeChild","keyDownArr","keypressed","charCodeAt","keypressListener","which","preventDefault","keyup","a","b","itterations","results","performance","offset","timeout","duration","floor","random","isFunction","isNumber","randomize","isCanceled","step","update","reduce","v","createListener","isString","on","assign","position","left","opacity","right","top","bottom","css2","css1","binder","getListener","JSON","stringify","interfaceFn","$events","listenerStack","baseTime","timestamp","latency","removeAll","resetTimer","getMedia","html","inlineTemplate","p","isThenable","customMedia","isWord","word","textContent","innerHTML","$image","startTime","jquery","setSize","stimulus","size","font_size","setPlace","location","attr","isIE","documentMode","setupElement","testProps","p1","p2","setAttribute","zIndex","isLayout","init","show","hide","destroy","alias","inherit","set","mediaName","options","prop","fullpath","stimCollection","validateStimuli","_source","toStim","stimReady","ready","getStimlist","getMedialist","nolog","conditionHash","begin","inputData","inputEquals","condition","inputEqualsTrial","inputEqualsStim","searchObj","hasData","trialEquals","inputEqualsGlobal","globalEquals","globalEqualsTrial","globalProp","trialProp","globalEqualsStim","stimProp","currentEquals","currentEqualsTrial","currentProp","currentEqualsStim","inputEqualsCurrent","custom","stimulusCollection","conditionsEvaluate","conditions","getConditionFn","negate","actions","showStim","action","eventData","hideStim","setStimAttr","setter","setTrialAttr","setInput","trigger","removeInput","handleList","goto","_next","endTrial","reset","immidiate","$logs","setGlobalAttr","cavnas","$end","startMouseTracking","listener","$message","logAs","styling","topBorder","parseInt","getPropertyValue","leftBorder","trackedStimuli","logStimulusLocation","canvasLocation","getBoundingClientRect","correctedCanvas","y","mouseLocation","mouseX","clientX","mouseY","clientY","locations","acc","rect","mapValues","round","logRate","stopMouseTracking","ed","interactions","recursionDepth","isValidProp","interaction","validateInteractions","conditionTrue","groupName","debugLog","evaluate","actionFn","actionList","activate","rows","gid","Trial","_id","uniqueId","counter","transformLogs","trialData","logStack","stimList","mediaList","log_serial","trial_id","responseHandle","playerPhase","sink","cache","$sourceLogs","loggerSettings","kill","$source","$trial","oldTrial","DEBUG","trialName","row","setupDebug","play","start","metaData","taskName","$meta","defaultLogMap","logMap","logger","onDone","onEnd","skip","clone","trialMeta","buildStim","buildMedia","inflate","base_url","requirejs","mediaData","mediaMeta","stimulusData","stimulusMeta","trialId","playSink","playPhase","scriptPreloader","emptyCanvas","barStyle","getElementsByClassName","firstChild","preloadPhase"],"mappings":"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"}