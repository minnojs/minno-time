{"version":3,"file":"activatePIP.js","sources":["app/task/script.js","app/task/settings.js","app/trial/current_trial.js","app/task/adjust_canvas.js","app/task/canvasConstructor.js","../../bower_components/requirejs-text/text.js","templates/loading.html!text","app/task/main_view.js","utils/database/mixer/mixer.js","utils/database/mixer/branching/dotNotation.js","utils/database/mixer/branching/mixerDotNotationProvider.js","utils/database/mixer/branching/mixerConditionProvider.js","utils/database/mixer/branching/mixerEvaluateProvider.js","utils/database/mixer/branching/mixerBranchingDecorator.js","utils/database/mixer/mixerSequenceProvider.js","utils/database/mixer/main.js","utils/database/template/templateObjProvider.js","utils/database/template/templateFilter.js","utils/database/template/main.js","utils/database/collection/collectionProvider.js","utils/database/randomizer/randomizerProvider.js","utils/database/queryProvider.js","utils/database/inflateProvider.js","utils/database/store/storeProvider.js","utils/database/databaseSequenceProvider.js","utils/database/databaseProvider.js","utils/database/main.js","app/sequencer/database.js","app/sequencer/sequenceGoto.js","app/sequencer/taskSequence.js","utils/preloader.js","app/task/build_url.js","app/sequencer/sequencePreload.js","app/task/parser.js","utils/pubsub.js","utils/interface/bindings/click.js","utils/is_touch.js","utils/interface/bindings/mouseEvents.js","utils/interface/bindings/keypressed.js","utils/interface/bindings/keyup.js","utils/timeout.js","utils/simpleRandomize.js","utils/interface/bindings/timeout.js","utils/interface/binder.js","utils/interface/triggerEvent.js","utils/interface/listener.js","utils/interface/now.js","utils/interface/interface.js","models/model.js","app/media/media_view.js","utils/html.js","app/global.js","app/media/media_constructor.js","app/stimulus/stimulus_model.js","app/stimulus/stimulus_constructor.js","app/stimulus/stimulus_collection.js","app/trial/evaluate.js","app/trial/action_list.js","app/trial/action.js","app/trial/interactions.js","app/trial/trial_constructor.js","app/task/log/post.js","app/task/log/log_stack.js","app/task/log/logger.js","app/sequencer/inflateTrial.js","app/sequencer/player.js","activatePIP.js","extensions/dscore/computeD.js","extensions/dscore/msgMan.js","extensions/dscore/parcelMng.js","extensions/dscore/Scorer.js","API.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * this file holds the script we are to run\n */\n\ndefine('app/task/script',[],function(){\n\tvar scriptObj = {};\n\n\t/**\n\t * Getter/Setter fo script\n\t *\n\t * @param  {Object || null} obj \tThe new script, if it is not set this is simply a getter.\n\t * @return {Object}     \t\t\tThe full script\n\t */\n\tfunction script(obj){\n\t\tobj && (scriptObj = obj);\n\t\treturn scriptObj;\n\t}\n\n\treturn script;\n});\n","/*\n * simply take settings out of the script\n */\ndefine('app/task/settings',['require','./script'],function(require){\n\n\tvar script = require('./script');\n\n\t/**\n\t * get settings from script\n\t * @param  {String} name  \t\tOptional name of specific setting to get\n\t * @return {*}         \t\t\tThe settings object (or a sub of it)\n\t */\n\tfunction settingsGetter(name){\n\t\tvar settings = script().settings || {};\n\n\t\tif (name) {\n\t\t\treturn settings[name];\n\t\t}\n\t\treturn settings;\n\t}\n\n\treturn settingsGetter;\n});\n","define('app/trial/current_trial',[],function(){\n\t/*\n\t * holds a \"global\" instance of the current trial so we don't have to pass it on blindly.\n\t *\n\t * returns a function that return trial.\n\t * if it gets input, it replaces the current trial with the input;\n\t */\n\n\tvar trial;\n\n\treturn function(newTrial){\n\t\tif (newTrial) {\n\t\t\ttrial = newTrial;\n\t\t}\n\n\t\treturn trial;\n\t};\n});\n","/*\n * adjust canvas according to window size and settings\n * this module is built to be part of the main view\n */\ndefine('app/task/adjust_canvas',['require','jquery','app/task/settings','app/trial/current_trial'],function(require){\n\n\tvar $ = require('jquery')\n\t\t, settingsGetter = require('app/task/settings')\n\t\t, trial = require('app/trial/current_trial');\n\n\t// the function to be used by the main view\n\tfunction adjust_canvas(init){\n\t\tvar self = this;\n\t\t// get canvas settings\n\t\tvar settings = settingsGetter('canvas') || {};\n\n\t\t// calculate proportions (as height/width)\n\t\tvar proportions;\n\t\tif (settings.proportions) {\n\t\t\tif ($.isPlainObject(settings.proportions)) {\n\t\t\t\tif (typeof settings.proportions.height !== 'number' || typeof settings.proportions.width !== 'number'){\n\t\t\t\t\tthrow new Error('The canvas proportions object`s height and a width properties must be numeric');\n\t\t\t\t}\n\t\t\t\tproportions = settings.proportions.height/settings.proportions.width; // if proportions are an object they should include width and height\n\t\t\t} else {\n\t\t\t\tproportions = settings.proportions || 0.8; // by default proportions are 0.8\n\t\t\t}\n\t\t}\n\n\t\t// we put this in a time out because of a latency of orientation change on android devices\n\t\tsetTimeout(resize,init ? 0 : 500); // end timeout\n\n\t\tfunction resize(){\n\t\t\tvar height, width;\n\t\t\tvar $canvas = self.$el;\n\n\t\t\t// static canvas size\n\t\t\tif (settings.width){\n\t\t\t\t// if this is not init, we've already set screen size, so don't mess around\n\t\t\t\tif (!init){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\twidth = settings.width;\n\t\t\t\theight = width*proportions;\n\n\t\t\t} else { // dynamic canvas size\n\t\t\t\t// get current screen size\n\t\t\t\tvar screenSize = {\n\t\t\t\t\twidth: $(window).innerWidth(),\n\t\t\t\t\theight: $(window).innerHeight()\n\t\t\t\t};\n\n\t\t\t\tvar maxHeight = screenSize.height;\n\t\t\t\tvar maxWidth = Math.min(settings.maxWidth, screenSize.width, $canvas.parent().innerWidth());\n\n\t\t\t\t// calculate the correct size for this screen size\n\t\t\t\tif (maxHeight > proportions * maxWidth) {\n\t\t\t\t\theight = maxWidth*proportions;\n\t\t\t\t\twidth = maxWidth;\n\t\t\t\t} else {\n\t\t\t\t\theight = maxHeight;\n\t\t\t\t\twidth = maxHeight/proportions;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// remove border width and top margin from calculated width (can't depend on cool box styles yet...)\n\t\t\t// we compute only margin-top because of a difference calculating margins between chrome + IE and firefox + mobile\n\t\t\theight -= parseInt($canvas.css('border-top-width'),10) + parseInt($canvas.css('border-bottom-width'),10) + parseInt($canvas.css('margin-top'),10);\n\t\t\twidth -= parseInt($canvas.css('border-left-width'),10) + parseInt($canvas.css('border-right-width'),10);\n\n\t\t\t// reset canvas size\n\t\t\t$canvas.width(width);\n\t\t\t$canvas.height(height);\n\t\t\t$canvas.css('font-size',height*(settings.textSize || 3)/100);\n\n\t\t\t// refresh all stimuli (we don't want to do this before we have trials)\n\t\t\tif (trial()) {\n\t\t\t\ttrial()._layout_collection.refresh();\n\t\t\t\ttrial()._stimulus_collection.refresh();\n\t\t\t}\n\n\t\t\t// scroll to top of window (hides some of the mess on the top of mobile devices)\n\t\t\twindow.scrollTo(0, 1);\n\t\t}\n\t}\n\n\treturn adjust_canvas;\n});\n","/**\n *\n * This whole module taken from piManager\n *\n */\ndefine('app/task/canvasConstructor',['require','underscore'],function(require){\n\n\tvar _ = require('underscore');\n\n\t/**\n\t * Takes a map of css rules and applies them.\n\t * Returns a function that returns the page to its former condition.\n\t *\n\t * The rule map is an object of ruleName -> ruleObject.\n\t *\n\t * var ruleObject = {\n\t * \telement : wrapped element to affect\n\t * \tproperty: css property to modify\n\t * }\n\t *\n\t * @param  {Object} map      A hash of rules.\n\t * @param  {Object} settings A hash of ruleName -> value\n\t * @return {Function}        A function that undoes all the previous changes\n\t */\n\tfunction canvasContructor(map, settings){\n\t\tvar offArr;\n\n\t\tif (!_.isPlainObject(map)){\n\t\t\tthrow new Error('canvas(map): You must set a rule map for canvas to work properly');\n\t\t}\n\n\t\t// if settings is undefined return a function that doesn't do anything\n\t\t// just so we don't need to make sure that the user modifies the canvas\n\t\tif (_.isUndefined(settings)){\n\t\t\treturn _.noop;\n\t\t}\n\n\t\tif (!_.isPlainObject(settings)){\n\t\t\tthrow new Error('canvas(settings): canvas settings must be an object');\n\t\t}\n\n\t\t// create an array of off functions to undo any changes by this action\n\t\toffArr = _.map(settings, function(value,key){\n\t\t\tvar rule = map[key];\n\t\t\tif (rule){\n\t\t\t\treturn on(rule.element, rule.property, value);\n\t\t\t} else {\n\t\t\t\tthrow new Error('canvas('+ key +'): unknow key in canvas object.');\n\t\t\t}\n\t\t});\n\n\t\treturn function off(){\n\t\t\t_.forEach(offArr, function(fn){fn.call();});\n\t\t};\n\t}\n\n\tfunction on($el, property, value){\n\t\tvar old = $el.css(property); // save old value\n\t\t$el.css(property, value); // set new value\n\t\treturn _.bind($el.css, $el, property, old); // create off function: bind $el.css(property, old)\n\t}\n\n\treturn canvasContructor;\n\n});\n","/**\n * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/requirejs/text for details\n */\n/*jslint regexp: true */\n/*global require, XMLHttpRequest, ActiveXObject,\n  define, window, process, Packages,\n  java, location, Components, FileUtils */\n\ndefine('text',['module'], function (module) {\n    'use strict';\n\n    var text, fs, Cc, Ci, xpcIsWindows,\n        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],\n        xmlRegExp = /^\\s*<\\?xml(\\s)+version=[\\'\\\"](\\d)*.(\\d)*[\\'\\\"](\\s)*\\?>/im,\n        bodyRegExp = /<body[^>]*>\\s*([\\s\\S]+)\\s*<\\/body>/im,\n        hasLocation = typeof location !== 'undefined' && location.href,\n        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\\:/, ''),\n        defaultHostName = hasLocation && location.hostname,\n        defaultPort = hasLocation && (location.port || undefined),\n        buildMap = {},\n        masterConfig = (module.config && module.config()) || {};\n\n    text = {\n        version: '2.0.12',\n\n        strip: function (content) {\n            //Strips <?xml ...?> declarations so that external SVG and XML\n            //documents can be added to a document without worry. Also, if the string\n            //is an HTML document, only the part inside the body tag is returned.\n            if (content) {\n                content = content.replace(xmlRegExp, \"\");\n                var matches = content.match(bodyRegExp);\n                if (matches) {\n                    content = matches[1];\n                }\n            } else {\n                content = \"\";\n            }\n            return content;\n        },\n\n        jsEscape: function (content) {\n            return content.replace(/(['\\\\])/g, '\\\\$1')\n                .replace(/[\\f]/g, \"\\\\f\")\n                .replace(/[\\b]/g, \"\\\\b\")\n                .replace(/[\\n]/g, \"\\\\n\")\n                .replace(/[\\t]/g, \"\\\\t\")\n                .replace(/[\\r]/g, \"\\\\r\")\n                .replace(/[\\u2028]/g, \"\\\\u2028\")\n                .replace(/[\\u2029]/g, \"\\\\u2029\");\n        },\n\n        createXhr: masterConfig.createXhr || function () {\n            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.\n            var xhr, i, progId;\n            if (typeof XMLHttpRequest !== \"undefined\") {\n                return new XMLHttpRequest();\n            } else if (typeof ActiveXObject !== \"undefined\") {\n                for (i = 0; i < 3; i += 1) {\n                    progId = progIds[i];\n                    try {\n                        xhr = new ActiveXObject(progId);\n                    } catch (e) {}\n\n                    if (xhr) {\n                        progIds = [progId];  // so faster next time\n                        break;\n                    }\n                }\n            }\n\n            return xhr;\n        },\n\n        /**\n         * Parses a resource name into its component parts. Resource names\n         * look like: module/name.ext!strip, where the !strip part is\n         * optional.\n         * @param {String} name the resource name\n         * @returns {Object} with properties \"moduleName\", \"ext\" and \"strip\"\n         * where strip is a boolean.\n         */\n        parseName: function (name) {\n            var modName, ext, temp,\n                strip = false,\n                index = name.indexOf(\".\"),\n                isRelative = name.indexOf('./') === 0 ||\n                             name.indexOf('../') === 0;\n\n            if (index !== -1 && (!isRelative || index > 1)) {\n                modName = name.substring(0, index);\n                ext = name.substring(index + 1, name.length);\n            } else {\n                modName = name;\n            }\n\n            temp = ext || modName;\n            index = temp.indexOf(\"!\");\n            if (index !== -1) {\n                //Pull off the strip arg.\n                strip = temp.substring(index + 1) === \"strip\";\n                temp = temp.substring(0, index);\n                if (ext) {\n                    ext = temp;\n                } else {\n                    modName = temp;\n                }\n            }\n\n            return {\n                moduleName: modName,\n                ext: ext,\n                strip: strip\n            };\n        },\n\n        xdRegExp: /^((\\w+)\\:)?\\/\\/([^\\/\\\\]+)/,\n\n        /**\n         * Is an URL on another domain. Only works for browser use, returns\n         * false in non-browser environments. Only used to know if an\n         * optimized .js version of a text resource should be loaded\n         * instead.\n         * @param {String} url\n         * @returns Boolean\n         */\n        useXhr: function (url, protocol, hostname, port) {\n            var uProtocol, uHostName, uPort,\n                match = text.xdRegExp.exec(url);\n            if (!match) {\n                return true;\n            }\n            uProtocol = match[2];\n            uHostName = match[3];\n\n            uHostName = uHostName.split(':');\n            uPort = uHostName[1];\n            uHostName = uHostName[0];\n\n            return (!uProtocol || uProtocol === protocol) &&\n                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&\n                   ((!uPort && !uHostName) || uPort === port);\n        },\n\n        finishLoad: function (name, strip, content, onLoad) {\n            content = strip ? text.strip(content) : content;\n            if (masterConfig.isBuild) {\n                buildMap[name] = content;\n            }\n            onLoad(content);\n        },\n\n        load: function (name, req, onLoad, config) {\n            //Name has format: some.module.filext!strip\n            //The strip part is optional.\n            //if strip is present, then that means only get the string contents\n            //inside a body tag in an HTML string. For XML/SVG content it means\n            //removing the <?xml ...?> declarations so the content can be inserted\n            //into the current doc without problems.\n\n            // Do not bother with the work if a build and text will\n            // not be inlined.\n            if (config && config.isBuild && !config.inlineText) {\n                onLoad();\n                return;\n            }\n\n            masterConfig.isBuild = config && config.isBuild;\n\n            var parsed = text.parseName(name),\n                nonStripName = parsed.moduleName +\n                    (parsed.ext ? '.' + parsed.ext : ''),\n                url = req.toUrl(nonStripName),\n                useXhr = (masterConfig.useXhr) ||\n                         text.useXhr;\n\n            // Do not load if it is an empty: url\n            if (url.indexOf('empty:') === 0) {\n                onLoad();\n                return;\n            }\n\n            //Load the text. Use XHR if possible and in a browser.\n            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {\n                text.get(url, function (content) {\n                    text.finishLoad(name, parsed.strip, content, onLoad);\n                }, function (err) {\n                    if (onLoad.error) {\n                        onLoad.error(err);\n                    }\n                });\n            } else {\n                //Need to fetch the resource across domains. Assume\n                //the resource has been optimized into a JS module. Fetch\n                //by the module name + extension, but do not include the\n                //!strip part to avoid file system issues.\n                req([nonStripName], function (content) {\n                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,\n                                    parsed.strip, content, onLoad);\n                });\n            }\n        },\n\n        write: function (pluginName, moduleName, write, config) {\n            if (buildMap.hasOwnProperty(moduleName)) {\n                var content = text.jsEscape(buildMap[moduleName]);\n                write.asModule(pluginName + \"!\" + moduleName,\n                               \"define(function () { return '\" +\n                                   content +\n                               \"';});\\n\");\n            }\n        },\n\n        writeFile: function (pluginName, moduleName, req, write, config) {\n            var parsed = text.parseName(moduleName),\n                extPart = parsed.ext ? '.' + parsed.ext : '',\n                nonStripName = parsed.moduleName + extPart,\n                //Use a '.js' file name so that it indicates it is a\n                //script that can be loaded across domains.\n                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';\n\n            //Leverage own load() method to load plugin value, but only\n            //write out values that do not have the strip argument,\n            //to avoid any potential issues with ! in file names.\n            text.load(nonStripName, req, function (value) {\n                //Use own write() method to construct full module value.\n                //But need to create shell that translates writeFile's\n                //write() to the right interface.\n                var textWrite = function (contents) {\n                    return write(fileName, contents);\n                };\n                textWrite.asModule = function (moduleName, contents) {\n                    return write.asModule(moduleName, fileName, contents);\n                };\n\n                text.write(pluginName, nonStripName, textWrite, config);\n            }, config);\n        }\n    };\n\n    if (masterConfig.env === 'node' || (!masterConfig.env &&\n            typeof process !== \"undefined\" &&\n            process.versions &&\n            !!process.versions.node &&\n            !process.versions['node-webkit'])) {\n        //Using special require.nodeRequire, something added by r.js.\n        fs = require.nodeRequire('fs');\n\n        text.get = function (url, callback, errback) {\n            try {\n                var file = fs.readFileSync(url, 'utf8');\n                //Remove BOM (Byte Mark Order) from utf8 files if it is there.\n                if (file.indexOf('\\uFEFF') === 0) {\n                    file = file.substring(1);\n                }\n                callback(file);\n            } catch (e) {\n                if (errback) {\n                    errback(e);\n                }\n            }\n        };\n    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&\n            text.createXhr())) {\n        text.get = function (url, callback, errback, headers) {\n            var xhr = text.createXhr(), header;\n            xhr.open('GET', url, true);\n\n            //Allow plugins direct access to xhr headers\n            if (headers) {\n                for (header in headers) {\n                    if (headers.hasOwnProperty(header)) {\n                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);\n                    }\n                }\n            }\n\n            //Allow overrides specified in config\n            if (masterConfig.onXhr) {\n                masterConfig.onXhr(xhr, url);\n            }\n\n            xhr.onreadystatechange = function (evt) {\n                var status, err;\n                //Do not explicitly handle errors, those should be\n                //visible via console output in the browser.\n                if (xhr.readyState === 4) {\n                    status = xhr.status || 0;\n                    if (status > 399 && status < 600) {\n                        //An http 4xx or 5xx error. Signal an error.\n                        err = new Error(url + ' HTTP status: ' + status);\n                        err.xhr = xhr;\n                        if (errback) {\n                            errback(err);\n                        }\n                    } else {\n                        callback(xhr.responseText);\n                    }\n\n                    if (masterConfig.onXhrComplete) {\n                        masterConfig.onXhrComplete(xhr, url);\n                    }\n                }\n            };\n            xhr.send(null);\n        };\n    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&\n            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {\n        //Why Java, why is this so awkward?\n        text.get = function (url, callback) {\n            var stringBuffer, line,\n                encoding = \"utf-8\",\n                file = new java.io.File(url),\n                lineSeparator = java.lang.System.getProperty(\"line.separator\"),\n                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),\n                content = '';\n            try {\n                stringBuffer = new java.lang.StringBuffer();\n                line = input.readLine();\n\n                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324\n                // http://www.unicode.org/faq/utf_bom.html\n\n                // Note that when we use utf-8, the BOM should appear as \"EF BB BF\", but it doesn't due to this bug in the JDK:\n                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058\n                if (line && line.length() && line.charAt(0) === 0xfeff) {\n                    // Eat the BOM, since we've already found the encoding on this file,\n                    // and we plan to concatenating this buffer with others; the BOM should\n                    // only appear at the top of a file.\n                    line = line.substring(1);\n                }\n\n                if (line !== null) {\n                    stringBuffer.append(line);\n                }\n\n                while ((line = input.readLine()) !== null) {\n                    stringBuffer.append(lineSeparator);\n                    stringBuffer.append(line);\n                }\n                //Make sure we return a JavaScript string and not a Java string.\n                content = String(stringBuffer.toString()); //String\n            } finally {\n                input.close();\n            }\n            callback(content);\n        };\n    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&\n            typeof Components !== 'undefined' && Components.classes &&\n            Components.interfaces)) {\n        //Avert your gaze!\n        Cc = Components.classes;\n        Ci = Components.interfaces;\n        Components.utils['import']('resource://gre/modules/FileUtils.jsm');\n        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);\n\n        text.get = function (url, callback) {\n            var inStream, convertStream, fileObj,\n                readData = {};\n\n            if (xpcIsWindows) {\n                url = url.replace(/\\//g, '\\\\');\n            }\n\n            fileObj = new FileUtils.File(url);\n\n            //XPCOM, you so crazy\n            try {\n                inStream = Cc['@mozilla.org/network/file-input-stream;1']\n                           .createInstance(Ci.nsIFileInputStream);\n                inStream.init(fileObj, 1, 0, false);\n\n                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']\n                                .createInstance(Ci.nsIConverterInputStream);\n                convertStream.init(inStream, \"utf-8\", inStream.available(),\n                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);\n\n                convertStream.readString(inStream.available(), readData);\n                convertStream.close();\n                inStream.close();\n                callback(readData.value);\n            } catch (e) {\n                throw new Error((fileObj && fileObj.path || '') + ': ' + e);\n            }\n        };\n    }\n    return text;\n});\n\n","\ndefine('text!templates/loading.html',[],function () { return '<style>\\n/**\\n * Loading page progress bars\\n * http://css-tricks.com/css3-progress-bars/\\n */\\n \\t.meter-wrapper{\\n \\t\\tposition: relative;\\n\\t\\ttop:50%;\\n \\t}\\n\\n\\t.meter {\\n\\t\\theight: 30px;  /* Can be anything */\\n\\t\\tposition: relative;\\n\\t\\tmargin-left: auto; margin-right: auto;\\n\\t\\tmargin-top:-15px;\\n\\t\\twidth:82%;\\n\\t\\tbackground: #555;\\n\\t\\t-moz-border-radius: 25px;\\n\\t\\t-webkit-border-radius: 25px;\\n\\t\\tborder-radius: 25px;\\n\\t\\tpadding: 10px;\\n\\t\\t-webkit-box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3);\\n\\t\\t-moz-box-shadow   : inset 0 -1px 1px rgba(255,255,255,0.3);\\n\\t\\tbox-shadow        : inset 0 -1px 1px rgba(255,255,255,0.3);\\n\\t}\\n\\t.meter > span {\\n\\t\\tdisplay: block;\\n\\t\\theight: 100%;\\n\\t\\t   -webkit-border-top-right-radius: 8px;\\n\\t\\t-webkit-border-bottom-right-radius: 8px;\\n\\t\\t\\t   -moz-border-radius-topright: 8px;\\n\\t\\t\\t-moz-border-radius-bottomright: 8px;\\n\\t\\t\\t\\t   border-top-right-radius: 8px;\\n\\t\\t\\t\\tborder-bottom-right-radius: 8px;\\n\\t\\t\\t-webkit-border-top-left-radius: 20px;\\n\\t\\t -webkit-border-bottom-left-radius: 20px;\\n\\t\\t\\t\\t-moz-border-radius-topleft: 20px;\\n\\t\\t\\t -moz-border-radius-bottomleft: 20px;\\n\\t\\t\\t\\t\\tborder-top-left-radius: 20px;\\n\\t\\t\\t\\t border-bottom-left-radius: 20px;\\n\\t\\tbackground-color: rgb(43,194,83);\\n\\t\\tbackground-image: -webkit-gradient(\\n\\t\\t  linear,\\n\\t\\t  left bottom,\\n\\t\\t  left top,\\n\\t\\t  color-stop(0, rgb(43,194,83)),\\n\\t\\t  color-stop(1, rgb(84,240,84))\\n\\t\\t );\\n\\t\\tbackground-image: -moz-linear-gradient(\\n\\t\\t  center bottom,\\n\\t\\t  rgb(43,194,83) 37%,\\n\\t\\t  rgb(84,240,84) 69%\\n\\t\\t );\\n\\t\\t-webkit-box-shadow:\\n\\t\\t  inset 0 2px 9px  rgba(255,255,255,0.3),\\n\\t\\t  inset 0 -2px 6px rgba(0,0,0,0.4);\\n\\t\\t-moz-box-shadow:\\n\\t\\t  inset 0 2px 9px  rgba(255,255,255,0.3),\\n\\t\\t  inset 0 -2px 6px rgba(0,0,0,0.4);\\n\\t\\tbox-shadow:\\n\\t\\t  inset 0 2px 9px  rgba(255,255,255,0.3),\\n\\t\\t  inset 0 -2px 6px rgba(0,0,0,0.4);\\n\\t\\tposition: relative;\\n\\t\\toverflow: hidden;\\n\\t}\\n\\t.meter > span:after, .animate > span > span {\\n\\t\\tcontent: \"\";\\n\\t\\tposition: absolute;\\n\\t\\ttop: 0; left: 0; bottom: 0; right: 0;\\n\\t\\tbackground-image:\\n\\t\\t   -webkit-gradient(linear, 0 0, 100% 100%,\\n\\t\\t\\t  color-stop(.25, rgba(255, 255, 255, .2)),\\n\\t\\t\\t  color-stop(.25, transparent), color-stop(.5, transparent),\\n\\t\\t\\t  color-stop(.5, rgba(255, 255, 255, .2)),\\n\\t\\t\\t  color-stop(.75, rgba(255, 255, 255, .2)),\\n\\t\\t\\t  color-stop(.75, transparent), to(transparent)\\n\\t\\t   );\\n\\t\\tbackground-image:\\n\\t\\t\\t-moz-linear-gradient(\\n\\t\\t\\t  -45deg,\\n\\t\\t\\t  rgba(255, 255, 255, .2) 25%,\\n\\t\\t\\t  transparent 25%,\\n\\t\\t\\t  transparent 50%,\\n\\t\\t\\t  rgba(255, 255, 255, .2) 50%,\\n\\t\\t\\t  rgba(255, 255, 255, .2) 75%,\\n\\t\\t\\t  transparent 75%,\\n\\t\\t\\t  transparent\\n\\t\\t   );\\n\\t\\tz-index: 1;\\n\\t\\t-webkit-background-size: 50px 50px;\\n\\t\\t-moz-background-size: 50px 50px;\\n\\t\\t-webkit-animation: move 2s linear infinite;\\n\\t\\t   -webkit-border-top-right-radius: 8px;\\n\\t\\t-webkit-border-bottom-right-radius: 8px;\\n\\t\\t\\t   -moz-border-radius-topright: 8px;\\n\\t\\t\\t-moz-border-radius-bottomright: 8px;\\n\\t\\t\\t\\t   border-top-right-radius: 8px;\\n\\t\\t\\t\\tborder-bottom-right-radius: 8px;\\n\\t\\t\\t-webkit-border-top-left-radius: 20px;\\n\\t\\t -webkit-border-bottom-left-radius: 20px;\\n\\t\\t\\t\\t-moz-border-radius-topleft: 20px;\\n\\t\\t\\t -moz-border-radius-bottomleft: 20px;\\n\\t\\t\\t\\t\\tborder-top-left-radius: 20px;\\n\\t\\t\\t\\t border-bottom-left-radius: 20px;\\n\\t\\toverflow: hidden;\\n\\t}\\n\\n\\t.animate > span:after {\\n\\t\\tdisplay: none;\\n\\t}\\n\\n\\t@-webkit-keyframes move {\\n\\t\\t0% {\\n\\t\\t   background-position: 0 0;\\n\\t\\t}\\n\\t\\t100% {\\n\\t\\t   background-position: 50px 50px;\\n\\t\\t}\\n\\t}\\n\\n\\t.orange > span {\\n\\t\\tbackground-color: #f1a165;\\n\\t\\tbackground-image: -moz-linear-gradient(top, #f1a165, #f36d0a);\\n\\t\\tbackground-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f1a165),color-stop(1, #f36d0a));\\n\\t\\tbackground-image: -webkit-linear-gradient(#f1a165, #f36d0a);\\n\\t}\\n\\n\\t.red > span {\\n\\t\\tbackground-color: #f0a3a3;\\n\\t\\tbackground-image: -moz-linear-gradient(top, #f0a3a3, #f42323);\\n\\t\\tbackground-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f0a3a3),color-stop(1, #f42323));\\n\\t\\tbackground-image: -webkit-linear-gradient(#f0a3a3, #f42323);\\n\\t}\\n\\n\\t.nostripes > span > span, .nostripes > span:after {\\n\\t\\t-webkit-animation: none;\\n\\t\\tbackground-image: none;\\n\\t}\\n</style>\\n\\n<div class=\"meter-wrapper\">\\n\\t<div class=\"meter\">\\n\\t\\t<span style=\"width: 0%\"></span>\\n\\t</div>\\n</div>';});\n\n","/*\n * The main view, responsible for managing the canvas\n */\ndefine('app/task/main_view',['require','backbone','jquery','underscore','./adjust_canvas','./canvasConstructor','app/task/script','text!templates/loading.html'],function(require){\n\n\tvar Backbone = require('backbone')\n\t\t, $ = require('jquery')\n\t\t, _ = require('underscore')\n\t\t, adjust_canvas = require('./adjust_canvas')\n\t\t, canvas = require('./canvasConstructor')\n\t\t,script = require('app/task/script')\n\t\t,loadingTpl = require('text!templates/loading.html');\n\n\n\tvar View = Backbone.View.extend({\n\n\t\tid: 'canvas',\n\n\t\tinitialize: function(){\n\t\t\t_.bindAll(this, ['activate','render','destroy']);\n\n\t\t\tthis.deferred = $.Deferred();\n\t\t\tthis.deferred.promise().always(this.destroy);\n\n\t\t\t/**\n\t\t\t * Adjust canvas listener\n\t\t\t * @type {[type]}\n\t\t\t */\n\t\t\tvar adjust = _.bind(this.adjustCanvas,this);\n\t\t\t$(window).on('orientationchange.pip resize.pip', adjust);\n\t\t\tthis.deferred.promise().always(function(){\n\t\t\t\t$(window).off('orientationchange.pip resize.pip', adjust);\n\t\t\t});\n\t\t},\n\n\t\trender: function(){\n\t\t\tthis.adjustCanvas(true);\n\t\t\treturn this;\n\t\t},\n\n\t\tactivate: function(){\n\t\t\tvar self = this;\n\t\t\tvar canvasSettings = script().settings.canvas || {};\n\t\t\tvar docReady = $.Deferred(); // document ready deferred, so we can continue only after activation has culminated\n\n\t\t\t$(document).ready(function(){\n\n\t\t\t\tvar map = {\n\t\t\t\t\tbackground \t\t\t: {element: $('body'), property: 'backgroundColor'},\n\t\t\t\t\tcanvasBackground\t: {element: self.$el, property:'backgroundColor'},\n\t\t\t\t\tborderColor\t\t\t: {element: self.$el, property:'borderColor'},\n\t\t\t\t\tborderWidth\t\t\t: {element: self.$el, property:'borderWidth'}\n\t\t\t\t};\n\n\t\t\t\t// settings activator\n\t\t\t\tvar off = canvas(map, _.pick(canvasSettings,['background','canvasBackground','borderColor','borderWidth']));\n\t\t\t\tself.deferred.promise().always(off);\n\n\t\t\t\tcanvasSettings.css && self.$el.css(canvasSettings.css);\n\n\t\t\t\t// append to body and render\n\t\t\t\tif ($('[pi-player]').length){\n\t\t\t\t\t$('[pi-player]').empty().append(self.$el);\n\t\t\t\t} else {\n\t\t\t\t\tself.$el.appendTo('body');\n\t\t\t\t}\n\n\t\t\t\tself.render();\n\t\t\t\tdocReady.resolve();\n\t\t\t});\n\n\t\t\treturn docReady;\n\t\t},\n\n\t\t// display loading page\n\t\tloading: function(parseDef){\n\t\t\tvar $bar;\n\n\t\t\t// if loading has already finished lets skip the loading page\n\t\t\tif (parseDef.state() != \"pending\"){\n\t\t\t\treturn parseDef;\n\t\t\t}\n\n\t\t\t// display the loading template\n\t\t\tthis.$el.html(loadingTpl);\n\n\t\t\t$bar = this.$('.meter span');\n\n\t\t\treturn parseDef\n\t\t\t\t.progress(function(done, remaining){\n\t\t\t\t\t// update progress bar\n\t\t\t\t\t$bar.width((remaining ? (done/remaining)*100 : 0) + '%');\n\t\t\t\t});\n\t\t},\n\n\t\tempty: function(){\n\t\t\tthis.$el.empty();\n\t\t},\n\n\t\tdestroy: function(){\n\t\t\t$(window).off('.pip');\n\t\t\tthis.remove();\n\t\t\tthis.unbind();\n\t\t},\n\n\t\t// sets canvas size (used also for refreshing upon orientation change)\n\t\tadjustCanvas: adjust_canvas\n\t});\n\n\t// Returns the View class\n\treturn new View();\n});\n","define('utils/database/mixer/mixer',['underscore'],function(_){\n\n\t/**\n\t * A function that maps a mixer object into a sequence.\n\t *\n\t * The basic structure of such an obect is:\n\t * {\n\t *\t\tmixer: 'functionType',\n\t *\t\tremix : false,\n\t *\t\tdata: [task1, task2]\n\t *\t}\n\t *\n\t * The results of the mix are set into `$parsed` within the original mixer object.\n\t * if remix is true $parsed is returned instead of recomputing\n\t *\n\t * @param {Object} [obj] [a mixer object]\n\t * @returns {Array} [An array of mixed objects]\n\t */\n\n\tmixProvider.$inject = ['randomizeShuffle', 'randomizeRandom'];\n\tfunction mixProvider(shuffle, random){\n\n\t\tfunction mix(obj){\n\t\t\tvar mixerName = obj.mixer;\n\n\t\t\t// if this isn't a mixer\n\t\t\t// make sure we catch mixers that are set with undefined by accident...\n\t\t\tif (!(_.isPlainObject(obj) && 'mixer' in obj)){\n\t\t\t\treturn [obj];\n\t\t\t}\n\n\t\t\tif (_.isUndefined(mix.mixers[mixerName])){\n\t\t\t\tthrow new Error('Mixer: unknow mixer type = ' + mixerName);\n\t\t\t}\n\n\t\t\tif (!obj.remix && obj.$parsed) {\n\t\t\t\treturn obj.$parsed;\n\t\t\t}\n\n\t\t\tobj.$parsed = mix.mixers[mixerName].apply(null, arguments);\n\n\t\t\treturn obj.$parsed;\n\t\t}\n\n\t\tmix.mixers = {\n\t\t\twrapper : function(obj){\n\t\t\t\treturn obj.data;\n\t\t\t},\n\n\t\t\trepeat: function(obj){\n\t\t\t\t\tvar sequence = obj.data || [];\n\t\t\t\t\tvar result = [], i;\n\t\t\t\t\tfor (i=0; i < obj.times; i++){\n\t\t\t\t\t\tresult = result.concat(_.clone(sequence,true));\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t// randomize any elements\n\t\t\trandom: function(obj, context){\n\n\t\t\t\tfunction randomDeepMixer(sequence){\n\t\t\t\t\treturn _.reduce(sequence, function(arr,value){\n\t\t\t\t\t\tif (_.isPlainObject(value) && 'mixer' in value && value.mixer != 'wrapper'){\n\t\t\t\t\t\t\tvar seq = mix(value, context);\n\t\t\t\t\t\t\treturn arr.concat(seq);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn arr.concat([value]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, []);\n\t\t\t\t}\n\n\t\t\t\tvar sequence = obj.data || [];\n\t\t\t\treturn shuffle(randomDeepMixer(sequence));\n\t\t\t},\n\n\t\t\tchoose: function(obj){\n\t\t\t\tvar sequence = obj.data || [];\n\t\t\t\treturn _.take(shuffle(sequence), obj.n ? obj.n : 1);\n\t\t\t},\n\n\t\t\tweightedRandom: function(obj){\n\t\t\t\tvar sequence = obj.data || [];\n\t\t\t\tvar i;\n\t\t\t\tvar total_weight = _.reduce(obj.weights,function (prev, cur) {\n\t\t\t\t\treturn prev + cur;\n\t\t\t\t});\n\n\t\t\t\tvar random_num = random() * total_weight; // cutoff - when we reach this sum - we've reached the desired weight\n\t\t\t\tvar weight_sum = 0;\n\n\t\t\t\tfor (i = 0; i < sequence.length; i++) {\n\t\t\t\t\tweight_sum += obj.weights[i];\n\t\t\t\t\tweight_sum = +weight_sum.toFixed(3);\n\n\t\t\t\t\tif (random_num <= weight_sum) {\n\t\t\t\t\t\treturn [obj.data[i]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow new Error('Mixer: something went wrong with weightedRandom');\n\t\t\t}\n\t\t};\n\n\t\treturn mix;\n\t}\n\n\treturn mixProvider;\n});\n","define('utils/database/mixer/branching/dotNotation',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tfunction dotNotation(chain, obj){\n\n\t\tif (_.isString(chain)){\n\t\t\tchain = chain.split('.');\n\t\t}\n\n\t\treturn _.reduce(chain, function(result, link){\n\n\t\t\tif (_.isPlainObject(result) || _.isArray(result)){\n\t\t\t\treturn result[link];\n\t\t\t}\n\n\t\t\treturn undefined;\n\n\t\t}, obj);\n\t}\n\n\treturn dotNotation;\n});\n","define('utils/database/mixer/branching/mixerDotNotationProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tmixerDotNotationProvider.$inject = ['dotNotation'];\n\tfunction mixerDotNotationProvider(dotNotation){\n\n\t\tfunction mixerDotNotation(chain, obj){\n\n\t\t\tvar escapeSeparatorRegex= /[^\\/]\\./;\n\n\t\t\tif (!_.isString(chain)){\n\t\t\t\treturn chain;\n\t\t\t}\n\n\t\t\t// We do not have a non escaped dot: we treat this as a string\n\t\t\tif (!escapeSeparatorRegex.test(chain)){\n\t\t\t\treturn chain.replace('/.','.');\n\t\t\t}\n\n\t\t\treturn dotNotation(chain, obj);\n\t\t}\n\n\t\treturn mixerDotNotation;\n\t}\n\n\treturn mixerDotNotationProvider;\n\n});\n","define('utils/database/mixer/branching/mixerConditionProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tmixerConditionProvider.$inject = ['mixerDotNotation', 'piConsole'];\n\tfunction mixerConditionProvider(dotNotation, piConsole){\n\n\t\tfunction mixerCondition(condition, context){\n\t\t\tvar left, right, operator;\n\n\t\t\t// support a condition that is a plain function\n\t\t\tif (_.isFunction(condition)){\n\t\t\t\toperator = condition;\n\t\t\t} else {\n\t\t\t\t// @TODO angular.$parse may be a better candidate for doing this...\n\t\t\t\tleft = dotNotation(condition.compare,context);\n\t\t\t\tright = dotNotation(condition.to,context);\n\t\t\t\toperator = condition.operator;\n\t\t\t}\n\n\t\t\tpiConsole(['conditions']).info('Condition: ', left, operator || 'equals', right, condition);\n\n\t\t\tif (_.isFunction(operator)){\n\t\t\t\treturn !! operator.apply(context,[left, right, context]);\n\t\t\t}\n\n\t\t\tswitch(operator){\n\t\t\t\tcase 'greaterThan':\n\t\t\t\t\tif (_.isNumber(left) && _.isNumber(right)){\n\t\t\t\t\t\treturn +left > +right;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\n\t\t\t\tcase 'greaterThanOrEqual':\n\t\t\t\t\tif (_.isNumber(left) && _.isNumber(right)){\n\t\t\t\t\t\treturn +left >= +right;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\n\t\t\t\tcase 'in':\n\t\t\t\t\tif (_.isArray(right)){\n\t\t\t\t\t\t// binary operator to turn indexOf into binary.\n\t\t\t\t\t\treturn ~_.indexOf(right, left);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\n\t\t\t\tcase 'exactly':\n\t\t\t\t\treturn left === right;\n\n\t\t\t\tcase 'equals':\n\t\t\t\t\t/* falls through */\n\t\t\t\tdefault:\n\t\t\t\t\tif (_.isUndefined(right)){\n\t\t\t\t\t\treturn !!left;\n\t\t\t\t\t}\n\t\t\t\t\treturn _.isEqual(left, right);\n\t\t\t}\n\n\t\t\treturn operator;\n\t\t}\n\n\t\treturn mixerCondition;\n\t}\n\n\treturn mixerConditionProvider;\n});\n","define('utils/database/mixer/branching/mixerEvaluateProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tevaluateProvider.$inject = ['mixerCondition'];\n\tfunction evaluateProvider(condition){\n\t\t/**\n\t\t * Checks if a conditions set is true\n\t\t * @param  {Array} conditions [an array of conditions]\n\t\t * @param  {Object} context   [A context for the condition checker]\n\t\t * @return {Boolean}          [Are these conditions true]\n\t\t */\n\n\t\tfunction evaluate(conditions,context){\n\t\t\t// make && the default\n\t\t\t_.isArray(conditions) && (conditions = {and:conditions});\n\n\t\t\tfunction test(cond){return evaluate(cond,context);}\n\n\t\t\t// && objects\n\t\t\tif (conditions.and){\n\t\t\t\treturn _.every(conditions.and, test);\n\t\t\t}\n\t\t\tif (conditions.nand){\n\t\t\t\treturn !_.every(conditions.nand, test);\n\t\t\t}\n\n\t\t\t// || objects\n\t\t\tif (conditions.or){\n\t\t\t\treturn _.some(conditions.or, test);\n\t\t\t}\n\t\t\tif (conditions.nor){\n\t\t\t\treturn !_.some(conditions.nor, test);\n\t\t\t}\n\n\t\t\treturn condition(conditions, context);\n\t\t}\n\n\t\treturn evaluate;\n\t}\n\n\treturn evaluateProvider;\n});\n","/**\n * Registers the branching mixers with the mixer\n * @return {function}         [mixer decorator]\n */\ndefine('utils/database/mixer/branching/mixerBranchingDecorator',['require','underscore'],function(require){\n\n\tvar _ = require('underscore');\n\n\tmixerBranchingDecorator.$inject = ['$delegate','mixerEvaluate','mixerDefaultContext'];\n\tfunction mixerBranchingDecorator(mix, evaluate, mixerDefaultContext){\n\n\t\tmix.mixers.branch = branch;\n\t\tmix.mixers.multiBranch = multiBranch;\n\n\t\treturn mix;\n\n\t\t/**\n\t\t * Branching mixer\n\t\t * @return {Array}         [A data array with objects to continue with]\n\t\t */\n\t\tfunction branch(obj, context){\n\t\t\tcontext = _.extend(context || {}, mixerDefaultContext);\n\t\t\treturn evaluate(obj.conditions, context) ? obj.data || [] : obj.elseData || [];\n\t\t}\n\n\t\t/**\n\t\t * multiBranch mixer\n\t\t * @return {Array}         [A data array with objects to continue with]\n\t\t */\n\t\tfunction multiBranch(obj, context){\n\t\t\tcontext = _.extend(context || {}, mixerDefaultContext);\n\t\t\tvar row;\n\n\t\t\trow = _.find(obj.branches, function(branch){\n\t\t\t\treturn evaluate(branch.conditions, context);\n\t\t\t});\n\n\t\t\tif (row) {\n\t\t\t\treturn row.data || [];\n\t\t\t}\n\n\t\t\treturn obj.elseData || [];\n\t\t}\n\t}\n\n\treturn mixerBranchingDecorator;\n});\n","define('utils/database/mixer/mixerSequenceProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tmixerSequenceProvider.$inject = ['mixer'];\n\tfunction mixerSequenceProvider(mix){\n\n\t\t/**\n\t\t * MixerSequence takes an mixer array and allows browsing back and forth within it\n\t\t * @param {Array} arr [a mixer array]\n\t\t */\n\t\tfunction MixerSequence(arr){\n\t\t\tthis.sequence = arr;\n\t\t\tthis.stack = [];\n\t\t\tthis.add(arr);\n\t\t\tthis.pointer = 0;\n\t\t}\n\n\t\t_.extend(MixerSequence.prototype, {\n\t\t\t/**\n\t\t\t * Add sequence to mixer\n\t\t\t * @param {[type]} arr     Sequence\n\t\t\t * @param {[type]} reverse Whether to start from begining or end\n\t\t\t */\n\t\t\tadd: function(arr, reverse){\n\t\t\t\tthis.stack.push({pointer:reverse ? arr.length : -1,sequence:arr});\n\t\t\t},\n\n\t\t\tproceed: function(direction, context){\n\t\t\t\t// get last subSequence\n\t\t\t\tvar subSequence = this.stack[this.stack.length-1];\n\t\t\t\tvar isNext = (direction === 'next');\n\n\t\t\t\t// if we ran out of sequence\n\t\t\t\t// add the original sequence back in\n\t\t\t\tif (!subSequence) {\n\t\t\t\t\tthrow new Error ('mixerSequence: subSequence not found');\n\t\t\t\t}\n\n\t\t\t\tsubSequence.pointer += isNext ? 1 : -1;\n\n\t\t\t\tvar el = subSequence.sequence[subSequence.pointer];\n\n\t\t\t\t// if we ran out of elements, go to previous level (unless we are on the root sequence)\n\t\t\t\tif (_.isUndefined(el) && this.stack.length > 1){\n\t\t\t\t\tthis.stack.pop();\n\t\t\t\t\treturn this.proceed.call(this,direction,context);\n\t\t\t\t}\n\n\t\t\t\t// if element is a mixer, mix it\n\t\t\t\tif (el && el.mixer){\n\t\t\t\t\tthis.add(mix(el,context), !isNext);\n\t\t\t\t\treturn this.proceed.call(this,direction,context);\n\t\t\t\t}\n\n\t\t\t\t// regular element or undefined (end of sequence)\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tnext: function(context){\n\t\t\t\tthis.pointer++;\n\t\t\t\treturn this.proceed.call(this, 'next',context);\n\t\t\t},\n\n\t\t\tprev: function(context){\n\t\t\t\tthis.pointer--;\n\t\t\t\treturn this.proceed.call(this, 'prev',context);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Return current element\n\t\t\t * should **never** return a mixer - supposed to abstract them away\n\t\t\t * @return {[type]} undefined or element\n\t\t\t */\n\t\t\tcurrent:function(){\n\t\t\t\t// get last subSequence\n\t\t\t\tvar subSequence = this.stack[this.stack.length-1];\n\n\t\t\t\tif (!subSequence) {\n\t\t\t\t\tthrow new Error ('mixerSequence: subSequence not found');\n\t\t\t\t}\n\n\t\t\t\tvar el = subSequence.sequence[subSequence.pointer];\n\n\t\t\t\tif (!el){\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// extend element with meta data\n\t\t\t\tel.$meta = this.meta();\n\n\t\t\t\treturn el;\n\t\t\t},\n\n\t\t\tmeta: function(){\n\t\t\t\treturn {\n\t\t\t\t\tnumber: this.pointer,\n\n\t\t\t\t\t// sum of sequence length, minus one (the mixer) for each level of stack except the last\n\t\t\t\t\toutOf:  _.reduce(this.stack, function(memo,sub){return memo + sub.sequence.length-1;},0)+1\n\t\t\t\t};\n\t\t\t}\n\n\t\t});\n\n\t\treturn MixerSequence;\n\t}\n\n\treturn mixerSequenceProvider;\n});\n\n\n\n\n\n\n","define('utils/database/mixer/main',['require','underscore','./mixer','./branching/dotNotation','./branching/mixerDotNotationProvider','./branching/mixerConditionProvider','./branching/mixerEvaluateProvider','./branching/mixerBranchingDecorator','./mixerSequenceProvider'],function(require){\n\tvar _ = require('underscore');\n\n\tvar mixer = require('./mixer')(\n\t\t_.shuffle, // randomizeShuffle\n\t\tMath.random // randomizeRandom\n\t);\n\n\tvar dotNotation = require('./branching/dotNotation'); // this is a value, doesn't need to be evaluated\n\n\tvar mixerDotNotation = require('./branching/mixerDotNotationProvider')(dotNotation);\n\tvar mixerCondition = require('./branching/mixerConditionProvider')(\n\t\tmixerDotNotation,\n\t\tpiConsole\n\t);\n\n\tvar mixerEvaluate = require('./branching/mixerEvaluateProvider')(mixerCondition);\n\n\tvar mixerDefaultContext = {};\n\n\trequire('./branching/mixerBranchingDecorator')(\n\t\tmixer,\n\t\tmixerEvaluate,\n\t\tmixerDefaultContext\n\t);\n\n\tvar MixerSequence = require('./mixerSequenceProvider')(mixer);\n\n\treturn MixerSequence;\n\n\tfunction piConsole(){\n\t\treturn console;\n\t}\n\n});\n","define('utils/database/template/templateObjProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\ttemplateObjProvider.$inject = ['$filter'];\n\tfunction templateObjProvider($filter){\n\t\tvar filter = $filter('template');\n\n\t\tfunction templateObj(obj, context, options){\n\t\t\toptions || (options = {});\n\t\t\tvar result = {};\n\t\t\tvar skip = options.skip || [];\n\n\t\t\t_.forEach(obj, function(value,key,obj){\n\t\t\t\tif (!_.includes(skip, key)){\n\t\t\t\t\tresult[key] = expand(value, context);\n\t\t\t\t} else {\n\t\t\t\t\tresult[key] = obj[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}\n\n\t\treturn templateObj;\n\n\t\tfunction expand(value, context){\n\n\t\t\tif (_.isString(value)){\n\t\t\t\treturn filter(value, context);\n\t\t\t}\n\n\t\t\tif (_.isArray(value)){\n\t\t\t\treturn _.map(value, _.bind(expand, null, _, context));\n\t\t\t}\n\n\t\t\tif (_.isPlainObject(value)){\n\t\t\t\treturn _.mapValues(value, _.bind(expand, null, _, context));\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t}\n\n\n\treturn templateObjProvider;\n});\n","define('utils/database/template/templateFilter',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\ttemplateFilter.$inject = ['$log','templateDefaultContext'];\n\tfunction templateFilter($log, defaultContext){\n\n\t\tfunction template(input, context){\n\n\t\t\t// if there is no template just return the string\n\t\t\tif (!~input.indexOf('<%')){\n\t\t\t\treturn input;\n\t\t\t}\n\n\t\t\t// build context (extend it with the default context)\n\t\t\tcontext = _.extend(context || {}, defaultContext);\n\n\t\t\t// filters don't throw errors when used from within templates\n\t\t\t// therefore we need catch any errors here... (we may decide to drop this if it hits performance too mutch...)\n\t\t\ttry{\n\t\t\t\treturn _.template(input)(context);\n\t\t\t} catch(e){\n\t\t\t\t$log.error(\"ERROR: \\\"\" + e.message + \"\\\" in the following template: \", input);\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t}\n\n\t\treturn template;\n\n\t}\n\n\treturn templateFilter;\n});\n","define('utils/database/template/main',['require','./templateObjProvider','./templateFilter'],function(require){\n\treturn require('./templateObjProvider')(\n\t\t// $filter('template')\n\t\tfunction(){\n\t\t\treturn require('./templateFilter')(console, {}); // $log, defaultContext\n\t\t}\n\t);\n\n});\n","define('utils/database/collection/collectionProvider',['underscore'],function(_){\n\t/*\n\t * The constructor for an Array wrapper\n\t */\n\n\tfunction collectionService(){\n\n\t\tfunction Collection (arr) {\n\t\t\tif (arr instanceof Collection) {\n\t\t\t\treturn arr;\n\t\t\t}\n\n\t\t\t// Make sure we are creating this array out of a valid argument\n\t\t\tif (!_.isUndefined(arr) && !_.isArray(arr) && !(arr instanceof Collection)) {\n\t\t\t\tthrow new Error('Collections can only be constructed from arrays');\n\t\t\t}\n\n\t\t\tthis.collection = arr || [];\n\t\t\tthis.length = this.collection.length;\n\n\t\t\t// pointer to the current location within the array\n\t\t\t// we start with -1 so that the initial next points to the begining of the array\n\t\t\tthis.pointer = -1;\n\t\t}\n\n\t\t_.extend(Collection.prototype,{\n\n\t\t\tfirst : function first(){\n\t\t\t\tthis.pointer = 0;\n\t\t\t\treturn this.collection[this.pointer];\n\t\t\t},\n\n\t\t\tlast : function last(){\n\t\t\t\tthis.pointer = this.collection.length - 1;\n\t\t\t\treturn this.collection[this.pointer];\n\t\t\t},\n\n\t\t\tend : function end(){\n\t\t\t\tthis.pointer = this.collection.length;\n\t\t\t\treturn undefined;\n\t\t\t},\n\n\t\t\tcurrent : function(){\n\t\t\t\treturn this.collection[this.pointer];\n\t\t\t},\n\n\t\t\tnext : function(){\n\t\t\t\treturn this.collection[++this.pointer];\n\t\t\t},\n\n\t\t\tprevious : function(){\n\t\t\t\treturn this.collection[--this.pointer];\n\t\t\t},\n\n\t\t\t// add list of items to the collection\n\t\t\tadd : function(list){\n\t\t\t\t// dont allow adding nothing\n\t\t\t\tif (!arguments.length) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\t// make sure list is as an array\n\t\t\t\tlist = _.isArray(list) ? list : [list];\n\t\t\t\tthis.collection = this.collection.concat(list);\n\n\t\t\t\tthis.length = this.collection.length;\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t// return the item at index\n\t\t\tat: function(index){\n\t\t\t\treturn this.collection[index];\n\t\t\t}\n\t\t});\n\n\n\t\t// Stuff we took out of bootstrap that can augment the collection\n\t\t// **************************************************************\n\t\tvar methods = ['where','filter'];\n\t\tvar slice = Array.prototype.slice;\n\n\t\t// Mix in each Underscore method as a proxy to `Collection#models`.\n\t\t_.each(methods, function(method) {\n\t\t\tCollection.prototype[method] = function() {\n\t\t\t\tvar args = slice.call(arguments);\n\t\t\t\targs.unshift(this.collection);\n\t\t\t\tvar coll = _[method].apply(_,args);\n\t\t\t\treturn new Collection(coll);\n\t\t\t};\n\t\t});\n\n\t\treturn Collection;\n\t}\n\n\treturn collectionService;\n\n\n});\n","define('utils/database/randomizer/randomizerProvider',['underscore'],function(_){\n\n\t// @TODO: repeat currently repeats only the last element, we need repeat = 'set' or something in order to prevent re-randomizing of exRandom...\n\n\tRandomizerProvider.$inject = ['randomizeInt', 'randomizeRange', 'Collection'];\n\tfunction RandomizerProvider(randomizeInt, randomizeRange, Collection){\n\n\t\tfunction Randomizer(){\n\t\t\tthis._cache = {\n\t\t\t\trandom : {},\n\t\t\t\texRandom : {},\n\t\t\t\tsequential : {}\n\t\t\t};\n\t\t}\n\n\t\t_.extend(Randomizer.prototype, {\n\t\t\trandom: random,\n\t\t\texRandom: exRandom,\n\t\t\tsequential: sequential\n\t\t});\n\n\t\treturn Randomizer;\n\n\t\tfunction random(length, seed, repeat){\n\t\t\tvar cache  = this._cache.random;\n\n\t\t\tif (repeat && !_.isUndefined(cache[seed])) {\n\t\t\t\treturn cache[seed];\n\t\t\t}\n\n\t\t\t// save result in cache\n\t\t\tcache[seed] = randomizeInt(length);\n\n\t\t\treturn cache[seed];\n\t\t}\n\n\t\tfunction sequential(length, seed, repeat){\n\t\t\tvar cache = this._cache.sequential;\n\t\t\tvar coll = cache[seed];\n\t\t\tvar result;\n\n\t\t\t// if needed create collection and set it in seed\n\t\t\tif (_.isUndefined(coll)){\n\t\t\t\tcoll = cache[seed] = new Collection(_.range(length));\n\t\t\t\treturn coll.first();\n\t\t\t}\n\n\t\t\tif (coll.length !== length){\n\t\t\t\tthrow new Error(\"This seed  (\"+ seed +\") points to a collection with the wrong length, you can only use a seed for sets of the same length\");\n\t\t\t}\n\n\t\t\t// if this is a repeated element:\n\t\t\tif (repeat) {\n\t\t\t\treturn coll.current();\n\t\t\t}\n\n\t\t\t// if we've reached the end\n\t\t\tresult = coll.next();\n\n\t\t\t// if we've reached the end of the collection (next)\n\t\t\tif (_.isUndefined(result)){\n\t\t\t\treturn coll.first();\n\t\t\t} else {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tfunction exRandom(length, seed, repeat){\n\t\t\tvar cache = this._cache.exRandom;\n\t\t\tvar coll = cache[seed];\n\t\t\tvar result;\n\n\t\t\t// if needed create collection and set it in seed\n\t\t\tif (_.isUndefined(coll)){\n\t\t\t\tcoll = cache[seed] = new Collection(randomizeRange(length));\n\t\t\t\treturn coll.first();\n\t\t\t}\n\n\t\t\tif (coll.length !== length){\n\t\t\t\tthrow new Error(\"This seed  (\"+ seed +\") points to a collection with the wrong length, you can only use a seed for sets of the same length\");\n\t\t\t}\n\n\t\t\t// if this is a repeated element:\n\t\t\tif (repeat) {\n\t\t\t\treturn coll.current();\n\t\t\t}\n\n\t\t\t// if we've reached the end\n\t\t\tresult = coll.next();\n\n\t\t\t// if we've reached the end of the collection (next)\n\t\t\t// we should re-randomize\n\t\t\tif (_.isUndefined(result)){\n\t\t\t\tcoll = cache[seed] = new Collection(randomizeRange(length));\n\t\t\t\treturn coll.first();\n\t\t\t} else {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t}\n\n\treturn RandomizerProvider;\n\n});\n","define('utils/database/queryProvider',['underscore'],function(_){\n\n\tqueryProvider.$inject = ['Collection','piConsole'];\n\tfunction queryProvider(Collection, $console){\n\n\t\tfunction queryFn(query, collection, randomizer){\n\t\t\tvar coll = new Collection(collection);\n\n\t\t\t// shortcuts:\n\t\t\t// ****************************\n\n\t\t\t// use function instead of query object.\n\t\t\tif (_.isFunction(query)){\n\t\t\t\treturn query(collection);\n\t\t\t}\n\n\t\t\t// pure string query\n\t\t\tif (_.isString(query) || _.isNumber(query)){\n\t\t\t\tquery = {set:query, type:'random'};\n\t\t\t}\n\n\t\t\t// narrow down by set\n\t\t\t// ****************************\n\t\t\tif (query.set){\n\t\t\t\tcoll = coll.where({set:query.set});\n\t\t\t}\n\n\t\t\t// narrow down by data\n\t\t\t// ****************************\n\t\t\tif (_.isString(query.data)){\n\t\t\t\tcoll = coll.filter(function(q){\n\t\t\t\t\treturn q.handle === query.data || (q.data && q.data.handle === query.data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (_.isPlainObject(query.data)){\n\t\t\t\tcoll = coll.where({data:query.data});\n\t\t\t}\n\n\t\t\tif (_.isFunction(query.data)){\n\t\t\t\tcoll = coll.filter(query.data);\n\t\t\t}\n\n\t\t\t// pick by type\n\t\t\t// ****************************\n\n\t\t\t// the default seed is namespace specific just to minimize the situations where seeds clash across namespaces\n\t\t\tvar seed = query.seed || ('$' + collection.namespace + query.set);\n\t\t\tvar length = coll.length;\n\t\t\tvar repeat = query.repeat;\n\t\t\tvar at;\n\t\t\tvar err;\n\n\t\t\tswitch (query.type){\n\t\t\t\tcase undefined:\n\t\t\t\tcase 'byData':\n\t\t\t\tcase 'random':\n\t\t\t\t\tat = randomizer.random(length,seed,repeat);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'exRandom':\n\t\t\t\t\tat = randomizer.exRandom(length,seed,repeat);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sequential':\n\t\t\t\t\tat = randomizer.sequential(length,seed,repeat);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'first':\n\t\t\t\t\tat = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'last':\n\t\t\t\t\tat = length-1;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Unknow query type: ' + query.type);\n\t\t\t}\n\n\t\t\tif (_.isUndefined(coll.at(at))) {\n\t\t\t\terr = new Error('Query failed, object (' + JSON.stringify(query) +\t') not found. If you are trying to apply a template, you should know that they are not supported for inheritance.');\n\t\t\t\t$console('query').error(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\treturn coll.at(at);\n\t\t}\n\n\t\treturn queryFn;\n\t}\n\n\treturn queryProvider;\n});\n","/*\n * inflates an object\n * this function is responsible for inheritance\n *\n * function inflate(source,coll, randomizer, recursive, counter)\n * @param source: the object to inflate\n * @param coll: a collection to inherit from\n * @param randomizer: a randomizer object for the query\n * @param recursive: private use only, is this inside the recursion (true) or top level (false)\n * @param depth: private use only, a counter for the depth of the recursion\n */\ndefine('utils/database/inflateProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tinflateProvider.$inject = ['databaseQuery','$rootScope','piConsole'];\n\tfunction inflateProvider(query, $rootScope, $console){\n\n\t\tfunction customize(source){\n\t\t\t// check for a custom function and run it if it exists\n\t\t\tif (_.isFunction(source.customize)){\n\t\t\t\tsource.customize.apply(source, [source, $rootScope.global]);\n\t\t\t}\n\t\t\treturn source;\n\t\t}\n\n\t\t// @param source - object to inflate\n\t\t// @param type - trial stimulus or media\n\t\t// @param recursive - whether this is a recursive call or not\n\t\tfunction inflate(source, coll, randomizer, recursive, depth){\n\n\t\t\t// protection against infinte loops\n\t\t\t// ***********************************\n\t\t\tdepth = recursive ? --depth : 10;\n\n\t\t\tif (!depth) {\n\t\t\t\tthrow new Error('Inheritance loop too deep, you can only inherit up to 10 levels down');\n\t\t\t}\n\n\t\t\tif (!_.isPlainObject(source)){\n\t\t\t\tthrow new Error('You are trying to inflate a non object');\n\t\t\t}\n\n\t\t\tvar parent\n\t\t\t\t// create child\n\t\t\t\t, child = _.cloneDeep(source)\n\t\t\t\t, err\n\t\t\t\t, inheritObj = child.inherit;\n\n\n\t\t\t// no inheritance\n\t\t\t// ***********************************\n\n\t\t\t// if we do not need to inherit anything, simply return source\n\t\t\tif (!child.inherit) {\n\t\t\t\t// customize only on the last call (non recursive)\n\t\t\t\t!recursive && customize(child);\n\t\t\t\treturn child;\n\t\t\t}\n\n\t\t\t// get parent\n\t\t\t// ***********************************\n\t\t\tparent = query(inheritObj, coll, randomizer);\n\n\t\t\t// if inherit target was not found\n\t\t\tif (!parent){\n\t\t\t\terr = new Error('Query failed, object (' + JSON.stringify(inheritObj) +\t') not found.');\n\t\t\t\t$console('query').error(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\t// inflate parent (recursively)\n\t\t\tparent = inflate(\n\t\t\t\tparent,\n\t\t\t\tcoll,\n\t\t\t\trandomizer,\n\t\t\t\ttrue,\n\t\t\t\tdepth\n\t\t\t);\n\n\t\t\t// extending the child\n\t\t\t// ***********************************\n\t\t\tif (inheritObj.merge && !_.isArray(inheritObj.merge)){\n\t\t\t\tthrow new Error('Inheritance error: inherit.merge must be an array.');\n\t\t\t}\n\n\t\t\t// start inflating child (we have to extend selectively...)\n\t\t\t_.each(parent, function(value, key){\n\t\t\t\tvar childProp, parentProp;\n\t\t\t\t// if this key is not set yet, copy it out of the parent\n\t\t\t\tif (!(key in child)){\n\t\t\t\t\tchild[key] = _.isFunction(value) ? value : _.cloneDeep(value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// if we have a merge array,\n\t\t\t\tif (_.indexOf(inheritObj.merge, key) != -1){\n\t\t\t\t\tchildProp = child[key];\n\t\t\t\t\tparentProp = value;\n\n\t\t\t\t\tif (_.isArray(childProp)){\n\t\t\t\t\t\tif (!_.isArray(parentProp)){\n\t\t\t\t\t\t\tthrow new Error('Inheritance error: You tried merging an array with an non array (for \"' + key + '\")');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchild[key] = childProp.concat(parentProp);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_.isPlainObject(childProp)){\n\t\t\t\t\t\tif (!_.isPlainObject(parentProp)){\n\t\t\t\t\t\t\tthrow new Error('Inheritance error: You tried merging an object with an non object (for \"' + key + '\")');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_.extend(childProp, parentProp);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// we want to extend the childs data even if it already exists\n\t\t\t// its ok to shallow extend here (because by definition parent was created for this inflation)\n\t\t\tif (parent.data){\n\t\t\t\tchild.data = _.extend(parent.data, child.data || {});\n\t\t\t}\n\n\t\t\t// Personal customization functions - only if this is the last iteration of inflate\n\t\t\t// This way the customize function gets called only once.\n\t\t\t!recursive && customize(child);\n\n\t\t\t// return inflated trial\n\t\t\treturn child;\n\t\t}\n\n\t\treturn inflate;\n\t}\n\n\treturn inflateProvider;\n});\n","/*\n *\tThe store is a collection of collection devided into namespaces.\n *\tYou can think of every namespace/collection as a table.\n */\ndefine('utils/database/store/storeProvider',['underscore'],function(_){\n\n\tstoreProvider.$inject = ['Collection'];\n\tfunction storeProvider(Collection){\n\n\t\tfunction Store(){\n\t\t\tthis.store = {};\n\t\t}\n\n\t\t_.extend(Store.prototype, {\n\t\t\tcreate: function create(nameSpace){\n\t\t\t\tif (this.store[nameSpace]){\n\t\t\t\t\tthrow new Error('The name space ' + nameSpace + ' already exists');\n\t\t\t\t}\n\t\t\t\tthis.store[nameSpace] = new Collection();\n\t\t\t\tthis.store[nameSpace].namespace = nameSpace;\n\t\t\t},\n\n\t\t\tread: function read(nameSpace){\n\t\t\t\tif (!this.store[nameSpace]){\n\t\t\t\t\tthrow new Error('The name space ' + nameSpace + ' does not exist');\n\t\t\t\t}\n\t\t\t\treturn this.store[nameSpace];\n\t\t\t},\n\n\t\t\tupdate: function update(nameSpace, data){\n\t\t\t\tvar coll = this.read(nameSpace);\n\t\t\t\tcoll.add(data);\n\t\t\t},\n\n\t\t\tdel: function del(nameSpace){\n\t\t\t\tthis.store[nameSpace] = undefined;\n\t\t\t}\n\t\t});\n\n\t\treturn Store;\n\t}\n\n\treturn storeProvider;\n});\n","define('utils/database/databaseSequenceProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tSequenceProvider.$inject = ['MixerSequence'];\n\tfunction SequenceProvider(MixerSequence){\n\n\t\t/**\n\t\t * Sequence Constructor:\n\t\t * Manage the progression of a sequence, including parsing (mixing, inheritance and templating).\n\t\t * @param  {String  } namespace [pages or questions (the type of db.Store)]\n\t\t * @param  {Array   } arr       [a sequence to manage]\n\t\t * @param  {Database} db        [the db itself]\n\t\t */\n\n\t\tfunction Sequence(namespace, arr,db){\n\t\t\tthis.namespace = namespace;\n\t\t\tthis.mixerSequence = new MixerSequence(arr);\n\t\t\tthis.db = db;\n\t\t}\n\n\t\t_.extend(Sequence.prototype, {\n\t\t\t// only mix\n\t\t\tnext: function(context){\n\t\t\t\tthis.mixerSequence.next(context);\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t// anti mix\n\t\t\tprev: function(context){\n\t\t\t\tthis.mixerSequence.prev(context);\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Return the element currently in focus.\n\t\t\t * It always returns either an element or undefined (mixers are abstrcted away)\n\t\t\t * @param  {[type]} context [description]\n\t\t\t * @return {[type]}         [description]\n\t\t\t */\n\t\t\tcurrent: function(context, options){\n\t\t\t\tcontext || (context = {});\n\t\t\t\t// must returned an element or undefined\n\t\t\t\tvar obj = this.mixerSequence.current(context);\n\n\t\t\t\t// in case this is the end of the sequence\n\t\t\t\tif (!obj){\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\n\t\t\t\treturn this.db.inflate(this.namespace, obj, context, options);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns an array of elements, created by proceeding through the whole sequence.\n\t\t\t * @return {[type]} [description]\n\t\t\t */\n\t\t\tall: function(context, options){\n\t\t\t\tvar sequence = [];\n\n\t\t\t\tvar el = this.next().current(context, options);\n\t\t\t\twhile (el){\n\t\t\t\t\tsequence.push(el);\n\t\t\t\t\tel = this.next().current(context, options);\n\t\t\t\t}\n\n\t\t\t\treturn sequence;\n\t\t\t}\n\t\t});\n\n\t\treturn Sequence;\n\t}\n\n\treturn SequenceProvider;\n});\n","define('utils/database/databaseProvider',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tDatabaseProvider.$inject = ['DatabaseStore', 'DatabaseRandomizer', 'databaseInflate', 'templateObj', 'databaseSequence'];\n\tfunction DatabaseProvider(Store, Randomizer, inflate, templateObj, DatabaseSequence){\n\n\t\tfunction Database(){\n\t\t\tthis.store = new Store();\n\t\t\tthis.randomizer = new Randomizer();\n\t\t}\n\n\t\t_.extend(Database.prototype, {\n\t\t\tcreateColl: function(namespace){\n\t\t\t\tthis.store.create(namespace);\n\t\t\t},\n\n\t\t\tgetColl: function(namespace){\n\t\t\t\treturn this.store.read(namespace);\n\t\t\t},\n\n\t\t\tadd: function(namespace, query){\n\t\t\t\tvar coll = this.store.read(namespace);\n\t\t\t\tcoll.add(query);\n\t\t\t},\n\n\t\t\tinflate: function(namespace, query, context, options){\n\t\t\t\tvar coll = this.getColl(namespace);\n\t\t\t\tvar result;\n\n\t\t\t\t// inherit\n\t\t\t\tif (!query.$inflated || query.reinflate) {\n\t\t\t\t\tquery.$inflated = inflate(query, coll, this.randomizer);\n\t\t\t\t}\n\n\t\t\t\t// template\n\t\t\t\tif (!query.$templated || query.regenerateTemplate){\n\t\t\t\t\tcontext[namespace + 'Meta'] = query.$meta;\n\t\t\t\t\tcontext[namespace + 'Data'] = templateObj(query.$inflated.data || {}, context, options); // make sure we support\n\t\t\t\t\tquery.$templated = templateObj(query.$inflated, context, options);\n\t\t\t\t}\n\n\t\t\t\tresult = query.$templated;\n\n\t\t\t\t// set flags\n\t\t\t\tif (context.global && result.addGlobal){\n\t\t\t\t\t_.extend(context.global, result.addGlobal);\n\t\t\t\t}\n\n\t\t\t\tif (context.current && result.addCurrent){\n\t\t\t\t\t_.extend(context.current, result.addCurrent);\n\t\t\t\t}\n\n\t\t\t\treturn query.$templated;\n\t\t\t},\n\n\t\t\tsequence: function(namespace, arr){\n\t\t\t\tif (!_.isArray(arr)){\n\t\t\t\t\tthrow new Error('Sequence must be an array.');\n\t\t\t\t}\n\t\t\t\treturn new DatabaseSequence(namespace, arr, this);\n\t\t\t}\n\t\t});\n\n\t\treturn Database;\n\t}\n\n\treturn DatabaseProvider;\n});\n","define('utils/database/main',['require','underscore','./mixer/main','./template/main','./collection/collectionProvider','./randomizer/randomizerProvider','./queryProvider','./inflateProvider','./store/storeProvider','./databaseSequenceProvider','./databaseProvider'],function(require){\n\tvar _ = require('underscore');\n\n\tvar mixerSequence = require('./mixer/main');\n\tvar templateObj = require('./template/main');\n\n\tvar collection = require('./collection/collectionProvider')();\n\n\tvar DatabaseRandomizer = require('./randomizer/randomizerProvider')(\n\t\trandomInt,// randomize int\n\t\trandomArr,// randomize range\n\t\tcollection\n\t);\n\n\tvar databaseQuery = require('./queryProvider')(\n\t\tcollection,\n\t\tpiConsole\n\t);\n\n\tvar databaseInflate = require('./inflateProvider')(\n\t\tdatabaseQuery,\n\t\t{global:window.piGlobal}, // rootscope\n\t\tpiConsole\n\t);\n\n\tvar DatabaseStore = require('./store/storeProvider')(\n\t\tcollection\n\t);\n\n\tvar databaseSequence = require('./databaseSequenceProvider')(\n\t\tmixerSequence\n\t);\n\n\n\tvar Database = require('./databaseProvider')(\n\t\tDatabaseStore,\n\t\tDatabaseRandomizer,\n\t\tdatabaseInflate,\n\t\ttemplateObj,\n\t\tdatabaseSequence\n\t);\n\n\treturn Database;\n\n\tfunction randomArr(length){\n\t\treturn _.shuffle(_.range(length));\n\t}\n\n\tfunction randomInt(length){\n\t\treturn Math.floor(Math.random()*length);\n\t}\n\n\tfunction piConsole(){\n\t\treturn console;\n\t}\n});\n","define('app/sequencer/database',['require','utils/database/main'],function(require){\n\tvar Database = require('utils/database/main');\n\treturn new Database();\n});\n","/**\n * Go to a destination within the sequence (must be a property of a sequence)\n * @param  {String} target destination type\n * @param  {Object} properties destination options\n * @return {Object}        result element\n */\ndefine('app/sequencer/sequenceGoto',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\treturn go;\n\n\tfunction go(destination, properties, context){\n\t\tvar mixerSequence = this.mixerSequence;\n\n\t\tswitch (destination){\n\t\t\tcase 'nextWhere':\n\t\t\t\twhere('next', properties, context, mixerSequence);\n\t\t\t\tbreak;\n\t\t\tcase 'previousWhere':\n\t\t\t\twhere('next', properties, context, mixerSequence);\n\t\t\t\tbreak;\n\t\t\tcase 'current':\n\t\t\t\t// don't need to do anything...\n\t\t\t\tbreak;\n\t\t\tcase 'first':\n\t\t\t\tdo {mixerSequence.prev(context);} while (mixerSequence.current(context));\n\t\t\t\tbreak;\n\t\t\tcase 'last':\n\t\t\t\tdo {mixerSequence.next(context);} while (mixerSequence.current(context));\n\t\t\t\tmixerSequence.prev();\n\t\t\t\tbreak;\n\t\t\tcase 'end':\n\t\t\t\tdo {mixerSequence.next(context);} while (mixerSequence.current(context));\n\t\t\t\tbreak;\n\t\t\tcase 'next' :\n\t\t\t\tmixerSequence.next(context); // get the next trial, in case there are no more trials, returns undefined\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unknow destination \"' + destination + '\" for goto.');\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tfunction where(direction, properties, context, sequence){\n\t\tvar curr;\n\n\t\tdo {\n\t\t\tsequence[direction]();\n\t\t\tcurr = sequence.current(context);\n\t\t} while (curr && !_.callback(properties)(curr.data));\n\t}\n});\n","/*\n * this file holds the trial sequence\n */\ndefine('app/sequencer/taskSequence',[],function(){\n\tvar sequence;\n\n\t/**\n\t * Getter/Setter for sequence\n\t *\n\t * @param  {Object || null} obj \tThe new script, if it is not set this is simply a getter.\n\t * @return {Object}     \t\t\tThe full script\n\t */\n\tfunction getter(obj){\n\t\tobj && (sequence = obj);\n\t\treturn sequence;\n\t}\n\n\treturn getter;\n});\n","/*\n * media preloader\n */\ndefine('utils/preloader',['require','jquery'],function(require){\n\tvar $ = require('jquery');\n\n\tvar srcStack = [];\t\t\t\t// an array holding all our sources\n\tvar defStack = [];\t\t\t\t// an array holding all the deferreds\n\tvar stackDone = 0;\t\t\t\t// the number of sources we have completed downloading\n\tvar allDone = $.Deferred();\t\t// General deferred, notifies upon source completion\n\tvar images = {};\n\n\t// load a single source\n\tfunction load(src, type){\n\t\ttype = type || 'image';\n\t\t// if we haven't loaded this yet\n\t\tif ($.inArray(src, srcStack) == -1) {\n\t\t\tvar deferred = $.Deferred();\n\n\t\t\tswitch (type) {\n\t\t\t\tcase 'template':\n\t\t\t\t\trequirejs(['text!' + src], function(){\n\t\t\t\t\t\tdeferred.resolve();\n\t\t\t\t\t}, function(){\n\t\t\t\t\t\tthrow new Error('Template not found: ' + src);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image':\n\t\t\t\t\t/* falls through */\n\t\t\t\tdefault :\n\t\t\t\t\tvar img = new Image();\t// create img object\n\t\t\t\t\t$(img).on('load',function(){deferred.resolve();}); // resolve deferred on load\n\t\t\t\t\t$(img).one('error',function(){\n\t\t\t\t\t\timg.src = \"\";\n\t\t\t\t\t\timg.src = src;\n\t\t\t\t\t\t$(img).on('error', function(){throw new Error('Image not found: \"' + src + '\"');});\n\t\t\t\t\t}); // reject deferred on error\n\t\t\t\t\timg.src = src;\n\t\t\t\t\timages[src] = img;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// keep defered and source for later.\n\t\t\tdefStack.push(deferred);\n\t\t\tsrcStack.push(src);\n\n\t\t\t// count this defered as done\n\t\t\tdeferred\n\t\t\t\t.done(function(){\n\t\t\t\t\t// increment the completed counter\n\t\t\t\t\tstackDone++;\n\t\t\t\t\t// notify allDone that we advanced another step\n\t\t\t\t\tallDone.notify(stackDone,defStack.length);\n\t\t\t\t});\n\n\t\t\treturn deferred;\n\t\t}\n\t\t// the source was already loaded\n\t\treturn false;\n\t}\n\n\treturn {\n\t\t// loads a single source\n\t\tadd: load,\n\n\t\tgetImage: function(url){\n\t\t\treturn images[url].cloneNode();\n\t\t},\n\n\t\tactivate: function(){\n\t\t\t// fail or reject allDone according to our defStack\n\t\t\t$.when.apply($,defStack)\n\t\t\t\t.done(function(){allDone.resolve();})\n\t\t\t\t.fail(function(){allDone.reject();});\n\n\t\t\treturn allDone.promise();\n\t\t},\n\n\t\t// reset globals so we can reuse this object\n\t\treset: function(){\n\t\t\tsrcStack = [];\n\t\t\tdefStack = [];\n\t\t\tstackDone = 0;\n\t\t\tallDone = this.state = $.Deferred();\n\t\t},\n\n\t\t// returns a deferred describing the state of this preload\n\t\tstate: allDone\n\t};\n\n});\n","/*\n * build the url for this src (add the generic base_url)\n */\ndefine('app/task/build_url',['require','underscore','./settings'],function(require){\n\n\tvar _ = require('underscore')\n\t\t,settingsGetter = require('./settings');\n\n\treturn function(url, type){\n\t\tvar settings = settingsGetter();\n\t\tvar base_url;\n\n\t\t// the base url setting may be either a string, or an object with the type as a field\n\t\tif (_.isString(settings.base_url)) {\n\t\t\tbase_url = settings.base_url;\n\t\t} else {\n\t\t\tif (_.isObject(settings.base_url)) {\n\t\t\t\tbase_url = settings.base_url[type];\n\t\t\t}\n\t\t}\n\n\t\t// it this is a dataUrl type of image, we don't need to append the baseurl\n\t\tif (type == 'image' && /^data:image/.test(url)){\n\t\t\treturn url;\n\t\t}\n\n\t\t// make sure base url is set, and add trailing slash if needed\n\t\tif (!base_url) {\n\t\t\tbase_url=\"\";\n\t\t} else {\n\t\t\tif (base_url[base_url.length-1] != \"/\") {\n\t\t\t\tbase_url+=\"/\";\n\t\t\t}\n\t\t}\n\n\t\treturn base_url + url;\n\t};\n});\n\n","/*\n * gets all media that needs preloading and preloads it\n */\ndefine('app/sequencer/sequencePreload',['require','underscore','utils/preloader','app/task/build_url'],function(require){\n\tvar _ = require('underscore')\n\t\t,preload = require('utils/preloader')\n\t\t,build_url = require('app/task/build_url');\n\n\tfunction loadMedia(media){\n\t\t// if this is an image, preload it\n\t\tif (!_.isUndefined(media.image)) {\n\t\t\tpreload.add(build_url(media.image, 'image'),'image');\n\t\t}\n\t\tif (!_.isUndefined(media.template)) {\n\t\t\tpreload.add(build_url(media.template,'template'),'template');\n\t\t}\n\t}\n\n\tvar loadStimulus = function(stimulus) {\n\t\tif (stimulus.media) {\n\t\t\tloadMedia(stimulus.media);\n\t\t}\n\t};\n\n\tvar loadInput = function(input){\n\t\tif (input.element) {\n\t\t\tloadMedia(input.element);\n\t\t}\n\t};\n\n\tvar loadTrial = function(trial){\n\t\t_.each(trial.layout || [], loadStimulus);\n\t\t_.each(trial.stimuli || [], loadStimulus);\n\t\t_.each(trial.input || [], loadInput);\n\t};\n\n\t// load trials in sequence (essentialy, recursively pick out the trials out of the mixer)\n\tvar loadSequence = function(sequence){\n\t\t_.each(sequence,function(element){\n\t\t\tif (!_.isUndefined(element.mixer)) {\n\t\t\t\tloadSequence(element.data);\n\t\t\t} else {\n\t\t\t\tloadTrial(element);\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction loadScript(script){\n\t\t// load media sets\n\t\t_.each(script.mediaSets || [], loadMedia);\n\n\t\t// load stimsets\n\t\t_.each(script.stimulusSets || [], loadStimulus);\n\n\t\t// load trialsets\n\t\t_.each(script.trialSets || [], loadTrial);\n\n\t\tloadSequence(script.sequence);\n\t} // load script\n\n\t// accepts a piece of script and a type\n\t// @param script: a piece of script\n\t// @param type: what sort of object this is (media/stimulus/trial)\n\t// @param reset: should we reset the preloader before activating it (use if for some reason we lost the cache...)\n\t// @returns a deferred object\n\treturn function(script, type, reset){\n\t\tif (reset) {\n\t\t\tpreload.reset();\n\t\t}\n\n\t\tswitch (type){\n\t\t\tcase 'media'\t: loadMedia(script); break;\n\t\t\tcase 'stimulus'\t: loadStimulus(script); break;\n\t\t\tcase 'trial'\t: loadTrial(script); break;\n\t\t\tcase 'script'\t:\n\t\t\t\t/* falls through */\n\t\t\tdefault:\n\t\t\t\tloadScript(script); break;\n\t\t}\n\t\treturn preload.activate();\n\t};\n});\n","/*\n * this file is resposible for taking the experiment script (json) and parsing it\n */\n\ndefine('app/task/parser',['require','underscore','app/task/script','../sequencer/database','../sequencer/sequenceGoto','../sequencer/taskSequence','../sequencer/sequencePreload'],function(require){\n\t// load dependancies\n\tvar _ = require('underscore');\n\tvar scriptGetter = require('app/task/script');\n\tvar db = require('../sequencer/database');\n\tvar go = require('../sequencer/sequenceGoto');\n\tvar sequenceSetter = require('../sequencer/taskSequence');\n\tvar preload = require('../sequencer/sequencePreload');\n\n\treturn function(){\n\t\tvar script = scriptGetter();\n\n\n\t\tdb.createColl('trial');\n\t\tdb.createColl('stimulus');\n\t\tdb.createColl('media');\n\n\t\tdb.add('trial', script.trialSets || []);\n\t\tdb.add('stimulus', script.stimulusSets || []);\n\t\tdb.add('media', script.mediaSets || []);\n\n\t\tif (!_.isArray(script.sequence)){\n\t\t\tthrow new Error('You must set a sequence array.');\n\t\t}\n\n\t\tvar sequence = db.sequence('trial', script.sequence);\n\t\tsequence.go = go; // see sequence/goto.js to understand why we are doing this\n\t\tsequenceSetter(sequence);\n\n\t\t// preload and return deferred\n\t\treturn preload(script);\n\t};\n});\n\n","define('utils/pubsub',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\t// the pubsub object itself\n\tvar pubsub = {};\n\n\t// the topic/subscription hash\n\tvar cache = {};\n\tvar counters ={};\n\n\tpubsub.publish = function(/* String */topic, /* Array? */args){\n\t\t// summary:\n\t\t//\t\tPublish some data on a named topic.\n\t\t// topic: String\n\t\t//\t\tThe channel to publish on\n\t\t// args: Array?\n\t\t//\t\tThe data to publish. Each array item is converted into an ordered\n\t\t//\t\targuments on the subscribed functions.\n\t\t//\n\t\t// example:\n\t\t//\t\tPublish stuff on '/some/topic'. Anything subscribed will be called\n\t\t//\t\twith a function signature like: function(a,b,c){ ... }\n\t\t//\n\t\t//\t|\t\t$.publish(\"/some/topic\", [\"a\",\"b\",\"c\"]);\n\t\t// log(topic,args);\n\n\t\tcache[topic] && _.each(cache[topic], function(func){\n\t\t\tfunc.apply(pubsub, args || []);\n\t\t});\n\n\t};\n\n\tpubsub.subscribe = function(/* String */topic, /* Function */callback){\n\t\t// summary:\n\t\t//\t\tRegister a callback on a named topic.\n\t\t// topic: String\n\t\t//\t\tThe channel to subscribe to\n\t\t// subStack: Array\n\t\t//\t\tOptional, an array to which we push the subscription handle\n\t\t// callback: Function\n\t\t//\t\tThe handler event. Anytime something is $.publish'ed on a\n\t\t//\t\tsubscribed channel, the callback will be called with the\n\t\t//\t\tpublished array as ordered arguments.\n\t\t//\n\t\t// returns: Array\n\t\t//\t\tA handle which can be used to unsubscribe this particular subscription.\n\t\t//\n\t\t// example:\n\t\t//\t|\t$.subscribe(\"/some/topic\", function(a, b, c){ /* handle data */ });\n\t\t//\n\t\t// example:\n\t\t//\t|\t$.subscribe(\"/some/topic\", \"/handle/stack\", function(a, b, c){ /* handle data */ });\n\n\t\tvar subStack;\n\n\t\t// if second argument is not a call back use it as the subscription stack\n\t\tif (_.isFunction(callback)) {\n\t\t\tsubStack = [];\n\t\t} else {\n\t\t\tsubStack = arguments[1];\n\t\t\tcallback = arguments[2];\n\t\t}\n\n\t\tif(!cache[topic]){\n\t\t\tcache[topic] = {};\n\t\t\tcounters[topic] = 0;\n\t\t}\n\n\t\tcache[topic][counters[topic]++] = callback;\n\n\t\tsubStack.push([topic, callback]);\n\t\treturn [topic, callback]; // Array\n\t};\n\n\tpubsub.unsubscribe = function(/* Array */handle){\n\t\t// summary:\n\t\t//\t\tDisconnect a subscribed function for a topic.\n\t\t// handle: Array\n\t\t//\t\tThe return value from a $.subscribe call.\n\t\t// example:\n\t\t//\t|\tvar handle = $.subscribe(\"/something\", function(){});\n\t\t//\t|\t$.unsubscribe(handle);\n\n\t\tvar t = handle[0];\n\t\tcache[t] && _.each(cache[t], function(func, idx){\n\t\t\tfunc == handle[1] && delete(cache[t][idx]);\n\t\t});\n\t};\n\n\treturn pubsub;\n});\n\n\n\n\n\n","define('utils/interface/bindings/click',['require','jquery','utils/is_touch'],function(require){\n\tvar $ = require('jquery')\n\t\t, is_touch_device = require('utils/is_touch');\n\n\t/*\n\t * takes care of click events\n\t *\n\t * accepts a listener object to decorate and definitions\n\t *\n\t * the function accepts either\n\t *\t\ta stimulus handle to which to bind the event (definitions.stimHandle)\n\t *\t\tor an element to add to the canvas definitions.element (optionaly a jquery css object may be added: definitions.css)\n\t *\n\t * -- if we want to attach the event to an existing element\n\t * definitions = {\n\t *\t\tstimHandle: 'firstStim'\n\t * }\n\t * This attaches to the [data-handle=\"firstStim\"] stimulus.\n\t *\n\t * -- if we want to create a interface specific element\n\t * definitions = {\n\t *\t\telement: $('<div>'),\n\t *\t\tcss: {background:red; 'font-size': 2em'}   // optional\n\t * }\n\t */\n\n\treturn function(listener,definitions){\n\t\tvar eventName = is_touch_device ? 'touchstart' : 'mousedown';\n\t\tvar $element = definitions.element ? $(definitions.element) : false;\n\n\t\tlistener.on = function(callback){\n\t\t\tvar activateCallback = function(e){ callback(e,eventName); };\n\n\t\t\t// If we're binding to an existing element, bind to its appropriate handle\n\t\t\tif ($element){\n\t\t\t\t$(document).on(eventName + '.interface','[data-handle=\"'+definitions.stimHandle + '\"]', activateCallback);\n\t\t\t} else {\n\t\t\t\t// the element to attach\n\t\t\t\t$element\n\t\t\t\t\t.css(definitions.css || {})\n\t\t\t\t\t.appendTo('#canvas')\t\t\t\t\t\t\t// @todo, not great form, we should probably have a variable pointing there...\n\t\t\t\t\t.on(eventName+'.interface',activateCallback);\n\t\t\t}\n\t\t};\n\n\t\tlistener.off = function(){\n\t\t\tif ($element){\n\t\t\t\t$(document).off(eventName + '.interface','[data-handle=\"'+definitions.stimHandle + '\"]');\n\t\t\t} else {\n\t\t\t\t$element.remove();\t\t\t\t\t\t\t\t\t// this also removes any attached events\n\t\t\t}\n\t\t};\n\t};\n});\n","/*\n * detects touch devices\n */\n\ndefine('utils/is_touch',[],function(){\n\treturn !!('ontouchstart' in window) ? true : false;\n});\n\n","define('utils/interface/bindings/mouseEvents',['require','jquery','underscore'],function(require){\n\tvar $ = require('jquery')\n\t\t, _ = require('underscore');\n\n\t/**\n\t * Decorates a Listener with the on and off functions for a mouse event\n\t *\n\t * It attaches a listener for event name to all elements that have definitions.stimHandle\n\t *\n\t * @param  {String} eventName   The event name to bind\n\t * @param  {Object} listener    The listener object to decorate\n\t * @param  {Object} definitions A definitions (options) object\n\t * @return {Object}             A decorator function\n\t */\n\tfunction mouseEventsDecorator(eventName, listener,definitions){\n\t\tlistener.on = function(callback){\n\t\t\tfunction activateCallback(e){\n\t\t\t\tcallback(e,eventName);\n\t\t\t};\n\n\t\t\t// If we're binding to an existing element, bind to its appropriate handle\n\t\t\t$(document).on(eventName + '.interface','[data-handle=\"'+definitions.stimHandle + '\"]', activateCallback);\n\t\t};\n\n\t\tlistener.off = function(){\n\t\t\t$(document).off(eventName + '.interface','[data-handle=\"'+definitions.stimHandle + '\"]');\n\t\t};\n\t}\n\n\treturn mouseEventsDecorator;\n});\n","define('utils/interface/bindings/keypressed',['require','jquery'],function(require){\n\tvar $ = require('jquery');\n\n\t/*\n\t * key pressed listener\n\t * reqires key\n\t *\n\t * key can be either charCode or string.\n\t * or an array of charCode/strings.\n\t */\n\n\t// we monitor all key up events so that we trigger only once per key down\n\tvar keyDownArr = [];\n\t$(document).on(\"keyup.keypressed\",function(e){\n\t\tkeyDownArr[e.which] = false; // unset flag to prevent multi pressing of a key\n\t});\n\n\t// creates an object that is capable of activating a keypressed event and removing it\n\tvar Keypressed = function(definitions){\n\t\t// make sure key is array\n\t\tvar key = $.isArray(definitions.key) ? definitions.key : [definitions.key];\n\t\tvar eventName = \"keydown.interface.\" + definitions.handle;\n\n\t\t// accept both keyCode and the key itself\n\t\tvar target = $.map(key,function(value){\n\t\t\treturn typeof value == \"string\" ? value.toUpperCase().charCodeAt(0) : value;\n\t\t});\n\n\t\t// attach listener\n\t\tthis.on = function(callback){\n\t\t\t$(document).on(eventName,function(e){\n\t\t\t\tif (!keyDownArr[e.which] && $.inArray(e.which,target) != -1) {\n\t\t\t\t\tkeyDownArr[e.which] = true; // set flag to prevent multi pressing of a key\n\t\t\t\t\tcallback(e,'keydown');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// remove listener\n\t\tthis.off = function(){\n\t\t\t$(document).off(eventName);\n\t\t};\n\n\t};\n\n\treturn function(listener,definitions){\n\t\t// decorate listener with new keypressed\n\t\t$.extend(listener,new Keypressed(definitions));\n\t};\n\n});\n","define('utils/interface/bindings/keyup',['require','jquery'],function(require){\n\tvar $ = require('jquery');\n\n\t/*\n\t * key up listener\n\t * reqires definitions.key\n\t *\n\t * key can be either charCode or string.\n\t * or an array of charCode/strings.\n\t */\n\n\t// creates an object that is capable of activating a keypressed event and removing it\n\tvar Keyup = function(definitions){\n\t\t// make sure key is array\n\t\tvar key = $.isArray(definitions.key) ? definitions.key : [definitions.key];\n\t\tvar eventName = \"keyup.interface.\" + definitions.handle;\n\n\t\t// accept both keyCode and the key itself\n\t\tvar target = $.map(key,function(value){\n\t\t\treturn typeof value == \"string\" ? value.toUpperCase().charCodeAt(0) : value;\n\t\t});\n\n\t\t// attach listener\n\t\tthis.on = function(callback){\n\t\t\t$(document).on(eventName,function(e){\n\t\t\t\tif ($.inArray(e.which,target) !== -1) {\n\t\t\t\t\tcallback(e,'keyup');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// remove listener\n\t\tthis.off = function(){\n\t\t\t$(document).off(eventName);\n\t\t};\n\n\t};\n\n\treturn function(listener,definitions){\n\t\t// decorate listener with new keypressed\n\t\t$.extend(listener,new Keyup(definitions));\n\t};\n\n});\n","define('utils/timeout',['require','underscore'],function(require){\n\n\t/*\n\t * timeout\n\t *\n\t * timeout(time,callback): shortcut for setTimeout\n\t * timeout(time,stack,callback): shortcut for setTimeout, sets timer_id into stack array\n\t *\n\t * @todo: poll timer instead of using one long timeout\n\t * http://ejohn.org/blog/accuracy-of-javascript-time/\n\t * http://stackoverflow.com/questions/196027/is-there-a-more-accurate-way-to-create-a-javascript-timer-than-settimeout\n\t * http://www.sitepoint.com/creating-accurate-timers-in-javascript/\n\t * http://stackoverflow.com/questions/6875625/does-javascript-provide-a-high-resolution-timer/6875666#6875666\n\t * http://www.websanova.com/blog/javascript/how-to-write-an-accurate-game-timer-in-javascript#.UmZ1PHh4uak\n\t */\n\n\tvar _ = require('underscore');\n\n\treturn function timeout(){\n\t\tvar time = arguments[0];\n\t\tvar stack = _.isArray(arguments[1]) ? arguments[1] : [];\n\t\tvar callback = _.isFunction(arguments[1]) ? arguments[1] : arguments[2];\n\t\tvar timer_id = 0;\n\n\t\tif (!time) {\n\t\t\tcallback.call();\n\t\t} else {\n\t\t\ttimer_id = setTimeout(callback,time);\n\t\t\tstack.push(timer_id);\n\t\t}\n\n\t\treturn timer_id;\n\t};\n\n});\n\n","/**\n *\tTakes a properties objects and returns the result of a randomization:\n *\tIf it is an array - pick a random member\n *\tIf it is an object pick from within a range\n *\tIf it is a function return its result using the context\n *\tOtherwise simply return the properties\n */\ndefine('utils/simpleRandomize',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tfunction simpleRandomize(properties, context){\n\n\t\tif (_.isArray(properties)) {\n\t\t\tvar index = Math.floor(Math.random()*properties.length);\n\t\t\treturn properties[index];\n\t\t}\n\n\t\tif (_.isFunction(properties)) {\n\t\t\treturn properties.call(context);\n\t\t}\n\n\t\t// this must be after the test for arrays and functions, because they are considered objects too\n\t\tif (_.isPlainObject(properties)) {\n\t\t\tif (!_.isNumber(properties.min) || !_.isNumber(properties.max) || properties.min > properties.max) {\n\t\t\t\tthrow new Error('randomization objects need both a max and a minimum property, also max has to be larger than min');\n\t\t\t}\n\t\t\treturn properties.min + (properties.max - properties.min) * Math.random();\n\t\t}\n\n\t\t// if this is not a randomization object simply return\n\t\treturn properties;\n\t}\n\n\treturn simpleRandomize;\n});\n","define('utils/interface/bindings/timeout',['require','utils/timeout','utils/simpleRandomize'],function(require){\n\tvar timeout = require('utils/timeout')\n\t\t, randomize = require('utils/simpleRandomize');\n\n\t/*\n\t * timeout listenter\n\t *\n\t * requires definitions.duration, otherwise fires immediately\n\t */\n\n\treturn function(listener, definitions){\n\n\t\t// all this has to happen in a seperate module (closure) so that the different timers don't overide one anather\n\t\tvar Timeout = (function(){\n\n\t\t\tvar duration = randomize(definitions.duration) || 0;\n\t\t\tvar timerID;\n\n\t\t\treturn {\n\t\t\t\ton : function(callback){\n\t\t\t\t\ttimerID = timeout(duration,function(){\n\t\t\t\t\t\tcallback({},'timeout');\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\toff : function(){\n\t\t\t\t\tclearTimeout(timerID);\n\t\t\t\t}\n\t\t\t};\n\t\t})();\n\n\t\tlistener.on = Timeout.on;\n\t\tlistener.off = Timeout.off;\n\t};\n});\n","define('utils/interface/binder',['require','jquery','./bindings/click','./bindings/mouseEvents','./bindings/keypressed','./bindings/keyup','./bindings/timeout'],function(require){\n\tvar $ = require('jquery')\n\t\t, click = require('./bindings/click')\n\t\t, mouseEvents = require('./bindings/mouseEvents')\n\t\t, keypressed = require('./bindings/keypressed')\n\t\t, keyup = require('./bindings/keyup')\n\t\t, timeout = require('./bindings/timeout');\n\n \t/*\n\t * this function decorates a listener object with on and off functions\n\t * it takes listener (the object) and the binding definitions as parameters\n\t *\n\t * the function returns true in case the decoration was successfull and false in case it was not.\n\t */\n\treturn function(listener,definitions){\n\t\tvar on = definitions.on; // what type of binding is this?\n\n\t\t// if the on and off function are set explicitly, set them in;\n\t\tif (typeof on === 'function') {\n\t\t\tlistener.on = definitions.on;\n\t\t\tlistener.off = definitions.off;\n\t\t\tif (typeof listener.off !== 'function') {\n\t\t\t\tthrow new Error(\"Interface off is not a function for \" + definitions.handle);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tswitch (on){\n\t\t\t/*\n\t\t\t * the archtipical events\n\t\t\t */\n\t\t\tcase 'keypressed'\t:\n\t\t\t\tkeypressed(listener, definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'keyup'\t\t:\n\t\t\t\tkeyup(listener, definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'click'\t\t:\n\t\t\t\tclick(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'mouseup'\t:\n\t\t\t\tmouseEvents('mouseup', listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'mousedown'\t:\n\t\t\t\tmouseEvents('mousedown', listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'mouseenter'\t:\n\t\t\t\tmouseEvents('mouseenter', listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'mouseleave'\t:\n\t\t\t\tmouseEvents('mouseleave', listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'timeout'\t\t:\n\t\t\t\ttimeout(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\t/*\n\t\t\t * Shortcuts\n\t\t\t */\n\n\t\t\tcase 'enter'\t:\n\t\t\t\tkeypressed(listener, $.extend({key:13},definitions));\n\t\t\t\tbreak;\n\n\t\t\tcase 'space'\t:\n\t\t\t\tkeypressed(listener, $.extend({key:32},definitions));\n\t\t\t\tbreak;\n\n\t\t\tcase 'esc'\t:\n\t\t\t\tkeypressed(listener, $.extend({key:27},definitions));\n\t\t\t\tbreak;\n\n\t\t\tcase 'leftTouch'\t:\n\t\t\t\tdefinitions.element = $('<div>')\n\t\t\t\t\t.css({\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\twidth: '30%',\n\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\tbackground: '#00FF00',\n\t\t\t\t\t\topacity: 0.3\n\t\t\t\t\t});\n\n\t\t\t\tclick(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'rightTouch'\t:\n\t\t\t\tdefinitions.element = $('<div>')\n\t\t\t\t\t.css({\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tright: 0,\n\t\t\t\t\t\twidth: '30%',\n\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\tbackground: '#00FF00',\n\t\t\t\t\t\topacity: 0.3\n\t\t\t\t\t});\n\n\t\t\t\tclick(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'topTouch'\t:\n\t\t\t\tdefinitions.element = $('<div>')\n\t\t\t\t\t.css({\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: '30%',\n\t\t\t\t\t\tbackground: '#00FF00',\n\t\t\t\t\t\topacity: 0.3\n\t\t\t\t\t});\n\n\t\t\t\tclick(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'bottomTouch'\t:\n\t\t\t\tdefinitions.element = $('<div>')\n\t\t\t\t\t.css({\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tbottom: 0,\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: '30%',\n\t\t\t\t\t\tbackground: '#00FF00',\n\t\t\t\t\t\topacity: 0.3\n\t\t\t\t\t});\n\n\t\t\t\tclick(listener,definitions);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error('You have an input element without a recognized \"on\" property: ' + on);\n\n\t\t}\n\t\treturn true;\n\t};\n});\n","define('utils/interface/triggerEvent',['require','utils/pubsub'],function(require){\n\tvar pubsub = require('utils/pubsub');\n\n\t/*\n\t * manages publishing the event\n\t */\n\treturn function triggerEvent(event,type,definitions, latency){\n\n\t\tvar data = {\n\t\t\ttimestamp\t: +new Date(),\n\t\t\tlatency\t\t: latency,\n\t\t\thandle\t\t: definitions.handle,\t\t\t// right/left and so on\n\t\t\ttype\t\t: type,\t\t\t\t\t\t\t// holds click/keypressed and so on\n\t\t\te\t\t\t: event\t\t\t\t\t\t\t// the original event if available. just in case\n\t\t};\n\n\t\tpubsub.publish(\"input\",[data]);\n\t};\n\n});\n\n","define('utils/interface/listener',['require','./binder','./triggerEvent'],function(require){\n\n\tvar binder = require('./binder')\n\t\t, trigger = require('./triggerEvent');\n\t/*\n\t * listener constructor\n\t */\n\tfunction Listener(definitions, interfaceObj){\n\n\t\t// set listener handle\n\t\tthis.handle = definitions.handle;\n\n\t\t// decorate listener with on and off functions\n\t\tbinder(this,definitions);\n\n\t\t// activate listener:\n\t\tthis.on(function(e,type){\n\t\t\ttrigger(e,type,definitions, interfaceObj.getLatency());\n\t\t});\n\n\t\t// for now the destroyer simply unbinds the event\n\t\tthis.destroy = this.off;\n\t};\n\n\treturn Listener;\n\n});\n\n","/* global performance */\ndefine('utils/interface/now',[],function(){\n\n\tvar nowFn;\n\n\t// if performance is set, look for the now function\n\n\tif (!!window.performance) {\n\t\tnowFn = performance.now  ||\n        performance.mozNow    ||\n        performance.webkitNow ||\n        performance.msNow     ||\n        performance.oNow;\n\t}\n\n\t// if we have now proxy it (so it uses perfomance as \"this\")\n\t// otherwise use regular date/time\n\treturn nowFn ?\n\t\tfunction now(){return nowFn.apply(performance);}\n\t\t: function now(){ return +new Date();};\n\n});\n\n","define('utils/interface/interface',['require','underscore','./listener','../is_touch','./now'],function(require){\n\tvar _ = require('underscore')\n\t\t, Listener = require('./listener')\n\t\t, is_touch_device = require('../is_touch')\n\t\t, now = require('./now');\n\n\n\t/*\n\t * adds and removes listeners from the stack\n\t *\n\t * function add(definitions): add listener, see ./binder.js for more details and options\n\t *\n\t * definitions = {\n\t *\t\thandle: 'listener name',\n\t *\t\ton: listener type (click, keypressed, various shortcuts)\n\t * }\n\t *\n\t */\n\n\tvar listenerStack = [] // holds all active listeners\n\t\t, baseTime = 0;\n\n\treturn {\n\t\t// get latency (time since last reset)\n\t\tgetLatency: function(){\n\t\t\treturn now() - baseTime;\n\t\t},\n\n\t\t// reset timer\n\t\tresetTimer: function(){\n\t\t\tbaseTime = now();\n\t\t},\n\n\t\t// add listeners\n\t\tadd: function(definitions){\n\t\t\tif (!definitions){\n\t\t\t\tthrow new Error('Missing input element. Could not add input listener');\n\t\t\t}\n\n\t\t\tvar interfaceObj = this;\n\t\t\t// make sure definitions is set as an array\n\t\t\tvar definitionsArr = _.isArray(definitions) ? definitions : [definitions];\n\n\t\t\t// for each definitions object create a listener\n\t\t\t_.forEach(definitionsArr,function(definition){\n\t\t\t\t// if this listener is targeted specificaly at a touch\\!touch device\n\t\t\t\tif (!_.isUndefined(definition.touch)) {\n\t\t\t\t\t// if needed, skip this listener\n\t\t\t\t\tif (is_touch_device && !definition.touch) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (!is_touch_device && definition.touch) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar listener = new Listener(definition, interfaceObj);\n\t\t\t\tlistenerStack.push(listener);\n\t\t\t});\n\n\t\t},\n\n\t\t// remove listeners\n\t\tremove: function(handleList){\n\t\t\thandleList = _.isArray(handleList ) ? handleList  : [handleList ];\n\n\t\t\t// go through the listener stack and remove any listeners that fit the handle list\n\t\t\t// note that we do this in reverse so that the index does not change\n\t\t\tfor (var i = listenerStack.length - 1; i >= 0 ; i--){\n\t\t\t\tvar listener = listenerStack[i];\n\t\t\t\tif (_.indexOf(handleList,listener.handle) != -1){\n\t\t\t\t\tlistener.off();\n\t\t\t\t\tlistenerStack.splice(i,1);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// remove all listeners\n\t\tdestroy: function(){\n\t\t\t// destroy each listener\n\t\t\t_.invoke(listenerStack,'destroy');\n\n\t\t\t// empty stack\n\t\t\tlistenerStack = [];\n\t\t}\n\t};\n});\n","define('models/model',['require','underscore','backbone'],function(require) {\n\tvar _ = require('underscore')\n\t\t, Backbone = require('backbone');\n\n\t// ***********  prototypal inheritance  ***********\n\t// use example: newObject = Object.create(oldObject);\n\t// @todo: do we realy need this?\n\tif (typeof Object.create !== 'function') {\n\t\tObject.create = function (o) {\n\t\t\tfunction F() {}\n\t\t\tF.prototype = o;\n\t\t\treturn new F();\n\t\t};\n\t}\n\n\n\tvar Model = Backbone.Model.extend({\n\n\t\tconstructor : function ( attributes, options ) {\n\t\t\tvar new_attributes = {};\n\n\t\t\t// clone attributes so that we prototipicaly inherit objects\n\t\t\t_.each(attributes, function(value, key){\n\n\t\t\t\tif (_.isObject(value)) {\n\t\t\t\t\t// inherit object\n\t\t\t\t\tvar child = Object.create(value);\n\n\t\t\t\t\t// default to the default properties of the model\n\t\t\t\t\tvar defaultObj = this.defaults && this.defaults[key] && _.isObject(this.defaults[key]) ? this.defaults[key] : {};\n\t\t\t\t\tnew_attributes[key] = _.defaults(child, defaultObj);\n\t\t\t\t} else {\n\t\t\t\t\tnew_attributes[key] = value;\n\t\t\t\t}\n\t\t\t},this);\n\n\t\t\t// Note that __super__ is not part of the documented API, but\n\t\t\t// it seems to me that a lot of actual Backbone behavior is not\n\t\t\t// documented, and since __super__ is there, so far I've been\n\t\t\t// using it instead of setting my own property to store the\n\t\t\t// reference to the parent class.\n\n\t\t\tBackbone.Model.apply(this, [new_attributes, options]);\n\n\t\t}\n\n\t});\n\n\t// Returns the Model class\n\treturn Model;\n});\n","/*\n * the media view\n *\n */\n\ndefine('app/media/media_view',['require','backbone','underscore','app/task/main_view'],function(require){\n    var Backbone = require('backbone'),\n        _ = require('underscore'),\n        main_view = require('app/task/main_view');\n\n    var canvas = main_view.$el;\n\n    var View = Backbone.View.extend({\n\n        // build element according to simulus\n        initialize: function(options){\n            this.options = options || {}; // needed since backbone v1.1.0\n\n            this.$el\n                .addClass('stimulus')\n                .attr('data-handle', this.model.handle)     // add data-handle for handeling of mouse/touch interactions\n                .css(\"visibility\", \"hidden\")\n                .css(this.model.get('css'))\n                .appendTo(canvas);\n\n            this.render();\n        },\n\n        // we keep all stimuli appended to the canvas so that the render function can apply to them\n        // they shouldn't affect each other because they have absolute positioning\n        // we hide and show them using visibility\n\n        render: function(){\n            // these are the things that need recalibrating on refresh\n            this.size();\n\n            // if the element does not have a width it is meaningless to place it at this stage\n            if (this.$el.width()){\n                this.place();\n            } else {\n                // this is probably an image that hasn't been loaded yet\n                // we need to defer \"place\" because safari needs time to load images\n                // the preloader makes sure that the image is already in cache\n                // but it appears that safari requires another round of the call stack before loading the image...\n                _.defer(_.bind(this.place, this));\n            }\n\n            return this;\n        },\n\n        show: function(){\n            // if this is a gif, reload it before displaying so that the gif is reset\n            if (this.options.type === 'image' && this.options.image.indexOf('gif') !== -1){\n                // weird IE bug that prevents refreshing gifs...\n\t\t\t\t// also, on IE11 you can't refresh a gif when it is not visibility:visible\n                if(window.ActiveXObject || \"ActiveXObject\" in window){ // true only in IE\n                    this.$el.css(\"visibility\", \"visible\");\n\t\t\t\t\tthis.$el[0].src =  this.options.image + '#' + Math.random();\n                } else {\n                    // Firefox requires to explicitly empty the \"src\" before resetting it.\n                    this.$el[0].src = \"\";\n                    this.$el[0].src = this.options.image;\n\t\t\t\t\tthis.$el.css(\"visibility\", \"visible\");\n                }\n\n\t\t\t\treturn this;\n            }\n\n            this.$el.css(\"visibility\", \"visible\");\n            return this;\n        },\n\n        hide: function(){\n            this.$el.css(\"visibility\", \"hidden\");\n            return this;\n        },\n\n        size: function(){\n            var size = this.model.get('size');\n\n            if (size.font_size){\n                this.$el.css('font-size', size.font_size);\n            }\n            // if this is a word, we don't want to set height (it breaks centering)\n            if (size.height != 'auto' && this.options.type != 'word') {\n                this.$el.height(size.height + '%');\n            }\n            if (size.width != 'auto'){\n                this.$el.width(size.width + '%');\n            }\n\n            return this;\n        },\n\n        // places the element on the canvas (has to be called after size)\n        // @TODO: this is way too complex to be left here, we should probably export this to a seperate file or something\n        place: function(){\n            // helper function: returns sizes of element;\n            function size($elem){\n                return {\n                    height    : $elem.outerHeight(),\n                    width    : $elem.outerWidth()\n                };\n            }\n\n            var top, bottom, left, right; // will hold the offset for the locations\n            var canvasSize = size(canvas);\n            var elSize = size(this.$el);\n            // get location setting and set center as default\n            var location = this.model.get('location') || {};\n            if (typeof location.top == 'undefined' && typeof location.bottom == 'undefined') {\n                location.top = 'center';\n            }\n            if (typeof location.left == 'undefined' && typeof location.right == 'undefined') {\n                location.right = 'center';\n            }\n\n            // set offsets:\n            switch (location.top){\n                case undefined :\n                    /* falls through */\n                case 'auto'     : top = 'auto'; break;\n                case 'center'    : top = (canvasSize.height - elSize.height)/2; break;\n                default            : top = (canvasSize.height * location.top)/100;\n            }\n\n            switch (location.bottom){\n                case undefined :\n                    /* falls through */\n                case 'auto'     : bottom = 'auto'; break;\n                case 'center'    : bottom = (canvasSize.height - elSize.height)/2; break;\n                default            : bottom = (canvasSize.height * (location.bottom))/100;\n            }\n\n            switch (location.left){\n                case undefined :\n                    /* falls through */\n                case 'auto'     : left = 'auto'; break;\n                case 'center'    : left = (canvasSize.width - elSize.width)/2; break;\n                default            : left = (canvasSize.width * location.left)/100;\n            }\n\n            switch (location.right){\n                case undefined :\n                    /* falls through */\n                case 'auto'     : right = 'auto'; break;\n                case 'center'    : right = (canvasSize.width - elSize.width)/2; break;\n                default            : right = (canvasSize.width * (location.right))/100;\n            }\n\n            this.$el.css({\n                top     : top,\n                bottom    : bottom,\n                left     : left,\n                right     : right\n            });\n        }\n\n    });\n\n    // Returns the View Constructor\n    return View;\n});\n\n","/*\n * a function that takes a media object and creates appropriate html for it\n *\n * html(media, context)\n *\t\ttakes a media object such as {word: 'Morning'} (we do our best for the object to have only one property)\n *\t\tthe context is the object used for templating\n */\ndefine('utils/html',['require','jquery','utils/preloader'],function(require) {\n\tvar $ = require('jquery')\n\t\t,  preload = require('utils/preloader');\n\n\tfunction html(media){\n\t\t// all templateing is done within the inflate trial function and the sequencer\n\t\tvar template = media.html || media.inlineTemplate || media.template; // give inline template precedence over template, because tempaltes are loaded into inlinetemplate\n\n\t\tif (media.word) {\n\t\t\tmedia.displayType = 'element';\n\t\t\tmedia.type = 'word';\n\t\t\tmedia.el = $('<div>',{text:media.word});\n\t\t}\n\t\telse if (media.image) {\n\t\t\tmedia.displayType = 'element';\n\t\t\tmedia.type = 'image';\n\t\t\tmedia.el = preload.getImage(media.image);\n\t\t}\n\t\telse if (media.jquery) {\n\t\t\tmedia.displayType = 'element';\n\t\t\tmedia.type = 'jquery';\n\t\t\tmedia.el = media.jquery;\n\t\t}\n\t\telse if (template) { // html | template | inlineTemplate\n\t\t\tmedia.displayType = 'element';\n\t\t\tmedia.type = 'html';\n\t\t\ttry {\n\t\t\t\tmedia.el = $(template);\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('HTML must be wrapped in an html element such as <span></span>. ' + template + ' is invalid');\n\t\t\t}\n\t\t} else {\n\t\t\treturn false; // this is not a supported html type\n\t\t}\n\t}\n\n\treturn html;\n\n});\n\n","define('app/global',['require','underscore'],function(require){\n\n\t// initiate piGloabl\n\twindow.piGlobal || (window.piGlobal = {});\n\n\tvar _ = require('underscore');\n\tvar glob = window.piGlobal;\n\n\n\t/**\n\t * getter setter for the global object\n\t * @param  {Object} obj     The object to add to the global\n\t * @param  {Bool} \treplace A new object to fully replace the old global\n\t * @return {Object}         The full global\n\t */\n\tfunction global(obj, replace){\n\n\t\tif (replace) {\n\t\t\tglob = obj;\n\t\t\treturn glob;\n\t\t}\n\n\t\tif (_.isPlainObject(obj)){\n\t\t\t_.each(function(value, key){\n\t\t\t\tconsole.warn && global[key] && console.warn('Overwriting \"' + key  + '\" in global object.');\n\t\t\t});\n\t\t\t_.merge(glob, obj);\n\t\t}\n\n\t\treturn glob;\n\t}\n\n\treturn global;\n});\n","define('app/media/media_constructor',['require','underscore','./media_view','utils/html','app/global'],function(require) {\n\tvar _ = require('underscore')\n\t\t, MediaView = require('./media_view')\n\t\t,html = require('utils/html')\n\t\t,global = require('app/global');\n\n\tfunction Media(source, model){\n\n\t\t// make sure we have a media object\n\t\tif (!source){\n\t\t\tthrow new Error('Media object not defined for ' + model.name());\n\t\t}\n\n\t\t// keep the source\n\t\tsource.source = _.cloneDeep(source);\n\n\t\t// keep a reference to the model\n\t\tsource.model = model;\n\n\t\thtml(source,{\n\t\t\tglobal: global(),\n\t\t\ttrialData: model.trial.data,\n\t\t\tstimulusData: model.get('data')\n\t\t});\n\n\t\t// return a new media view\n\t\treturn new MediaView(source);\n\t}\n\n\treturn Media;\n});\n\n\n","define('app/stimulus/stimulus_model',['require','models/model','app/media/media_constructor','utils/pubsub','underscore','utils/is_touch','app/task/settings'],function(require) {\n\tvar MyModel = require(\"models/model\")\n\t\t,MediaView = require(\"app/media/media_constructor\")\n\t\t,pubsub = require(\"utils/pubsub\")\n\t\t,_ = require(\"underscore\")\n\t\t,is_touch = require(\"utils/is_touch\")\n\t\t,settings = require(\"app/task/settings\");\n\n\n\tvar Model = MyModel.extend({\n\t\tinitialize: function(){\n\t\t\t// set trial in the model\n\t\t\tif (this.collection.trial) {\n\t\t\t\tthis.trial = this.collection.trial;\n\t\t\t}\n\n\t\t\t// set model handle\n\t\t\tthis.attributes.data = this.attributes.data || {}; // make sure we have a data object\n\t\t\tthis.attributes.data.handle = this.attributes.data.handle || this.attributes.handle; // set the handle in the data object\n\t\t\tthis.handle =  this.attributes.data.handle; // set the handle in the stimulus object\n\n\t\t\t// pick the correct media according to if this is a touch device\n\t\t\tvar mediaSource = is_touch && this.get('touchMedia') ? this.get('touchMedia') : this.get('media');\n\n\t\t\t// take the media source and build it into a full fledged view\n\t\t\tthis.media = new MediaView(mediaSource,this);\n\n\t\t},\n\n\t\t// Default values for all of the attributes\n\t\tdefaults: {\n\t\t\tsize: {height: 'auto', width: 'auto'},\n\t\t\tcss:{}\n\t\t},\n\n\n\t\t// activate stimulus listeners (maybe these shoud sit in one of the trial modules? call with apply)\n\t\t// ----------------------------------------------------------------------------------------------------------\n\n\t\tactivate: function(){\n\t\t\tvar self = this;\n\t\t\tvar stimHandle = this.handle;\n\t\t\tthis.timeStack = this.timeStack || [];\n\t\t\tthis.pubsubStack = this.pubsubStack || [];\n\n\t\t\t// subscribe to start action\n\t\t\t// -------------------------\n\t\t\tpubsub.subscribe('stim:start', self.pubsubStack, function(handle){\n\t\t\t\tif (!_.include([stimHandle,'All'], handle)) {\n\t\t\t\t\t// make sure this publication is aimed at us\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// present the stimulus\n\t\t\t\tself.media.show();\n\t\t\t});\n\n\t\t\t// subscribe to set attribute action\n\t\t\t// ---------------------------------\n\n\t\t\tpubsub.subscribe('stim:setAttr', self.pubsubStack, function(handle,setter){\n\t\t\t\tif (!_.include([stimHandle,'All'], handle)) {\n\t\t\t\t\t// make sure this publication is aimed at us\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// if this is a function let it do whatever it wants with this model, otherwise simply call set.\n\t\t\t\tif (_.isFunction(setter)) {\n\t\t\t\t\tsetter.apply(self);\n\t\t\t\t} else {\n\t\t\t\t\tvar data = self.get('data') || {};\n\t\t\t\t\tdata = _.extend(data, setter);\n\t\t\t\t\tself.set('data', data);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// subscribe to stop stimulus action\n\t\t\t// ---------------------------------\n\t\t\tpubsub.subscribe('stim:stop', self.pubsubStack, function(handle){\n\t\t\t\tif (!_.include([stimHandle,'All'], handle)) {\n\t\t\t\t\t// make sure this publication is aimed at us\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// hide the stimulus\n\t\t\t\tself.media.hide();\n\t\t\t});\n\t\t},\n\n\t\tdisable: function(){\n\t\t\t// hide the stimulus\n\t\t\tthis.media.hide();\n\n\t\t\t// make sure the stacks exist\n\t\t\tthis.timeStack = this.timeStack || [];\n\t\t\tthis.pubsubStack = this.pubsubStack || [];\n\n\t\t\t_.each(this.pubsubStack, function(handle) {\n\t\t\t\tpubsub.unsubscribe(handle);\n\t\t\t});\n\n\t\t\t// empty stacks\n\t\t\tthis.timeStack = [];\n\t\t\tthis.pubsubStack = [];\n\t\t},\n\n\t\tname: function(){\n\t\t\tvar attr = this.attributes;\n\t\t\tif (attr.data.alias) {return attr.data.alias;} // if we have an alias ues it\n\t\t\tif (attr.inherit && attr.inherit.set) {return attr.inherit.set;} // otherwise try using the set we inherited from\n\t\t\tif (attr.handle) {return attr.handle;} // otherwise use handle\n\t\t\treturn 'Anonymous Stimulus'; // we're out of options here\n\t\t},\n\n\t\tmediaName: function(){\n\t\t\tvar media = this.media.options;\n\t\t\tvar fullpath = settings.logger && settings.logger.fullpath; // should we use the full path or just the file name\n\t\t\tif (media.alias) {return media.alias;} // if we have an alias ues it\n\t\t\tfor (var prop in media) {\n\t\t\t\tif (_.contains(['image','template'],prop)) {\n                    return fullpath ? media[prop] : media[prop].replace(/^.*[\\\\\\/]/, '');\n\t\t\t\t}\n\t\t\t\tif (_.contains(['word','html','inlineTemplate'],prop) && media[prop]) { // sometimes we have an empty value (this happens when we load a template and then translate it into an inline template)\n                    return media[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t});\n\n\t// Returns the Model class\n\treturn Model;\n\n});\n","define('app/stimulus/stimulus_constructor',['require','./stimulus_model'],function(require){\n\tvar Stim_model = require('./stimulus_model');\n\n\treturn function Stimulus_constructor(source, options){\n\n\t\tvar data = source;\n\t\t// keep source for later use\n\t\t// @TODO probably depracated\n\t\tdata.source = source;\n\n\t\treturn new Stim_model(data, options);\n\t};\n\n});\n","define('app/stimulus/stimulus_collection',['require','underscore','backbone','app/stimulus/stimulus_constructor'],function(require){\n\tvar _ = require('underscore')\n\t\t, Backbone = require('backbone')\n\t\t, stimModel = require('app/stimulus/stimulus_constructor');\n\n\tvar Collection = Backbone.Collection.extend({\n\t\tmodel:stimModel,\n\n\t\tinitialize: function(models,options){\n\t\t\toptions || (options = {});\n\n\t\t\t// set trial in the collection\n\t\t\tthis.trial = options.trial;\n\t\t},\n\n\t\t// similar to the collection function where, only searches the data attribute\n\t\twhereData: function(attrs) {\n\n\t\t\tif (_.isEmpty(attrs)) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn this.filter(function(model) {\n\t\t\t\tvar data = model.get('data') || {};\n\n\t\t\tfor (var key in attrs) {\n\t\t\t\tif (attrs[key] !== data[key]) {\n                    return false;\n                }\n\t\t\t}\n\t\t\treturn true;\n\t\t\t});\n\t\t},\n\n\t\tactivate: function(){\n\t\t\tthis.each(function(stimulus){\n\t\t\t\tstimulus.activate();\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\tdisable: function(){\n\t\t\tthis.each(function(stimulus){\n\t\t\t\tstimulus.disable();\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\tdisplay_all: function(){\n\t\t\tthis.each(function(stimulus){\n\t\t\t\tstimulus.media.show();\n\t\t\t});\n\t\t},\n\n\t\thide_all: function(){\n\t\t\tthis.each(function(stimulus){\n\t\t\t\tstimulus.media.hide();\n\t\t\t});\n\t\t},\n\n\t\trefresh: function(){\n\t\t\tthis.each(function(stimulus){\n\t\t\t\tstimulus.media.render();\n\t\t\t});\n\t\t},\n\n\t\tget_stimlist: function(){\n\t\t\treturn this\n\t\t\t\t.chain()\n\t\t\t\t.filter(function(stimulus){return !stimulus.get('nolog');})\n\t\t\t\t.map(function(stimulus,index){\n\t\t\t\t\treturn stimulus.name() || ('stim' + index);\n\t\t\t\t})\n\t\t\t\t.value();\n\t\t},\n\n\t\tget_medialist: function(){\n\t\t\treturn this\n\t\t\t\t.chain()\n\t\t\t\t.filter(function(stimulus){return !stimulus.get('nolog');})\n\t\t\t\t.map(function(stimulus,index){\n\t\t\t\t\treturn stimulus.mediaName() || ('media' + index);\n\t\t\t\t})\n\t\t\t\t.value();\n\t\t}\n\n\t});\n\n\t// Returns the Collection class\n\treturn Collection;\n\n});\n","/*\n * gets a condition array (or a single condition) and evaluates it\n * returns true if all statements are true, false otherwise\n *\n * a single condition looks like this:\n *\n *\tcondition = {\n *\t\ttype : 'begin/inputEquals/inputEqualsTrial/inputEqualsStim/function',\n *\t\tvalue: 'right/trialAttribute/stimAttribute/customFunction',\n *\t\thandle: 'stim handle' (optional in case we're targeting a stimulus)\n *\t}\n *\n */\n\ndefine('app/trial/evaluate',['require','underscore','app/global','./current_trial'],function(require){\n\n\tvar _ = require('underscore')\n\t\t, globalGetter = require('app/global')\n\t\t, current_trial = require('./current_trial');\n\n\n\treturn function evaluate(conditions, inputData){\n\n\t\tvar global = globalGetter();\n\t\tvar current = global.current || {};\n\t\tvar trial = current_trial();\n\n\t\tif (!conditions){\n\t\t\tthrow new Error(\"There is an interaction without conditions!!\");\n\t\t}\n\n\t\t// make sure conditions is an array\n\t\tconditions = _.isArray(conditions) ? conditions : [conditions];\n\n\t\t// the internal event\n\t\tinputData = inputData || {};\n\n\t\t// assume condition is true\n\t\tvar isTrue = true;\n\n\t\t// if this is a begin event, make sure we only run conditions that have begin in them\n\t\tif (inputData.type == 'begin') {\n\t\t\t// check if this set of conditions has 'begin' in it\n\t\t\tvar has_begin = _.reduce(conditions, function(memo, row){return memo || row.type == 'begin';},false);\n\t\t\tif (!has_begin){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// try to refute the condition\n\t\t_.each(conditions,function(condition){\n\t\t\tvar searchObj, result;\n\t\t\tvar evaluation = true;\n\t\t\tswitch (condition.type){\n\t\t\t\tcase 'begin':\n\t\t\t\t\tif (inputData.type !== 'begin') {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'inputEquals' :\n\t\t\t\t\t// make sure condition.value is an array\n\t\t\t\t\t_.isArray(condition.value) || (condition.value = [condition.value]);\n\n\t\t\t\t\tif (_.indexOf(condition.value,inputData.handle) === -1) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'inputEqualsTrial':\n\t\t\t\t\tif (inputData.handle !== trial.data[condition.property]) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'inputEqualsStim':\n\t\t\t\t\t// create search object\n\t\t\t\t\tsearchObj = {};\n\t\t\t\t\tif (condition.handle){\n\t\t\t\t\t\tsearchObj['handle'] = condition.handle;\n\t\t\t\t\t}\n\t\t\t\t\tsearchObj[condition.property] = inputData.handle;\n\n\t\t\t\t\t// are there stimuli answering this descriptions?\n\t\t\t\t\tresult = trial._stimulus_collection.whereData(searchObj);\n\t\t\t\t\tif (result.length === 0) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'trialEquals':\n\t\t\t\t\tif (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n\t\t\t\t\t\tthrow new Error('trialEquals requires both \"property\" and \"value\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (condition.value !== trial.data[condition.property]){\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'inputEqualsGlobal':\n\t\t\t\t\tif (typeof condition.property == 'undefined'){\n\t\t\t\t\t\tthrow new Error('inputEqualsGlobal requires \"property\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (inputData.handle !== global[condition.property]){\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'globalEquals':\n\t\t\t\t\tif (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n\t\t\t\t\t\tthrow new Error('globalEquals requires both \"property\" and \"value\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (condition.value !== global[condition.property]){\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'globalEqualsTrial':\n\t\t\t\t\tif (typeof condition.globalProp == 'undefined' || typeof condition.trialProp == 'undefined'){\n\t\t\t\t\t\tthrow new Error('globalEqualsTrial requires both \"globalProp\" and \"trialProp\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (global[condition.globalProp] !== trial.data[condition.trialProp]) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'globalEqualsStim':\n\t\t\t\t\tif (typeof condition.globalProp == 'undefined' || typeof condition.stimProp == 'undefined'){\n\t\t\t\t\t\tthrow new Error('globalEqualsStim requires both \"globalProp\" and \"stimProp\" to be defined');\n\t\t\t\t\t}\n\n\t\t\t\t\t// create search object\n\t\t\t\t\tsearchObj = {};\n\t\t\t\t\tif (condition.handle){\n\t\t\t\t\t\tsearchObj['handle'] = condition.handle;\n\t\t\t\t\t}\n\t\t\t\t\tsearchObj[condition.stimProp] = global[condition.globalProp];\n\n\t\t\t\t\t// are there stimuli answering this descriptions?\n\t\t\t\t\tresult = trial._stimulus_collection.whereData(searchObj);\n\t\t\t\t\tif (result.length === 0) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'inputEqualsCurrent':\n\t\t\t\t\tif (typeof condition.property == 'undefined'){\n\t\t\t\t\t\tthrow new Error('inputEqualsCurrent requires \"property\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (inputData.handle !== current[condition.property]){\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'currentEquals':\n\t\t\t\t\tif (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n\t\t\t\t\t\tthrow new Error('currentEquals requires both \"property\" and \"value\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (condition.value !== current[condition.property]){\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'currentEqualsTrial':\n\t\t\t\t\tif (typeof condition.currentProp == 'undefined' || typeof condition.trialProp == 'undefined'){\n\t\t\t\t\t\tthrow new Error('currentEqualsTrial requires both \"currentProp\" and \"trialProp\" to be defined');\n\t\t\t\t\t}\n\t\t\t\t\tif (current[condition.currentProp] !== trial.data[condition.trialProp]) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'currentEqualsStim':\n\t\t\t\t\tif (typeof condition.currentProp == 'undefined' || typeof condition.stimProp == 'undefined'){\n\t\t\t\t\t\tthrow new Error('currentEqualsStim requires both \"currentProp\" and \"stimProp\" to be defined');\n\t\t\t\t\t}\n\n\t\t\t\t\t// create search object\n\t\t\t\t\tsearchObj = {};\n\t\t\t\t\tif (condition.handle){\n\t\t\t\t\t\tsearchObj['handle'] = condition.handle;\n\t\t\t\t\t}\n\t\t\t\t\tsearchObj[condition.stimProp] = current[condition.currentProp];\n\n\t\t\t\t\t// are there stimuli answering this descriptions?\n\t\t\t\t\tresult = trial._stimulus_collection.whereData(searchObj);\n\t\t\t\t\tif (result.length === 0) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'function' :\n\t\t\t\t\tif (!condition.value.apply(trial,[trial,inputData])) {\n\t\t\t\t\t\tevaluation = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Unknown condition type: ' + condition.type);\n\t\t\t}\n\n\t\t\tisTrue = isTrue && (condition.negate ? !evaluation : evaluation);\n\t\t});\n\n\t\treturn isTrue;\n\t};\n});\n","define('app/trial/action_list',['require','underscore','utils/pubsub','utils/interface/interface','app/global','app/task/main_view','app/task/canvasConstructor','app/trial/current_trial'],function(require){\n\n\tvar _ = require('underscore')\n\t\t, pubsub = require('utils/pubsub')\n\t\t, input = require('utils/interface/interface')\n\t\t, global = require('app/global');\n\n \tvar actions = {\n\t\t/*\n\t\t * Stimulus actions\n\t\t *\n\t\t */\n\n\t\tshowStim: function(options){\n\t\t\tvar handle = options.handle || options;\n\t\t\tpubsub.publish('stim:start',[handle]);\n\t\t},\n\n\t\thideStim: function(options){\n\t\t\tvar handle = options.handle || options;\n\t\t\tpubsub.publish('stim:stop',[handle]);\n\t\t},\n\n\t\tsetStimAttr: function(options){\n\t\t\tvar handle = options.handle;\n\t\t\tvar setter = options.setter;\n\t\t\tpubsub.publish('stim:setAttr',[handle,setter]);\n\t\t},\n\n\t\t/*\n\t\t * Trial actions\n\t\t */\n\n\t\tsetTrialAttr: function(options, eventData){\n\t\t\tif (typeof options.setter == 'undefined') {\n\t\t\t\tthrow new Error('The setTrialAttr action requires a setter property');\n\t\t\t}\n\t\t\tpubsub.publish('trial:setAttr',[options.setter, eventData]);\n\t\t},\n\n\t\tsetInput: function(options){\n\t\t\tif (typeof options.input == 'undefined') {\n\t\t\t\tthrow new Error('The setInput action requires an input property');\n\t\t\t}\n\t\t\tpubsub.publish('trial:setInput',[options.input]);\n\t\t},\n\n\t\ttrigger: function(options){\n\t\t\tif (typeof options.handle == 'undefined') {\n\t\t\t\tthrow new Error('The trigger action requires a handle property');\n\t\t\t}\n\t\t\tpubsub.publish('trial:setInput',[{handle:options.handle,on:'timeout',duration:+options.duration || 0}]);\n\t\t},\n\n\t\tremoveInput: function(options){\n\t\t\tif (typeof options.handle == 'undefined') {\n\t\t\t\tthrow new Error('The removeInput action requires a handle property');\n\t\t\t}\n\t\t\tpubsub.publish('trial:removeInput',[options.handle]);\n\t\t},\n\n\t\t// we use es3 true to protect from trailing commas in IE7. Here jshint thinks goto is a reserved word.\n\t\t/* jshint es3:false */\n\t\tgoto: function(options){\n\t\t/* jshint es3:true */\n\n\t\t\tpubsub.publish('trial:goto',[options]);\n\t\t},\n\n\t\tendTrial: function(){\n\t\t\tpubsub.publish('trial:end');\n\t\t},\n\n\t\tresetTimer: function(options,eventData){\n\t\t\t// set current evenData to 0\n\t\t\teventData.latency = 0;\n\t\t\t// reset the global timer\n\t\t\tinput.resetTimer();\n\t\t},\n\n\t\t/*\n\t\t * Logger\n\t\t */\n\n\t\tlog: function(options,eventData){\n\t\t\tpubsub.publish('log',[options,eventData]);\n\t\t},\n\n\t\t/*\n\t\t * Misc\n\t\t */\n\n\t\tsetGlobalAttr: function(options){\n\t\t\tswitch (typeof options.setter){\n\t\t\t\tcase 'function':\n\t\t\t\t\toptions.setter.apply(null,[global(), options]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\t_.extend(global(), options.setter);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('setGlobalAttr requires a \"setter\" property');\n\t\t\t}\n\t\t},\n\n\t\tcustom: function(options,eventData){\n\t\t\tif (typeof options.fn != 'function') {\n\t\t\t\tthrow new Error('The custom action requires a fn propery');\n\t\t\t}\n\t\t\toptions.fn.apply(null, [options,eventData,global()]);\n\t\t},\n\n\t\tcanvas: function(options){\n\t\t\tvar $canvas = require('app/task/main_view').$el;\n\t\t\tvar canvas = require('app/task/canvasConstructor');\n\t\t\tvar trial = require('app/trial/current_trial')();\n\t\t\tvar map = {\n\t\t\t\tbackground \t\t\t: {element: $('body'), property: 'backgroundColor'},\n\t\t\t\tcanvasBackground\t: {element: $canvas, property:'backgroundColor'},\n\t\t\t\tborderColor\t\t\t: {element: $canvas, property:'borderColor'},\n\t\t\t\tborderWidth\t\t\t: {element: $canvas, property:'borderWidth'}\n\t\t\t};\n\n\t\t\t// settings activator\n\t\t\tvar off = canvas(map, _.pick(options,['background','canvasBackground','borderColor','borderWidth']));\n\t\t\ttrial.deferred.promise().always(off);\n\t\t}\n\n\t};\n\n\treturn actions;\n});\n","define('app/trial/action',['require','underscore','./action_list'],function(require){\n\t/*\n\t * accepts an array of actions (or a single action)\n\t * and applies them\n\t *\n\t * actions = [\n\t *\t\t{type:actionName,more:options},\n\t *\t\t{actionName:options}\n\t * ]\n\t * @param actions: single action object or array of action objects\n\t * @param eventData: eventData object\n\t * @returns Boolean continueActions: whether this action stops further action activations\n\t */\n\n\tvar _ = require('underscore')\n\t\t, action_list = require('./action_list');\n\n\tfunction applyActions(actions,eventData){\n\t\t// marks whether this is the final action to take\n\t\tvar continueActions = true;\n\n\t\tif (!actions){\n\t\t\tthrow new Error(\"There is an interaction without actions!!\");\n\t\t}\n\n\t\tactions = _.isArray(actions) ? actions : [actions];\n\n\t\t_.forEach(actions,function(action){\n\t\t\tvar actionFn = action_list[action.type];\n\t\t\tif (action) {\n\t\t\t\t// currently the only reason to halt action activation is the endTrial command\n\t\t\t\tif (action.type === 'endTrial'){\n\t\t\t\t\tcontinueActions = false;\n\t\t\t\t}\n\t\t\t\tactionFn(action, eventData);\n\t\t\t} else {\n\t\t\t\tthrow new Error('unknown action: ' + action.type);\n\t\t\t}\n\t\t});\n\n\t\treturn continueActions;\n\t}\n\n\treturn applyActions;\n});\n\n","define('app/trial/interactions',['require','jquery','utils/pubsub','./evaluate','./action'],function(require){\n\t/*\n\t * Organizer for the interaction function\n\t * Allows to subscribe and unsubscribe\n\t *\n\t */\n\n\tvar $ = require('jquery')\n\t\t, pubsub = require('utils/pubsub')\n\t\t, evaluate = require('./evaluate')\n\t\t, activate = require('./action');\n\n\tvar subscriptionStack = [];\n\n\tvar interact = function(interactions,input_data){\n\t\t$.each(interactions,function(key,row){\n\t\t\tif (evaluate(row.conditions,input_data)) {\n\t\t\t\t// if this action includes endTrial we want to stop evalutation\n\t\t\t\t// otherwise we might evaluate using data from the next trial by accident...\n\t\t\t\treturn activate(row.actions,input_data);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn {\n\t\tactivate : function(interactions){\n\t\t\t// subscribe to input and interact with each input\n\t\t\tpubsub.subscribe('input',subscriptionStack,function(input_data){\n\t\t\t\tinteract(interactions,input_data);\n\t\t\t});\n\n\t\t\t// start by checking for \"begin\" actions (must be after subscribing!)\n\t\t\tinteract(interactions,{type:'begin', latency:0});\n\t\t},\n\t\tdisable : function(){\n\t\t\t// unsubscribe from all interactions\n\t\t\t$.each(subscriptionStack,function(){\n\t\t\t\tpubsub.unsubscribe(this);\n\t\t\t});\n\t\t}\n\t};\n});\n\n","define('app/trial/trial_constructor',['require','jquery','underscore','utils/pubsub','utils/interface/interface','app/stimulus/stimulus_collection','./interactions','./current_trial','app/task/main_view'],function(require){\n\n\tvar $ = require('jquery');\n\tvar _ = require('underscore');\n\tvar pubsub = require('utils/pubsub');\n\tvar input = require('utils/interface/interface');\n\tvar Stimuli = require('app/stimulus/stimulus_collection');\n\tvar interactions = require('./interactions');\n\tvar global_trial = require('./current_trial');\n\tvar main = require('app/task/main_view');\n\tvar counter = 0;\n\n\t// data is already fully inflated\n\tfunction Trial(source){\n\t\t// make sure we always have a data container\n\t\tthis.data || (this.data = source.data || {});\n\n\t\t// keep source for later use\n\t\tthis._source = source;\n\n\t\t// create a uniqueId for this trial\n\t\tthis._id = _.uniqueId('trial_');\n\t\tthis.counter = counter++;\n\n\t\t// make sure we have all our stuff :)\n\t\t//if (!this.input) throw new Error('Input module not defined');\n\t\tif (!source.interactions) {\n\t\t\tthrow new Error('Interactions not defined');\n\t\t}\n\n\t\t// add layout stimuli\n\t\tthis._layout_collection = new Stimuli(arrayWrap(source.layout),{trial:this});\n\n\t\t// add main stimuli\n\t\tthis._stimulus_collection = new Stimuli(arrayWrap(source.stimuli),{trial:this});\n\n\t\t// subscription stack\n\t\tthis._pubsubStack = [];\n\n\t\t// the next trial we want to play\n\t\t// by default this is simply the next trial, this can be changed using the goto action\n\t\t// the syntax is [destination, properties]\n\t\tthis._next = ['next',{}];\n\n\t\t// the trial deferred (used to follow when the trial ends)\n\t\tthis.deferred = $.Deferred();\n\t}\n\n\t_.extend(Trial.prototype,{\n\n\t\tactivate: function(){\n\n\t\t\tvar self = this;\n\n\t\t\t// set global trial\n\t\t\tglobal_trial(this);\n\n\t\t\t// display layout elements\n\t\t\tthis._layout_collection.display_all();\n\n\t\t\t// subscribe to end trial\n\t\t\tpubsub.subscribe(\"trial:end\",this._pubsubStack,_.bind(this.deactivate,this));\n\n\t\t\t// subscribe to set attribute\n\t\t\tpubsub.subscribe(\"trial:setAttr\",this._pubsubStack,function(setter,eventData){\n\t\t\t\tif (_.isFunction(setter)) {\n\t\t\t\t\tsetter.apply(self, [self.data,eventData]);\n\t\t\t\t} else {\n\t\t\t\t\t_.extend(self.data,setter);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// subscribe to set input\n\t\t\tpubsub.subscribe(\"trial:setInput\",this._pubsubStack,function(inputData){\n\t\t\t\tinput.add(inputData);\n\t\t\t});\n\n\t\t\t// subscribe to remove input\n\t\t\tpubsub.subscribe(\"trial:removeInput\",this._pubsubStack,function(handleList){\n\t\t\t\tif (handleList == 'All' || _.include(handleList,'All')){\n\t\t\t\t\tinput.destroy();\n\t\t\t\t} else {\n\t\t\t\t\tinput.remove(handleList);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// subscribe to goto\n\t\t\tpubsub.subscribe(\"trial:goto\",this._pubsubStack,function(options){\n\t\t\t\tself._next = [options.destination, options.properties || {}];\n\t\t\t});\n\n\t\t\t// activate input\n\t\t\tinput.add(arrayWrap(this._source.input));\n\n\t\t\t// activate stimuli\n\t\t\tthis._stimulus_collection.activate();\n\n\t\t\t// reset the interface timer so that event latencies are relative to now.\n\t\t\tinput.resetTimer();\n\n\t\t\t// listen for interaction\n\t\t\tinteractions.activate(this._source.interactions);\n\n\t\t\t// return the trial deferred\n\t\t\treturn this.deferred.promise();\n\t\t},\n\n\t\tdeactivate: function(){\n\t\t\tvar self = this;\n\n\t\t\t// cancel all listeners\n\t\t\tinput.destroy();\n\n\t\t\t// disable active stimuli\n\t\t\tthis._stimulus_collection.disable();\n\n\t\t\t// stop interaction listeners\n\t\t\tinteractions.disable();\n\n\t\t\t// unsubscribe\n\t\t\t_.each(this._pubsubStack, function(handle) {\n\t\t\t\tpubsub.unsubscribe(handle);\n\t\t\t});\n\t\t\tthis._pubsubStack = [];\n\n\t\t\t// unset global trial\n\t\t\tglobal_trial(undefined);\n\n\t\t\t// IE7 or lower\n\t\t\t// @todo: improve very ugly solution to ie7 bug, we need the no timeout solution for ipad where this causes a blink\n\t\t\tif (document.all && !document.addEventListener) {\n\t\t\t\t// resolve this trial (inside timeout, to make sure the endtrial subscription ends. ie7 bug)\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t// remove all stimuli from canvas (needs to be inside timeout to prevent blink in some browsers)\n\t\t\t\t\tmain.empty();\n\t\t\t\t\tself.deferred.resolve(self._next[0], self._next[1]);\n\n\t\t\t\t},1);\n\t\t\t} else {\n\t\t\t\t// regular resolve (let the deferred know were we are going next)\n\t\t\t\tmain.empty();\n\t\t\t\tself.deferred.resolve(self._next[0], self._next[1]);\n\t\t\t}\n\t\t},\n\n\t\tname: function(){\n\t\t\t// if we have an alias ues it\n\t\t\tif (this.data.alias) {\n\t\t\t\treturn this.data.alias;\n\t\t\t}\n\t\t\t// otherwise try using the set we inherited from\n\t\t\tif (_.isString(this._source.inherit)){\n\t\t\t\treturn this._source.inherit;\n\t\t\t}\n\t\t\tif (_.isPlainObject(this._source.inherit)){\n\t\t\t\treturn this._source.inherit.set;\n\t\t\t}\n\t\t\treturn false; // we're out of options here\n\t\t}\n\t});\n\n\tfunction arrayWrap(arr){\n\t\tif (!arr){return [];}\n\t\treturn _.isArray(arr) ? arr : [arr];\n\t}\n\n\treturn Trial;\n});\n","/*\n * Send log chunk\n * returns a function that takes data and sends it to the server after appending any meta data\n */\ndefine('app/task/log/post',['require','jquery','app/task/settings'],function(require){\n\tvar $ = require('jquery')\n\t\t, settingsGetter = require('app/task/settings');\n\n\tfunction send(data){\n\t\tvar settings = settingsGetter();\n\t\tvar url = settings.logger && settings.logger.url\n\t\t\t, deff = $.Deferred();\n\n\t\tif (!url) {\n\t\t\treturn deff.resolve();\n\t\t}\n\n\t\t// build post data\n\t\tvar post = {\n\t\t\tjson: JSON.stringify(data) || \"\"\n\t\t};\n\t\t$.extend(post, settings.metaData || {});\n\n\t\t// lets post our data\n\t\tdeff = $.post(url,post);\n\n\t\t// now, if there was a failure, lets try to resend\n\t\tdeff = deff.then(null,function(){\n\t\t\treturn $.post(url,post);\n\t\t});\n\n\t\treturn deff;\n\t}\n\n\treturn send;\n});\n\n\n","/*\n * Holds the logged rows in serial order\n */\ndefine('app/task/log/log_stack',['require','app/global'],function(require){\n\tvar global = require('app/global');\n\n\treturn function(){\n\t\treturn global().current.logs;\n\t};\n});\n","/*\n * activate logger\n * note that we are loading modules into the global object here (json2)\n */\ndefine('app/task/log/logger',['require','jquery','utils/pubsub','app/trial/current_trial','app/task/settings','./post','./log_stack'],function(require){\n\n\tvar $ = require('jquery')\n\t\t, pubsub = require('utils/pubsub')\n\t\t, trial = require('app/trial/current_trial')\n\t\t, settings = require('app/task/settings')\n\t\t, post = require('./post')\n\t\t, logStackGetter = require('./log_stack');\n\n\t// counter for the last time we sent (it holds the last length for which we sent)\n\tvar lastSend = 0;\n\tvar postDef = $.Deferred().resolve(); // a defered to follow all posting\n\n\tfunction defaultLogger(trialData, inputData, actionData,logStack){\n\n\t\tvar stimList = this._stimulus_collection.get_stimlist();\n\t\tvar mediaList = this._stimulus_collection.get_medialist();\n\n\t\treturn {\n\t\t\tlog_serial : logStack.length,\n\t\t\ttrial_id: this.counter,\n\t\t\tname: this.name(),\n\t\t\tresponseHandle: inputData.handle,\n\t\t\tlatency: Math.floor(inputData.latency),\n\t\t\tstimuli: stimList,\n\t\t\tmedia: mediaList,\n\t\t\tdata: trialData\n\t\t};\n\t}\n\n\t/*\n\t * Send all logs since lastSend\n\t * @returns $.Deferred\n\t */\n\tfunction sendChunk(){\n\t\tvar logChunk; // the log chunk we want to send right now\n\t\tvar logStack = logStackGetter();\n\n\t\t// if  we've already sent everything,  we don't need to do anything\n\t\tif (logStack.length - lastSend <= 0) {\n\t\t\treturn postDef;\n\t\t} else {\n\t\t\t// get the log chunk that we want to send\n\t\t\tlogChunk =  logStack.slice(lastSend, logStack.length);\n\n\t\t\t// reset lastSend counter\n\t\t\tlastSend = logStack.length;\n\t\t\treturn $.when(postDef, post(logChunk));\n\t\t}\n\t}\n\n\t/*\n\t * create log row and push it into log stack\n\t */\n\tpubsub.subscribe('log',function(options, input_data){\n\t\tvar logStack = logStackGetter();\n\t\t// get settings\n\t\tvar logger = settings().logger || {};\n\t\t// get the logger function\n\t\tvar callback = logger.logger ? logger.logger : defaultLogger;\n\n\t\t// add row to log stack\n\t\tvar trialObj = trial();\n\t\tvar row = callback.apply(trialObj,[trialObj.data, input_data, options,logStack]);\n\n\t\tif (logger.meta){\n\t\t\tif ($.isPlainObject(logger.meta)){\n\t\t\t\t$.extend(row, logger.meta);\n\t\t\t} else {\n\t\t\t\tthrow new Error ('LOGGER: logger.meta must be an object but instead was a ' + typeof logger.meta);\n\t\t\t}\n\t\t}\n\n\t\tlogStack.push(row);\n\t});\n\n\t/*\n\t * send logStack to server, but only if it is full\n\t * The end task send is activated directly using the send function\n\t */\n\tpubsub.subscribe('log:send',function(){\n\t\tvar logStack = logStackGetter();\n\t\t// get pulse size\n\t\tvar pulse = settings().logger && settings().logger.pulse;\n\n\t\t// if logStack is full, lets send it\n\t\tif (pulse && logStack.length - lastSend >= pulse) {\n\t\t\tsendChunk();\n\t\t}\n\t});\n\n\treturn sendChunk;\n});\n","define('app/sequencer/inflateTrial',['require','underscore','../global','./taskSequence','./database','../task/build_url'],function(require){\n\n\tvar _ \t\t\t\t\t= require('underscore');\n\tvar globalGetter \t\t= require('../global');\n\tvar sequenceGetter\t\t= require('./taskSequence');\n\tvar db \t\t\t\t\t= require('./database');\n\tvar buildUrl \t\t\t= require('../task/build_url');\n\n\tfunction inflateTrial(destination, properties){\n\t\tvar sequence = sequenceGetter();\n\t\tvar global = globalGetter();\n\t\tvar context = {global: global, current: global.current};\n\t\tvar source;\n\n\t\tsequence.go(destination, properties, context);\n\t\tsource = sequence.current(context, {skip:['layout','stimuli']});\n\n\t\tif (!source){\n\t\t\treturn;\n\t\t}\n\n\t\tsource.stimuli = _.map(source.stimuli || [], buildStim, context);\n\t\tsource.layout = _.map(source.layout || [], buildStim, context);\n\n\t\tcontext.trialData = null;\n\t\treturn source;\n\t}\n\n\treturn inflateTrial;\n\n\tfunction buildMedia(stim, prop, context){\n\t\tvar val = stim[prop];\n\n\t\tif (!val) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (_.isString(val)){\n\t\t\tstim[prop] = val = {word: val};\n\t\t}\n\n\t\tval = db.inflate('media', val, context);\n\n\t\t// note that the base url is added to the media object during the sequence preload\n\t\t// if needed, build url\n\t\tif (val.image){\n\t\t\tval.image = buildUrl(val.image,'image');\n\t\t}\n\n\t\tif (val.template){\n\t\t\tval.inlineTemplate = requirejs('text!' + buildUrl(val.template, 'template'));\n\t\t\tval.inlineTemplate = _.template(val.inlineTemplate)(context);\n\t\t}\n\n\t\tstim[prop] = val;\n\n\t\tcontext.mediaData = null;\n\t\tcontext.mediaMeta = null;\n\t}\n\n\tfunction buildStim(stim){\n\t\tvar context = this;\n\n\t\tstim = db.inflate('stimulus', stim, context, {skip:['media','touchMedia']});\n\t\tbuildMedia(stim, 'media', context);\n\t\tbuildMedia(stim, 'touchMedia', context);\n\t\tcontext.stimulusData = null;\n\t\tcontext.stimulusMeta = null;\n\t\treturn stim;\n\t}\n});\n","define('app/sequencer/player',['require','jquery','app/trial/trial_constructor','app/task/log/logger','app/task/settings','utils/pubsub','app/task/main_view','./inflateTrial'],function(require){\n\n\tvar $\t\t\t\t\t= require('jquery')\n\t\t, Trial\t\t\t\t= require('app/trial/trial_constructor')\n\t\t, logger\t\t\t= require('app/task/log/logger')\n\t\t, settingsGetter\t= require('app/task/settings')\n\t\t, pubsub\t\t\t= require('utils/pubsub')\n\t\t, main \t\t\t\t= require('app/task/main_view')\n\t\t, inflateTrial \t\t= require('./inflateTrial');\n\n\n\t/*\n\t * the function that plays the source sequence\n\t */\n\n\t// check if we have another trial, if so plays it, if not ends the task\n\tfunction nextTrial(destination, properties){\n\n\t\tvar source = inflateTrial(destination, properties);\n\t\tvar trial;\n\n\t\t// if we have another trial play it (next() both returns the next trial and sets it as current)\n\t\tif (source) {\n\t\t\t// create new trial and activate it\n\t\t\ttrial = new Trial(source);\n\t\t\ttrial\n\t\t\t\t.activate()\t\t\t\t\t\t\t\t// activate the trial\n\t\t\t\t.done(function(){\n\t\t\t\t\tpubsub.publish('log:send');\t\t\t// see if we need to send the log stack\n\t\t\t\t\tnextTrial.apply(null,arguments);\t// when we're done try to play the next one (move arguments on to nextTrial)\n\t\t\t\t});\n\n\t\t\t// let everyone know that we are ready to go\n\t\t\tpubsub.publish(\"trial:activated\",[trial]);\n\t\t} else {\n\t\t\t// @TODO: this realy shouldn't be here. this whole function is responsible for too many things...\n\t\t\t//\n\t\t\t// post any data that hasn't been posted yet.\n\t\t\t// and then proceed to the end task hook or to redirect\n\t\t\tlogger()\n\t\t\t\t.always(function(){\n\t\t\t\t\tvar hooks = settingsGetter('hooks') || {};\n\t\t\t\t\treturn $.when(hooks.endTask && hooks.endTask());\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tmain.deferred.resolve();\n\t\t\t\t});\n\t\t}\n\t}\n\n\treturn nextTrial;\n\n});\n\n","/**\n * Activate pip script\n * @param  {Object} script    The pip script we want to run\n * @param  {?function} done   A function to call once pip is over\n * @return {promise}\n */\ndefine('activatePIP',['require','underscore','app/task/script','app/task/main_view','app/task/parser','app/sequencer/player','app/global'],function(require){\n\n\tvar _ = require('underscore'),\n\t\tmainScript = require('app/task/script'),\n\t\tmain = require('app/task/main_view'),\n\t\tparse = require('app/task/parser'),\n\t\tplay = require('app/sequencer/player'),\n\t\tglobal = require('app/global');\n\n\n\tfunction activate(script, done){\n\t\t// init global\n\t\tvar glob = global(global());\n\t\tvar name = script.name || 'anonymous PIP';\n\n\t\t// create local namespace\n\t\tglob[name] = glob.current = (_.isPlainObject(script.current) ? script.current : {});\n\t\tglob.current.logs || (glob.current.logs = []); // init logs object\n\n\t\t// set the main script as a global\n\t\tmainScript(script);\n\n\t\tvar parseDef = parse();\n\n\t\t// activate main view and then display the loading screen\n\t\tmain\n\t\t\t.activate()\n\t\t\t.done(function(){\n\t\t\t\tmain\n\t\t\t\t\t.loading(parseDef) // activate loading screen\n\t\t\t\t\t.done(function(){\n\t\t\t\t\t\tmain.empty(); // remove the loading screen\n\t\t\t\t\t\tplay('next',{}); // activate task\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(src){\n\t\t\t\t\t\tthrow new Error('loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - ' + src +')');\n\t\t\t\t\t});\n\t\t\t});\n\n\t\treturn main.deferred.promise()\n\t\t\t.then(done || function dfltDone(){\n\t\t\t\tvar redirect = script.settings && script.settings.redirect;\n\t\t\t\twindow.location.href = redirect || window.location.href;\n\t\t\t});\n\t}\n\n\treturn activate;\n});\n","/**\n * Essentialy a defaults object for the scorer\n */\ndefine('pipScorer/computeD',['require','jquery'],function(require){\n\tvar $ = require('jquery');\n\n\tfunction ComputeD(){\n\t\t$.extend(this, {\n\t\t\tdataArray : {}, //The data array or structure the PIP will provide\n\t\t\tAnalyzedVar : \"latency\", //The main variable used for the score computation. Usually will be the latency.\n\t\t\tErrorVar : \"error\", //The variable that indicates whether there was an error in the response\n\t\t\tcondVar:\"\",  //The name of the variable that will store the variables\n\t\t\tcond1VarValues: [], //An array with the values of the condVar that will comprise of condition 1 in the comparison\n\t\t\tcond2VarValues: [], //An array with the values of the condVar that will comprise of condition 2 in the comparison\n\t\t\tparcelVar : \"\",\n\t\t\tparcelValue : [],\n\t\t\tfastRT : 300, //Below this reaction time, the latency is considered extremely fast.\n\t\t\tmaxFastTrialsRate : 0.1, //Above this % of extremely fast responses within a condition, the participant is considered too fast.\n\t\t\tminRT : 400, //Below this latency\n\t\t\tmaxRT : 10000, //above this\n\t\t\tmaxErrorParcelRate: 0.4,\n\t\t\terrorLatency : {use:\"latency\", penalty:600, useForSTD:true},\n\t\t\tpostSettings : {}\n\t\t});\n\t}\n\n\t$.extend(ComputeD.prototype, {\n\t\tsetComputeObject: function(obj){\n\t\t\t$.extend(this,obj);\n\t\t},\n\n\t\tsetDataArray: function(){\n\t\t\t// use the real global in order to preven problems with dependencies\n\t\t\tvar global = window.piGlobal;\n\n\t\t\tthis.dataArray = global.current.logs;\n\t\t}\n\n\t});\n\n\treturn ComputeD;\n});\n","define('pipScorer/msgMan',['require','underscore'],function(require){\n\tvar _ = require('underscore');\n\n\tvar messages = {\n\t\tMessageDef:[],\n\t\tmanyErrors: \"There were too many errors made to determine a result.\",\n\t\ttooFast: \"There were too many fast trials to determine a result.\",\n\t\tnotEnough: \"There were not enough trials to determine a result.\"\n\t};\n\n\tfunction Message(){\n\t\t// setup default local messages\n\t\tthis.messages = _.extend({}, messages);\n\t}\n\n\t_.extend(Message.prototype, {\n\n\t\t/**\n\t\t * Setup custom local messages\n\t\t * @param {Object} Obj \tmessages object\n\t\t */\n\t\tsetMsgObject: function(Obj){\n\t\t\t_.extend(this.messages,Obj);\n\t\t},\n\n\t\tgetScoreMsg: function(score){\n\n\t\t\tvar array = this.messages.MessageDef;\n\n\t\t\tif (!array || !array.length){\n\t\t\t\tthrow new Error('You must define a \"MessageDef\" array.');\n\t\t\t}\n\n\t\t\tvar scoreNum = parseFloat(score);\n\t\t\tvar cut = null;\n\t\t\tvar msg = null;\n\t\t\tvar rightMsg = 'error: msg was not set';\n\t\t\tvar set = false;\n\n\t\t\t// @TODO repleace this whole section with a \"_.find()\" or something.\n\t\t\t_.each(array, function(val) {\n\t\t\t\tcut = parseFloat(val.cut);\n\t\t\t\tmsg = val.message;\n\t\t\t\tif (scoreNum<=cut && !set){\n\t\t\t\t\trightMsg = msg;\n\t\t\t\t\tset = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!set){\n\t\t\t\tvar length = array.length;\n\t\t\t\tvar obj = array[length-1];\n\t\t\t\trightMsg = obj.message;\n\t\t\t}\n\n\t\t\treturn rightMsg;\n\t\t},\n\n\t\tgetMessage: function getMessage(type){\n\t\t\treturn this.messages[type];\n\t\t}\n\t});\n\n\treturn Message;\n});\n","define('pipScorer/parcelMng',['require','underscore'],function(require){\n\n\tvar _ = require('underscore');\n\n\tfunction ParcelMng(msgMan){\n\t\tthis.parcelArray = []; // Holds parcel array\n\t\tthis.scoreData = {}; // Holds score and error message\n\t\tthis.msgMan = msgMan;\n\t}\n\n\t_.extend(ParcelMng.prototype, {\n\n/*  Method: Void Init\n\tInput: Uses logs from API\n\tOutput: Sets parcelArray with array of type parcel\n\tDescription: Init goes over the log and creates an array of object of type Parcel according to\n\tthe parcelValue array in computeD. Each parcel object holds relevant information regarding the\n\tparcel including an array of trials with the relevant parcel name.\n\n\n*/\n\t\tInit: function(compute){\n\t\t\tvar parcelMng = this;\n\t\t\tvar msgMan = this.msgMan;\n\t\t\t// use the real global in order to prevent problems with dependencies\n\t\t\tvar global = window.piGlobal;\n\n\t\t\tvar data = global.current.logs;\n\t\t\tparcelMng.parcelArray = [];\n\t\t\tparcelMng.scoreData = {};\n\t\t\tparcelMng.msgMan = msgMan;\n\n\t\t\t// get settings\n\t\t\tvar AnalyzedVar = compute.AnalyzedVar;\n\t\t\tvar error = compute.ErrorVar;\n\t\t\tvar parcelVar = compute.parcelVar;\n\t\t\tvar parcels = compute.parcelValue;\n\t\t\tvar min = compute.minRT;\n\t\t\tvar max = compute.maxRT;\n\t\t\tvar fastRT= compute.fastRT;\n\n\t\t\t// set counters\n\t\t\tvar totalScoredTrials = 0;\n\t\t\tvar trialsUnder = 0;\n\t\t\tvar totalTrials=0;\n\t\t\tvar totalErrorTrials =0;\n\t\t\tvar maxFastTrialsRate = parseFloat(compute.maxFastTrialsRate);\n\n\n\t\t\tif (typeof parcels == 'undefined' || parcels.length === 0){\n\t\t\t\ttotalTrials =0;\n\t\t\t\ttotalScoredTrials=0;\n\t\t\t\ttrialsUnder=0;\n\t\t\t\ttotalErrorTrials=0;\n\t\t\t\tvar p = {};\n\t\t\t\tp.name = 'general';\n\t\t\t\tp.trialIData = [];\n\t\t\t\t_.each (data, function (value) {// loop per object in logger\n\t\t\t\t\t\tif (value[AnalyzedVar]>=min && value[AnalyzedVar]<=max){\n\t\t\t\t\t\t\ttotalTrials++;\n\t\t\t\t\t\t\tif (value.data[error] == 1) {\n\t\t\t\t\t\t\t\ttotalErrorTrials++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//p.trialIData.push(value);//push all data\n\t\t\t\t\t\t\t//totalScoredTrials++;\n\t\t\t\t\t\t\tif (parcelMng.validate(p,value,compute)) {\n\t\t\t\t\t\t\t\ttotalScoredTrials++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else {\n\t\t\t\t\t\t\tif (value[AnalyzedVar]<= fastRT) {\n\t\t\t\t\t\t\t\ttrialsUnder++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tparcelMng.checkErrors(totalTrials,totalErrorTrials,compute);\n\t\t\t\tparcelMng.parcelArray[0] = p;\n\t\t\t} else {\n\t\t\t\t_.each (parcels, function(parcelName,index) {// per parcel from parcelValue\n\t\t\t\t\t//set variables calculated per parcel\n\t\t\t\t\ttotalTrials =0;\n\t\t\t\t\ttotalScoredTrials=0;\n\t\t\t\t\ttrialsUnder=0;\n\t\t\t\t\ttotalErrorTrials=0;\n\t\t\t\t\tvar p = {};\n\t\t\t\t\tp.name = parcelName;\n\t\t\t\t\tp.trialIData = [];\n\t\t\t\t\t///////////////////////////////////\n\t\t\t\t\t_.each (data, function (value) {//loop per object in logger\n\t\t\t\t\t\tvar trialParcelName = value.data[parcelVar];\n\n\t\t\t\t\t\t// if this trial belongs to parcel\n\t\t\t\t\t\tif (trialParcelName == parcelName){\n\t\t\t\t\t\t\tif (value[AnalyzedVar]>=min && value[AnalyzedVar]<=max){\n\t\t\t\t\t\t\t\ttotalTrials++;\n\t\t\t\t\t\t\t\tif (value.data[error] == 1) {\n\t\t\t\t\t\t\t\t\ttotalErrorTrials++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//p.trialIData.push(value);//push all data\n\t\t\t\t\t\t\t\t//totalScoredTrials++;\n\t\t\t\t\t\t\t\tif (parcelMng.validate(p,value,compute)) {\n\t\t\t\t\t\t\t\t\ttotalScoredTrials++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else {\n\t\t\t\t\t\t\t\tif (value[AnalyzedVar]<= fastRT) {\n\t\t\t\t\t\t\t\t\ttrialsUnder++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t\tparcelMng.checkErrors(totalTrials,totalErrorTrials,compute);//apply maxErrorParcelRate logic\n\t\t\t\t\tparcelMng.parcelArray[index] = p;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif ( (trialsUnder/totalScoredTrials) > maxFastTrialsRate){\n\t\t\t\tparcelMng.scoreData.errorMessage = this.msgMan.getMessage('tooFast');\n\n\t\t\t}\n\n\t\t},\n\n/*\n\tprivate\n\tMethod: Void checkErrors\n\tInput: totalTrials,totalErrorTrials and compute object.\n\tOutput: Sets scoreData with error message if relevant.\n\tDescription: Helper method to check for errors according to maxErrorParcelRate from compute object.\n\tsets an error message in scoreData.\n\n*/\n\t\tcheckErrors: function(totalTrials,totalErrorTrials,compute){\n\n\t\t\tvar maxErrorParcelRate = compute.maxErrorParcelRate;\n\t\t\tif (totalErrorTrials/totalTrials > maxErrorParcelRate){\n\t\t\t\tthis.scoreData.errorMessage = this.msgMan.getMessage('manyErrors');\n\n\t\t\t}\n\n\t\t},\n\n/* Function: Void validate.\n\tInput: parcel object, trial object from the log and the compute object.\n\tOutput: Pushes the trial to the parcel based on information from errorLatency. Returns true/false.\n\tDescription: Helper method to apply errorLatency logic. If set to 'latency' trials witch are error\n\twould be added to the parcel trial array. if set to false trials that are error would not be added,\n\tif set to panelty error trials will be added and later panelized.\n\n*/\n\n\t\tvalidate: function(p,value,compute){\n\t\t\tvar errorLatency = compute.errorLatency;\n\t\t\tvar error = compute.ErrorVar;\n\t\t\tvar data = value.data;\n\n\n\t\t\tif (errorLatency.use =='latency'){\n\t\t\t\tp.trialIData.push(value);\n\t\t\t\treturn true;\n\t\t\t}else{\n\t\t\t\tif (errorLatency.use =='false'){\n\t\t\t\t\tif(data[error]=='1'){\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tp.trialIData.push(value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(errorLatency.use =='penalty'){\n\t\t\t\t\tp.trialIData.push(value);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n/*  Function: Void addPenalty.\n\tInput: parcel object and the compute object.\n\tOutput: adds penalty to latency of trials\n\tDescription: Helper method to add average and penalty to error trials\n\tif errorLatency is set to 'penalty'. Should be called after avgAll.\n\n*/\n\n\t\taddPenalty: function(p,compute){\n\t\t\tvar errorLatency = compute.errorLatency;\n\t\t\tvar parcelMng = this;\n\n\n\t\t\tif (errorLatency.use == 'penalty'){\n\n\t\t\t\tvar penalty = parseFloat(errorLatency.penalty);\n\t\t\t\tvar ErrorVar = compute.ErrorVar;\n\t\t\t\tvar AnalyzedVar = compute.AnalyzedVar;\n\t\t\t\tvar condVar = compute.condVar;\n\t\t\t\tvar cond1 = compute.cond1VarValues;\n\t\t\t\tvar cond2 = compute.cond2VarValues;\n\t\t\t\tvar trialIData = p.trialIData;\n\t\t\t\tvar avg1 = p.avgCon1;\n\t\t\t\tvar avg2 = p.avgCon2;\n\n\n\t\t\t\t_.each (trialIData, function (value) {\n\t\t\t\t\tvar data = value.data;\n\t\t\t\t\tvar error = data[ErrorVar];\n\t\t\t\t\tvar dataCond = data[condVar];\n\t\t\t\t\tvar diff1 = parcelMng.checkArray(dataCond,cond1);\n\t\t\t\t\tvar diff2 = parcelMng.checkArray(dataCond,cond2);\n\n\t\t\t\t\tif (error=='1'){\n\t\t\t\t\t\tif (diff1){\n\t\t\t\t\t\t\tvalue[AnalyzedVar] += avg1+ penalty;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tif (diff2){\n\t\t\t\t\t\t\t\tvalue[AnalyzedVar] += avg2+ penalty;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\n/*  Function: Void avgAll.\n\tInput: compute object.\n\tOutput: setting avgCon1 and avgCon2\n\tDescription: Loop over the parcels and Set average for condition 1 trials and for condition 2 trials.\n\n*/\n\n\t\tavgAll: function(compute){\n\t\t\tvar parcelMng = this;\n\t\t\t_.each(parcelMng.parcelArray, function (value) {\n\t\t\t\tparcelMng.avgParcel(value,compute);\n\t\t\t});\n\t\t},\n\n\n/*\n\tprivate\n\tFunction: Void avgParcel.\n\tInput: compute object, parcel.\n\tOutput: setting avgCon1 and avgCon2 in parcel.\n\tDescription: Set average for condition 1 trials and for condition 2 trials in the parcel.\n\n*/\n\n\t\tavgParcel: function(p,compute){\n\t\t\tvar parcelMng = this;\n\t\t\tvar trialIData = p.trialIData;\n\t\t\tvar condVar = compute.condVar;\n\t\t\tvar cond1 = compute.cond1VarValues;\n\t\t\tvar cond2 = compute.cond2VarValues;\n\t\t\tvar AnalyzedVar = compute.AnalyzedVar;\n\t\t\tvar avgCon1 = 0;\n\t\t\tvar avgCon2 = 0;\n\t\t\tvar avgBoth = 0;\n\t\t\tvar numCond1 = 0;\n\t\t\tvar numCond2 = 0;\n\t\t\tvar numBoth = 0;\n\n\t\t\t_.each (trialIData, function (value) {\n\n\t\t\t\tvar AnVar = value[AnalyzedVar];\n\t\t\t\tvar data = value.data;\n\t\t\t\tavgBoth += AnVar;\n\t\t\t\tnumBoth ++;\n\t\t\t\t//var diff1 = ( _(data[condVar]).difference(cond1) );\n\t\t\t\t//var diff2 = ( _(data[condVar]).difference(cond2) );\n\t\t\t\tvar dataCond = data[condVar];\n\t\t\t\tvar diff1 = parcelMng.checkArray(dataCond,cond1);\n\t\t\t\tvar diff2 = parcelMng.checkArray(dataCond,cond2);\n\n\t\t\t\tif (diff1) {\n\t\t\t\t\tnumCond1++;\n\t\t\t\t\tavgCon1 += AnVar;\n\t\t\t\t} else {\n\t\t\t\t\tif (diff2){\n\t\t\t\t\t\tnumCond2++;\n\t\t\t\t\t\tavgCon2 += AnVar;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tif (numCond1 <= 2 || numCond2 <= 2){\n\t\t\t\tparcelMng.scoreData.errorMessage = this.msgMan.getMessage(\"notEnough\");\n\t\t\t}\n\t\t\tif (numCond1 !== 0) {\n\t\t\t\tavgCon1 = avgCon1/numCond1;\n\t\t\t}\n\t\t\tif (numCond2 !== 0) {\n\t\t\t\tavgCon2 = avgCon2/numCond2;\n\t\t\t}\n\t\t\tp.avgCon1 = avgCon1;\n\t\t\tp.avgCon2 = avgCon2;\n\t\t\tp.diff = p.avgCon1 - p.avgCon2;\n\t\t\tif (numBoth !== 0) {\n\t\t\t\tp.avgBoth = avgBoth/numBoth;\n\t\t\t}\n\t\t\tparcelMng.addPenalty(p,compute);\n\t\t},\n\n/*  Function: Void checkArray.\n\tInput: the condition from the trial and an array of condition from computeD object.\n\tOutput: return true if condition is in the array.\n\tDescription: Helper function that returns true if condition is in the array or false otherwise.\n\n*/\n\n\t\tcheckArray: function(conFromData,con){\n\t\t\tfor(var i=0; i<con.length; i++){\n\t\t\t\tvar condition = con[i];\n\t\t\t\tif (condition == conFromData ){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n/*  Function: Void varianceAll.\n\tInput: compute object, parcel.\n\tOutput: variance variable in parcel.\n\tDescription: Loop over the parcels and set the variance variable.\n\n*/\n\n\t\tvarianceAll: function(compute){\n\t\t\tvar parcelMng = this;\n\t\t\t_.each (parcelMng.parcelArray, function (value) {\n\t\t\t\tparcelMng.varianceParcel(value,compute);\n\t\t\t});\n\t\t},\n\n/*  Function: Void varianceParcel.\n\tInput: compute object, parcel.\n\tOutput: setting variance variable in parcel.\n\tDescription: goes over the trials of the parcel and calculate variance.\n\n*/\n\t\tvarianceParcel: function(p,compute){\n\t\t\tvar parcelMng = this;\n\t\t\tvar AnalyzedVar = compute.AnalyzedVar;\n\t\t\tvar trialIData = p.trialIData;\n\t\t\tvar cond1 = compute.cond1VarValues;\n\t\t\tvar cond2 = compute.cond2VarValues;\n\t\t\tvar condVar = compute.condVar;\n\t\t\tvar avg = p.avgBoth;\n\t\t\tvar d = 0;\n\t\t\tvar x2 = 0;\n\t\t\tvar pooledCond1 = [];\n\t\t\tvar pooledCond2 = [];\n\t\t\tvar pooledData = [];\n\t\t\tvar errorLatency = compute.errorLatency;\n\t\t\tvar useForSTD = errorLatency.useForSTD;\n\n\n\t\t\t_.each (trialIData, function (value) {//pool to one array\n\t\t\t\tvar data = value.data;\n\t\t\t\tvar AnVar = value[AnalyzedVar];\n\t\t\t\tvar ErrorVar = compute.ErrorVar;\n\t\t\t\tvar error = data[ErrorVar];\n\t\t\t\tvar dataCond = data[condVar];\n\t\t\t\tvar diff1 = parcelMng.checkArray(dataCond,cond1);\n\t\t\t\tvar diff2 = parcelMng.checkArray(dataCond,cond2);\n\t\t\t\t//var diff1 = ( _(data[condVar]).difference(cond1) );\n\t\t\t\t//var diff2 = ( _(data[condVar]).difference(cond2) );\n\t\t\t\tif (diff1) {\n\t\t\t\t\tif (useForSTD){\n\t\t\t\t\t\tpooledCond1.push(AnVar);\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tif (error=='0') {\n\t\t\t\t\t\t\tpooledCond1.push(AnVar);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (diff2){\n\t\t\t\t\t\tif (useForSTD){\n\t\t\t\t\t\t\tpooledCond2.push(AnVar);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tif (error=='0') {\n\t\t\t\t\t\t\t\tpooledCond1.push(AnVar);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t});\n\n\t\t\tpooledData = pooledCond1.concat(pooledCond2);\n\t\t\t_.each (pooledData, function (value) {//pool to one array\n\t\t\t\tvar AnVar = value;\n\t\t\t\td = AnVar-avg;\n\t\t\t\tx2 += d*d;\n\n\t\t\t});\n\t\t\tp.variance = x2/(pooledData.length-1);\n\t\t},\n\n\n/*  Function: Void scoreAll.\n\tInput: compute object.\n\tOutput: score variable in scoreData object\n\tDescription: Average the scores from all parcels set score in scoreData object.\n\n*/\n\t\tscoreAll: function(compute){\n\t\t\tvar parcelMng = this;\n\t\t\tvar dAvg = 0;\n\t\t\t_.each (parcelMng.parcelArray, function (value) {\n\t\t\t\tparcelMng.scoreParcel(value,compute);\n\t\t\t\tdAvg +=  value.score;\n\t\t\t});\n\t\t\tvar score = (dAvg/(parcelMng.parcelArray.length));\n\t\t\tparcelMng.scoreData.score = score.toFixed(2);\n\n\t\t},\n\n/*\n\tprivate\n\tFunction: Void scoreParcel.\n\tInput: compute object, parcel.\n\tOutput: score variable in parcel\n\tDescription: Calculate the score for the parcel.\n\n*/\n\t\tscoreParcel: function(p){\n\t\t\tvar parcelMng = this;\n\t\t\tvar sd = Math.sqrt(p.variance);\n\t\t\tif (sd === 0){\n\t\t\t\tparcelMng.scoreData.errorMessage = this.msgMan.getMessage(\"notEnough\");\n\t\t\t\tp.score = p.diff;\n\t\t\t} else {\n\t\t\t\tp.score = p.diff/sd;\n\t\t\t}\n\t\t}\n\n\t});\n\n\treturn ParcelMng;\n});\n","define('pipScorer/Scorer',['require','jquery','./computeD','./msgMan','./parcelMng'],function(require){\n\n\tvar $ = require('jquery')\n\t\t, ComputeData = require('./computeD')\n\t\t, MsgMan = require('./msgMan')\n\t\t, ParcelMng = require('./parcelMng');\n\n\t// Description: make sure console.log is safe among all browsers.\n\t// js hint thinks that console is read only - and its correct except where it doesn't exist...  this is how we tell it to ignore these lines\n\t/* jshint -W020 */\n\t!!window.console || (console = {log: $.noop, error: $.noop});\n\tconsole.log || (console.log = $.noop);\n\t/* jshint +W020 */\n\n\n\n\tfunction Scorer(){\n\t\tthis.computeData = new ComputeData();\n\t\tthis.msgMan = new MsgMan();\n\t\tthis.parcelMng = new ParcelMng(this.msgMan);\n\t}\n\n\t$.extend(Scorer.prototype, {\n\n\t\t/**\n\t\t * Set settings for computeD or msgMan\n\t\t * @param {String} type 'compute' or 'message' - the type of settingsObj to set\n\t\t * @param {Object} Obj  The settings object itself\n\t\t */\n\t\taddSettings: function(type,Obj){\n\t\t\tswitch (type){\n\t\t\t\tcase 'compute':\n\t\t\t\t\tthis.computeData.setComputeObject(Obj);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'message':\n\t\t\t\t\tthis.msgMan.setMsgObject(Obj);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('SCORER:addSettings: unknow \"type\" ' + type);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Calculate the score\n\t\t * @return {Object} an object that holds the score and an error message\n\t\t */\n\t\tcomputeD: function(){\n\t\t\tvar computeData = this.computeData;\n\t\t\tvar parcelMng = this.parcelMng;\n\n\t\t\tcomputeData.setDataArray();\n\n\t\t\tparcelMng.Init(computeData);\n\t\t\tparcelMng.avgAll(computeData);\n\n\t\t\tparcelMng.varianceAll(computeData);\n\t\t\tparcelMng.scoreAll(computeData);\n\n\t\t\tvar scoreObj = parcelMng.scoreData;\n\n\t\t\tif (scoreObj.errorMessage === undefined || scoreObj.errorMessage === null){\n\t\t\t\treturn {\n\t\t\t\t\tFBMsg : this.getFBMsg(scoreObj.score),\n\t\t\t\t\tDScore : scoreObj.score,\n\t\t\t\t\terror: false\n\t\t\t\t};\n\t\t\t}else{\n\t\t\t\treturn {\n\t\t\t\t\tFBMsg : scoreObj.errorMessage,\n\t\t\t\t\tDScore : '',\n\t\t\t\t\terror: true\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Post the score and message to the server\n\t\t * @param  {[type]} score    [description]\n\t\t * @param  {[type]} msg      [description]\n\t\t * @param  {String} scoreKey The key with which to send the score data\n\t\t * @param  {String} msgKey   The key with which to send the msg data\n\t\t * @return {promise}         A promise that is resolved with the post\n\t\t */\n\t\tpostToServer: function(score,msg,scoreKey,msgKey){\n\t\t\tvar postSettings = this.computeData.postSettings || {};\n\t\t\tvar url = postSettings.url;\n\t\t\tvar data = {};\n\n\t\t\tif (!scoreKey) {\n\t\t\t\tscoreKey = postSettings.score;\n\t\t\t}\n\n\t\t\tif (!msgKey) {\n\t\t\t\tmsgKey = postSettings.msg;\n\t\t\t}\n\n\t\t\t// create post object\n\t\t\tdata[scoreKey] = score;\n\t\t\tdata[msgKey] = msg;\n\n\t\t\treturn $.post(url,JSON.stringify(data));\n\t\t},\n\n\t\t/**\n\t\t * Blindly post all \"data\" to the server\n\t\t * @param  {Object} data Arbitrary data to be sent to the server\n\t\t * @return {promise}      A promise that is resolved with the post\n\t\t */\n\t\tdynamicPost: function(data){\n\t\t\tvar postSettings = this.computeData.postSettings || {};\n\t\t\tvar url = postSettings.url;\n\n\t\t\treturn $.post(url,JSON.stringify(data));\n\t\t},\n\n\t\t// get message according to user input\n\t\tgetFBMsg: function(DScore){\n\t\t\tvar msg = this.msgMan.getScoreMsg(DScore);\n\t\t\treturn msg;\n\t\t}\n\n\t});\n\treturn Scorer;\n});\ndefine('pipScorer', ['pipScorer/Scorer'], function (main) { return main; });\n\n","define('pipAPI',['require','underscore','jquery'],function(require){\n\n\tvar _ = require('underscore');\n\n\t/**\n\t * Constructor for PIPlayer script creator\n\t * @return {Object}\t\tScript creator\n\t */\n\tfunction API(name){\n\t\tthis.script = {\n\t\t\tglobal: {}, // the real global should be extended with this\n\t\t\tcurrent: {}, // this is the actual namespace for this PIP\n\t\t\ttrialSets: [],\n\t\t\tstimulusSets: [],\n\t\t\tmediaSets: [],\n\t\t\tsequence: []\n\t\t};\n\n\t\tthis.script.name = name || 'anonymous PIP';\n\n\t\tthis.settings = this.script.settings = {\n\t\t\tcanvas: {\n\t\t\t\tmaxWidth: 800,\n\t\t\t\tproportions: 0.8\n\t\t\t},\n\t\t\thooks: {}\n\t\t};\n\t}\n\n\t_.extend(API.prototype, {\n\n\t\t// add set function\n\t\taddTrialSets: add_set('trial'),\n\t\taddStimulusSets: add_set('stimulus'),\n\t\taddMediaSets: add_set('media'),\n\n\t\t// settings\n\t\taddSettings: function(name, settingsObj){\n\t\t\tvar settings;\n\n\t\t\tif (_.isPlainObject(settingsObj)){\n\t\t\t\tsettings = this.settings[name] = this.settings[name] || {};\n\t\t\t\t_.extend(settings, settingsObj);\n\t\t\t} else {\n\t\t\t\tthis.settings[name] = settingsObj;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddSequence: function(sequence){\n\t\t\tvar script = this.script;\n\t\t\t_.isArray(sequence) || (sequence = [sequence]);\n\n\t\t\tscript.sequence = script.sequence.concat(sequence);\n\n\t\t\treturn this;\n\t\t},\n\n\t\taddGlobal: function(global){\n\t\t\tif (!_.isPlainObject(global)){\n\t\t\t\tthrow new Error('global must be an object');\n\t\t\t}\n\t\t\t_.merge(this.getGlobal(), global);\n\t\t},\n\n\t\tgetGlobal: function(){\n\t\t\treturn window.piGlobal;\n\t\t},\n\n\t\taddCurrent: function(current){\n\t\t\tif (!_.isPlainObject(current)){\n\t\t\t\tthrow new Error('current must be an object');\n\t\t\t}\n\t\t\t_.merge(this.script.current, current);\n\t\t},\n\n\t\tgetCurrent: function(){\n\t\t\treturn this.script.current;\n\t\t},\n\n\t\t// push a whole script\n\t\taddScript: function(obj){\n\t\t\t_.merge(this.script,obj);\n\t\t},\n\n\t\t// returns script (for debuging probably)\n\t\tgetScript: function(){\n\t\t\treturn this.script;\n\t\t},\n\n\t\tgetLogs: function(){\n\t\t\treturn this.script.current.logs;\n\t\t},\n\n\t\t// run the player, returns deferred\n\t\tplay: function(){\n\t\t\tthrow new Error('you should return API.script instead of calling API.play()!!');\n\t\t},\n\n\t\tpost: function(url, obj){\n\t\t\tvar $ = require('jquery');\n\t\t\t$.post(url, obj);\n\t\t}\n\n\t});\n\n\treturn API;\n\n\t /**\n\t  * Create a function that adds sets of a scpecific type\n\t  * @param {String} type  \tThe type of set setter to create\n\t  * @returns {Function} \tA setter object\n\t  */\n\tfunction add_set(type){\n\n\t\t/**\n\t\t * Adds a set to the targetSet\n\t\t * @param {String, Object} set    \tEither full set object, or the name of this setArr\n\t\t * @param {Array} setArr \t\t\tAn array of objects for this set\n\t\t * @returns {Object} The API object\n\t\t *\n\t\t * use examples:\n\t\t * fn({\n\t\t *   intro: [intro1, intro2],\n\t\t *   Default: [defaultTrial]\n\t\t * })\n\t\t * fn('intro',[intro1, intro2])\n\t\t * fn('Default',defaultTrial)\n\t\t *\n\t\t */\n\t\tfunction setSetter(set, setArr){\n\n\t\t\t// get the sets we want to extend (or create them)\n\t\t\tvar targetSets = this.script[type + \"Sets\"] || (this.script[type + \"Sets\"] = []);\n\t\t\tvar list;\n\n\t\t\tif (_.isPlainObject(set)) {\n\t\t\t\tlist = _(set)\n\t\t\t\t\t// for each set of elements\n\t\t\t\t\t.map(function(value, key){\n\t\t\t\t\t\t// add the set name to each key\n\t\t\t\t\t\t_.each(value, function(v){v.set = key;});\n\t\t\t\t\t\treturn value; // return the set\n\t\t\t\t\t})\n\t\t\t\t\t.flatten() // flatten all sets to a single array\n\t\t\t\t\t.value();\n\t\t\t}\n\n\t\t\tif (_.isArray(set)){\n\t\t\t\tlist = set;\n\t\t\t}\n\n\t\t\tif (_.isString(set)){\n\t\t\t\tlist = _.isArray(setArr) ? setArr : [setArr];\n\t\t\t\tlist = _.map(list, function(value){\n\t\t\t\t\tvalue.set = set;\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t// merge the list into the targetSet\n\t\t\ttargetSets.push.apply(targetSets, list);\n\t\t}\n\n\t\treturn setSetter;\n\t}\n});\n"]}